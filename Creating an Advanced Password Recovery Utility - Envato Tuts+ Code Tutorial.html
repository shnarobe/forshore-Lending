<!DOCTYPE html>
<!-- saved from url=(0093)http://code.tutsplus.com/tutorials/creating-an-advanced-password-recovery-utility-%2Dnet-4741 -->
<html data-ad-targeting="{&quot;code&quot;:[&quot;web-development&quot;,&quot;php&quot;]}" data-ads="[{&quot;doubleclick_id&quot;:&quot;11757429&quot;,&quot;unit_name&quot;:&quot;hub_development&quot;,&quot;location&quot;:&quot;inarticle&quot;,&quot;width&quot;:300,&quot;height&quot;:250,&quot;slot_id&quot;:&quot;1392179526912-0&quot;,&quot;mappings&quot;:[]},{&quot;doubleclick_id&quot;:&quot;11757429&quot;,&quot;unit_name&quot;:&quot;hub_development&quot;,&quot;location&quot;:&quot;post_top&quot;,&quot;width&quot;:300,&quot;height&quot;:250,&quot;slot_id&quot;:&quot;1379650391729-0&quot;,&quot;mappings&quot;:[{&quot;viewport&quot;:{&quot;width&quot;:1024,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:980,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:768,&quot;height&quot;:980},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:640,&quot;height&quot;:480},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:480,&quot;height&quot;:640},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]}]},{&quot;doubleclick_id&quot;:&quot;11757429&quot;,&quot;unit_name&quot;:&quot;hub_development&quot;,&quot;location&quot;:&quot;post_mid&quot;,&quot;width&quot;:300,&quot;height&quot;:250,&quot;slot_id&quot;:&quot;1382314910331-0&quot;,&quot;mappings&quot;:[{&quot;viewport&quot;:{&quot;width&quot;:1024,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:980,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:768,&quot;height&quot;:980},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:640,&quot;height&quot;:480},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:480,&quot;height&quot;:640},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]}]},{&quot;doubleclick_id&quot;:&quot;11757429&quot;,&quot;unit_name&quot;:&quot;hub_development&quot;,&quot;location&quot;:&quot;post_comments&quot;,&quot;width&quot;:300,&quot;height&quot;:250,&quot;slot_id&quot;:&quot;1379650407131-0&quot;,&quot;mappings&quot;:[{&quot;viewport&quot;:{&quot;width&quot;:1024,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:980,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:768,&quot;height&quot;:980},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:640,&quot;height&quot;:480},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:480,&quot;height&quot;:640},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]}]},{&quot;location&quot;:&quot;leader&quot;,&quot;unit_name&quot;:&quot;hub_development&quot;,&quot;slot_id&quot;:&quot;1391730982123-0&quot;,&quot;width&quot;:728,&quot;height&quot;:90,&quot;mappings&quot;:[{&quot;viewport&quot;:{&quot;width&quot;:1024,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:728,&quot;height&quot;:90}]},{&quot;viewport&quot;:{&quot;width&quot;:980,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:728,&quot;height&quot;:90}]},{&quot;viewport&quot;:{&quot;width&quot;:768,&quot;height&quot;:980},&quot;units&quot;:[{&quot;width&quot;:728,&quot;height&quot;:90}]}],&quot;doubleclick_id&quot;:&quot;11757429&quot;}]" data-app-version="09788c6fccb2c991c6716d6c21e4be1a68e3d3d1-production" class=" js no-touch history"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<script type="text/javascript" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/27851e2035"></script><script src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/nr-768.min.js"></script><script src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/expansion_embed.js"></script><script type="text/javascript" async="" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/linkid.js"></script><script type="text/javascript" async="" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/ec.js"></script><script async="" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/analytics.js"></script><script async="" type="text/javascript" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/gpt.js"></script><script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"27851e2035","applicationID":"3094824","transactionName":"JQpZTURXXlRcRBYWRBIKRVBXVEEXSl5WFQ==","queueTime":0,"applicationTime":179,"agent":"js-agent.newrelic.com/nr-768.min.js"}</script>
<script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={xpid:"VgUFWFRbGwAAXVVaBQU="};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({QJf3ax:[function(t,e){function n(t){function e(e,n,a){t&&t(e,n,a),a||(a={});for(var c=s(e),f=c.length,u=i(a,o,r),d=0;f>d;d++)c[d].apply(u,n);return u}function a(t,e){f[t]=s(t).concat(e)}function s(t){return f[t]||[]}function c(){return n(e)}var f={};return{on:a,emit:e,create:c,listeners:s,_events:f}}function r(){return{}}var o="nr@context",i=t("gos");e.exports=n()},{gos:"7eSDFh"}],ee:[function(t,e){e.exports=t("QJf3ax")},{}],3:[function(t){function e(t){try{i.console&&console.log(t)}catch(e){}}var n,r=t("ee"),o=t(1),i={};try{n=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(i.console=!0,-1!==n.indexOf("dev")&&(i.dev=!0),-1!==n.indexOf("nr_dev")&&(i.nrDev=!0))}catch(a){}i.nrDev&&r.on("internal-error",function(t){e(t.stack)}),i.dev&&r.on("fn-err",function(t,n,r){e(r.stack)}),i.dev&&(e("NR AGENT IN DEVELOPMENT MODE"),e("flags: "+o(i,function(t){return t}).join(", ")))},{1:20,ee:"QJf3ax"}],4:[function(t){function e(t,e,n,i,s){try{c?c-=1:r("err",[s||new UncaughtException(t,e,n)])}catch(f){try{r("ierr",[f,(new Date).getTime(),!0])}catch(u){}}return"function"==typeof a?a.apply(this,o(arguments)):!1}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function n(t){r("err",[t,(new Date).getTime()])}var r=t("handle"),o=t(6),i=t("ee"),a=window.onerror,s=!1,c=0;t("loader").features.err=!0,t(3),window.onerror=e;try{throw new Error}catch(f){"stack"in f&&(t(4),t(5),"addEventListener"in window&&t(1),window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&!/CriOS/.test(navigator.userAgent)&&t(2),s=!0)}i.on("fn-start",function(){s&&(c+=1)}),i.on("fn-err",function(t,e,r){s&&(this.thrown=!0,n(r))}),i.on("fn-end",function(){s&&!this.thrown&&c>0&&(c-=1)}),i.on("internal-error",function(t){r("ierr",[t,(new Date).getTime(),!0])})},{1:5,2:8,3:3,4:7,5:6,6:21,ee:"QJf3ax",handle:"D5DuLP",loader:"G9z0Bl"}],5:[function(t,e){function n(t){i.inPlace(t,["addEventListener","removeEventListener"],"-",r)}function r(t){return t[1]}var o=t("ee").create(),i=t(1)(o),a=t("gos");if(e.exports=o,n(window),"getPrototypeOf"in Object){for(var s=document;s&&!s.hasOwnProperty("addEventListener");)s=Object.getPrototypeOf(s);s&&n(s);for(var c=XMLHttpRequest.prototype;c&&!c.hasOwnProperty("addEventListener");)c=Object.getPrototypeOf(c);c&&n(c)}else XMLHttpRequest.prototype.hasOwnProperty("addEventListener")&&n(XMLHttpRequest.prototype);o.on("addEventListener-start",function(t,e){function n(){return s}if(t[1]){var r=t[1];if("function"==typeof r){var s=a(r,"nr@wrapped",function(){return i(r,"fn-",n,r.name||"anonymous")});this.wrapped=t[1]=s,o.emit("initEventContext",[t,e],this.wrapped)}else"function"==typeof r.handleEvent&&i.inPlace(r,["handleEvent"],"fn-")}}),o.on("removeEventListener-start",function(t){var e=this.wrapped;e&&(t[1]=e)})},{1:22,ee:"QJf3ax",gos:"7eSDFh"}],6:[function(t,e){var n=t("ee").create(),r=t(1)(n);e.exports=n,r.inPlace(window,["requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame"],"raf-"),n.on("raf-start",function(t){t[0]=r(t[0],"fn-")})},{1:22,ee:"QJf3ax"}],7:[function(t,e){function n(t,e,n){t[0]=i(t[0],"fn-",null,n)}function r(t,e,n){function r(){return a}this.ctx={};var a={"nr@context":this.ctx};o.emit("initTimerContext",[t,n],a),t[0]=i(t[0],"fn-",r,n)}var o=t("ee").create(),i=t(1)(o);e.exports=o,i.inPlace(window,["setTimeout","setImmediate"],"setTimer-"),i.inPlace(window,["setInterval"],"setInterval-"),i.inPlace(window,["clearTimeout","clearImmediate"],"clearTimeout-"),o.on("setInterval-start",n),o.on("setTimer-start",r)},{1:22,ee:"QJf3ax"}],8:[function(t,e){function n(){f.inPlace(this,p,"fn-",o)}function r(t,e){f.inPlace(e,["onreadystatechange"],"fn-")}function o(t,e){return e}function i(t,e){for(var n in t)e[n]=t[n];return e}var a=t("ee").create(),s=t(1),c=t(2),f=c(a),u=c(s),d=window.XMLHttpRequest,p=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"];e.exports=a,window.XMLHttpRequest=function(t){var e=new d(t);try{a.emit("new-xhr",[],e),e.hasOwnProperty("addEventListener")&&u.inPlace(e,["addEventListener","removeEventListener"],"-",o),e.addEventListener("readystatechange",n,!1)}catch(r){try{a.emit("internal-error",[r])}catch(i){}}return e},i(d,XMLHttpRequest),XMLHttpRequest.prototype=d.prototype,f.inPlace(XMLHttpRequest.prototype,["open","send"],"-xhr-",o),a.on("send-xhr-start",r),a.on("open-xhr-start",r)},{1:5,2:22,ee:"QJf3ax"}],9:[function(t){function e(t){var e=this.params,r=this.metrics;if(!this.ended){this.ended=!0;for(var i=0;c>i;i++)t.removeEventListener(s[i],this.listener,!1);if(!e.aborted){if(r.duration=(new Date).getTime()-this.startTime,4===t.readyState){e.status=t.status;var a=t.responseType,f="arraybuffer"===a||"blob"===a||"json"===a?t.response:t.responseText,u=n(f);if(u&&(r.rxSize=u),this.sameOrigin){var d=t.getResponseHeader("X-NewRelic-App-Data");d&&(e.cat=d.split(", ").pop())}}else e.status=0;r.cbTime=this.cbTime,o("xhr",[e,r,this.startTime])}}}function n(t){if("string"==typeof t&&t.length)return t.length;if("object"!=typeof t)return void 0;if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if("undefined"!=typeof FormData&&t instanceof FormData)return void 0;try{return JSON.stringify(t).length}catch(e){return void 0}}function r(t,e){var n=i(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}if(window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&!/CriOS/.test(navigator.userAgent)){t("loader").features.xhr=!0;var o=t("handle"),i=t(2),a=t("ee"),s=["load","error","abort","timeout"],c=s.length,f=t(1),u=window.XMLHttpRequest;t(4),t(3),a.on("new-xhr",function(){this.totalCbs=0,this.called=0,this.cbTime=0,this.end=e,this.ended=!1,this.xhrGuids={}}),a.on("open-xhr-start",function(t){this.params={method:t[0]},r(this,t[1]),this.metrics={}}),a.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),a.on("send-xhr-start",function(t,e){var r=this.metrics,o=t[0],i=this;if(r&&o){var f=n(o);f&&(r.txSize=f)}this.startTime=(new Date).getTime(),this.listener=function(t){try{"abort"===t.type&&(i.params.aborted=!0),("load"!==t.type||i.called===i.totalCbs&&(i.onloadCalled||"function"!=typeof e.onload))&&i.end(e)}catch(n){try{a.emit("internal-error",[n])}catch(r){}}};for(var u=0;c>u;u++)e.addEventListener(s[u],this.listener,!1)}),a.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),a.on("xhr-load-added",function(t,e){var n=""+f(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),a.on("xhr-load-removed",function(t,e){var n=""+f(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),a.on("addEventListener-end",function(t,e){e instanceof u&&"load"===t[0]&&a.emit("xhr-load-added",[t[1],t[2]],e)}),a.on("removeEventListener-end",function(t,e){e instanceof u&&"load"===t[0]&&a.emit("xhr-load-removed",[t[1],t[2]],e)}),a.on("fn-start",function(t,e,n){e instanceof u&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=(new Date).getTime()))}),a.on("fn-end",function(t,e){this.xhrCbStart&&a.emit("xhr-cb-time",[(new Date).getTime()-this.xhrCbStart,this.onload,e],e)})}},{1:"XL7HBI",2:10,3:8,4:5,ee:"QJf3ax",handle:"D5DuLP",loader:"G9z0Bl"}],10:[function(t,e){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");return!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname),r.sameOrigin=!e.hostname||e.hostname===document.domain&&e.port===n.port&&e.protocol===n.protocol,r}},{}],11:[function(t,e){function n(t){return function(){r(t,[(new Date).getTime()].concat(i(arguments)))}}var r=t("handle"),o=t(1),i=t(2);"undefined"==typeof window.newrelic&&(newrelic=window.NREUM);var a=["setPageViewName","addPageAction","setCustomAttribute","finished","addToTrace","inlineHit","noticeError"];o(a,function(t,e){window.NREUM[e]=n("api-"+e)}),e.exports=window.NREUM},{1:20,2:21,handle:"D5DuLP"}],gos:[function(t,e){e.exports=t("7eSDFh")},{}],"7eSDFh":[function(t,e){function n(t,e,n){if(r.call(t,e))return t[e];var o=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:o,writable:!0,enumerable:!1}),o}catch(i){}return t[e]=o,o}var r=Object.prototype.hasOwnProperty;e.exports=n},{}],D5DuLP:[function(t,e){function n(t,e,n){return r.listeners(t).length?r.emit(t,e,n):void(r.q&&(r.q[t]||(r.q[t]=[]),r.q[t].push(e)))}var r=t("ee").create();e.exports=n,n.ee=r,r.q={}},{ee:"QJf3ax"}],handle:[function(t,e){e.exports=t("D5DuLP")},{}],XL7HBI:[function(t,e){function n(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:i(t,o,function(){return r++})}var r=1,o="nr@id",i=t("gos");e.exports=n},{gos:"7eSDFh"}],id:[function(t,e){e.exports=t("XL7HBI")},{}],G9z0Bl:[function(t,e){function n(){var t=p.info=NREUM.info,e=f.getElementsByTagName("script")[0];if(t&&t.licenseKey&&t.applicationID&&e){s(d,function(e,n){e in t||(t[e]=n)});var n="https"===u.split(":")[0]||t.sslForHttp;p.proto=n?"https://":"http://",a("mark",["onload",i()]);var r=f.createElement("script");r.src=p.proto+t.agent,e.parentNode.insertBefore(r,e)}}function r(){"complete"===f.readyState&&o()}function o(){a("mark",["domContent",i()])}function i(){return(new Date).getTime()}var a=t("handle"),s=t(1),c=window,f=c.document;t(2);var u=(""+location).split("?")[0],d={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-768.min.js"},p=e.exports={offset:i(),origin:u,features:{}};f.addEventListener?(f.addEventListener("DOMContentLoaded",o,!1),c.addEventListener("load",n,!1)):(f.attachEvent("onreadystatechange",r),c.attachEvent("onload",n)),a("mark",["firstbyte",i()])},{1:20,2:11,handle:"D5DuLP"}],loader:[function(t,e){e.exports=t("G9z0Bl")},{}],20:[function(t,e){function n(t,e){var n=[],o="",i=0;for(o in t)r.call(t,o)&&(n[i]=e(o,t[o]),i+=1);return n}var r=Object.prototype.hasOwnProperty;e.exports=n},{}],21:[function(t,e){function n(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(0>o?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=n},{}],22:[function(t,e){function n(t){return!(t&&"function"==typeof t&&t.apply&&!t[i])}var r=t("ee"),o=t(1),i="nr@original",a=Object.prototype.hasOwnProperty;e.exports=function(t){function e(t,e,r,a){function nrWrapper(){var n,i,s,f;try{i=this,n=o(arguments),s=r&&r(n,i)||{}}catch(d){u([d,"",[n,i,a],s])}c(e+"start",[n,i,a],s);try{return f=t.apply(i,n)}catch(p){throw c(e+"err",[n,i,p],s),p}finally{c(e+"end",[n,i,f],s)}}return n(t)?t:(e||(e=""),nrWrapper[i]=t,f(t,nrWrapper),nrWrapper)}function s(t,r,o,i){o||(o="");var a,s,c,f="-"===o.charAt(0);for(c=0;c<r.length;c++)s=r[c],a=t[s],n(a)||(t[s]=e(a,f?s+o:o,i,s))}function c(e,n,r){try{t.emit(e,n,r)}catch(o){u([o,e,n,r])}}function f(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){u([r])}for(var o in t)a.call(t,o)&&(e[o]=t[o]);return e}function u(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=r),e.inPlace=s,e.flag=i,e}},{1:21,ee:"QJf3ax"}]},{},["G9z0Bl",4,9]);</script><title>Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial</title><link rel="canonical" href="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial.html"><link rel="shortcut icon" type="image/png" href="http://static.tutsplus.com/assets/favicon-8b86ba48e7f31535461f183680fe2ac9.png"><link rel="apple-touch-icon" type="image/png" href="http://static.tutsplus.com/assets/apple-touch-icon-8b86ba48e7f31535461f183680fe2ac9.png"><link rel="stylesheet" media="all" href="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/application-72538c589ec03080ce7be3b6c74eeab7.css"><script src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/collect.js" async="async"></script><!--[if lte IE 8]><link rel="stylesheet" media="screen" href="http://static.tutsplus.com/assets/ie8-c38f02ec8bb258c2ffad66305bbebfc9.css" /><script src="http://static.tutsplus.com/assets/modernizr.custom-4191fa85b5ca7ff4a6e827bd9820bcec.js"></script><![endif]--><script src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/application-2d5396053c28fbdbd260518edd034a03.js"></script><link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="http://tutsplus.com/posts.atom"><meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="PqEktD5tCMIftEzKzeaSnBSjpXBrPhzmNbvVCjsOuvxSeswpoy7G8WwMP9alZpsylxu4lh6RukDqqP+vKRoU/A=="><meta content="initial-scale=1" name="viewport"><meta content="index, follow" name="robots"><meta content="Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial" property="og:title"><meta content="Code Envato Tuts+" property="og:site_name"><meta content="1494084460809023" property="fb:app_id"><meta content="PHP" name="ET.category"><meta content="In my last tutorial, &#39;A Better Login System&#39;, a few people commented on how they would like to see a tutorial on password recovery, which is something you don&#39;t always see in user access tutorials. The tutorial I am bringing you today will deal with just that. Using mySQLi, we will learn to recover unencrypted and (one-way) encrypted passwords. | Difficulty: Intermediate; Tags: PHP, Web Development" property="og:description"><meta content="article" property="og:type"><meta content="http://code.tutsplus.com/tutorials/creating-an-advanced-password-recovery-utility--net-4741" property="og:url"><meta content="In my last tutorial, &#39;A Better Login System&#39;, a few people commented on how they would like to see a tutorial on password recovery, which is something you don&#39;t always see in user access tutorials. The tutorial I am bringing you today will deal with just that. Using mySQLi, we will learn to recover unencrypted and (one-way) encrypted passwords. | Difficulty: Intermediate; Tags: PHP, Web Development" name="description"><meta content="https://cdn.tutsplus.com/net/uploads/legacy/315_passwordRecovery/200x200.png" property="og:image"><meta content="t60fIs6JfmiK5FpPBlh_bKr5lJSX6abJYYIFjqiFG3M" name="google-site-verification"><link href="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/css" rel="stylesheet" type="text/css"><script type="text/javascript" async="" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/embed.js"></script><script async="" type="text/javascript" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/count.js"></script><script type="text/javascript" async="" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/saved_resource"></script><script type="text/javascript" async="" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/saved_resource(1)"></script><style type="text/css"></style><script src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/pubads_impl_78.js" async=""></script><script src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/count-data.js"></script><script type="application/ld+json">{"@context":"http://schema.org/","@id":"https://fast.wistia.net/embed/iframe/a0au10u6rs","@type":"VideoObject","duration":"PT40S","name":"Introduction","thumbnailUrl":"https://embed-ssl.wistia.com/deliveries/1c355c2f6e328849ab19effd46090cb17b8c159f.jpg?image_crop_resized=492x310","embedUrl":"https://fast.wistia.net/embed/iframe/a0au10u6rs","uploadDate":"2015-07-28","description":"<p>Welcome to OWASP PHP Security! In this lesson I’ll introduce the OWASP Top Ten list and talk about the structure of the course.</p>\n\n<strong>Related Links</strong>\n\n<ul>\n<li><a href=\"http://owasptop10.googlecode.com/files/OWASP%20Top%2010%20-%202013.pdf\">OWASP Top Ten (PDF)</a></li>\n<li><a href=\"http://code.tutsplus.com/courses/php-fundamentals\">PHP Essentials</a></li>\n<li><a href=\"http://code.tutsplus.com/courses/php-object-oriented-programming-fundamentals\">PHP OOP Fundamentals</a></li>\n<li><a href=\"https://code.tutsplus.com/courses/redis-essential\">Redis Essential Training</a></li>\n<li><a href=\"https://code.tutsplus.com/courses/understanding-apache-and-htaccess\">Understanding Apache and htacccess</a></li>\n<li><a href=\"https://code.tutsplus.com/courses/sql-essentials\">SQL Essentials</a></li>\n<li><a href=\"https://code.tutsplus.com/courses/create-killer-build-scripts-with-phing\">Create Killer Build Scripts with Phing</a></li>\n<li><a href=\"http://code.tutsplus.com/courses/use-composer\">Use Composer</a></li>\n</ul>"}</script><script type="text/javascript" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/osd.js"></script></head><body class="page-body topic-code" data-ga-account="UA-11792865-37" data-ga-domain="tutsplus.com" data-wt-dcsid="dcs222cpd4g6lg7wb3cum8l5g_6w6m"><div class="announcement-bar view noskim noskimlinks noskimwords noskimproducts announcement-bar--open view--loaded" data-announcement-id="VideoApp" data-background-image="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/296/topics/7/announcement_background_image/Background.png" data-fallback-background-color="#B8B8B8 " data-link-color="#ffffff" data-text-color="#ffffff " style="color: rgb(255, 255, 255); background-image: url(&quot;https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/296/topics/7/announcement_background_image/Background.png&quot;); background-color: rgb(184, 184, 184); background-size: inherit;"><div class="announcement-bar__content"><div class="announcement-bar__primary"><div class="announcement-bar__title"><span style="font-weight:700;">Introducing Envato Video. Create a professional video to share your story.</span>

<a rel="noskim" href="https://video.envato.com/?utm_source=tuts&amp;utm_medium=headerstrip&amp;utm_campaign=videolaunch&amp;utm_content=tuts" style="display: inline-block; border-radius: 3px; padding: 0px 12px; margin: 10px; font-size: 12px; height: 30px; line-height: 30px; text-decoration: none; color: rgb(255, 255, 255); background: rgb(130, 181, 65);">Discover our app</a></div></div><div class="announcement-bar__secondary"><a title="Close this announcement bar" class="announcement-bar__close-link" href="javascript:" style="color: rgb(255, 255, 255);"><span class="announcement-bar__close-label">Dismiss</span><i class="fa fa-times announcement-bar__close-icon"></i></a></div></div></div><!--[if lt IE 10]><div class="legacy-ie-banner"><h2 class="legacy-ie-banner__title">Unsupported browser</h2><p class="legacy-ie-banner__text">This site was designed for modern browsers and tested with Internet Explorer version 10 and later. </p><p class="legacy-ie-banner__text">It may not look or work correctly on your browser. </p></div><![endif]--><nav class="global-nav view view--loaded"><div class="global-nav__mobile-overlay"></div><div class="global-nav__mobile"><section class="global-nav__mobile-search"><form action="http://tutsplus.com/tutorials/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="✓"><input type="text" name="search[terms]" id="search_terms" placeholder="Search Envato Tuts+" class="global-nav__mobile-search-terms"><button name="button" type="submit" class="global-nav__mobile-search-button"><i class="fa fa-search"></i></button></form></section><div class="global-nav__mobile-user-links"><a class="global-nav__mobile-user-link" href="http://tutsplus.com/sign_up">Free Preview</a><a class="global-nav__mobile-user-link" href="https://tutsplus.com/sign_in?redirect_to=https%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fcreating-an-advanced-password-recovery-utility--net-4741">Sign In</a></div><ul class="global-nav__mobile-top-level"><li class="global-nav__mobile-top-level-item global-nav__mobile-top-level-item--expanded"><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-link-expandable" href="http://tutsplus.com/tutorials"><span class="global-nav__mobile-top-level-link-title">How-to Tutorials</span></a><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-expansion-link" href="http://code.tutsplus.com/tutorials/creating-an-advanced-password-recovery-utility--net-4741#"><span class="global-nav__mobile-top-level-expand-text"><i class="fa fa-plus global-nav__mobile-top-level-link-icon"></i></span><span class="global-nav__mobile-top-level-collapse-text"><i class="fa fa-minus global-nav__mobile-top-level-link-icon"></i></span></a><ul class="global-nav__mobile-second-level"><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-design" href="http://design.tutsplus.com/">Design &amp; Illustration</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-code" href="http://code.tutsplus.com/">Code</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-webdesign" href="http://webdesign.tutsplus.com/">Web Design</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-photography" href="http://photography.tutsplus.com/">Photo &amp; Video</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-music" href="http://music.tutsplus.com/">Music &amp; Audio</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-cgi" href="http://cgi.tutsplus.com/">3D &amp; Motion Graphics</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-gamedevelopment" href="http://gamedevelopment.tutsplus.com/">Game Development</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-computers" href="http://computers.tutsplus.com/">Computer Skills</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-business" href="http://business.tutsplus.com/">Business</a></li></ul></li><li class="global-nav__mobile-top-level-item"><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-link-expandable" href="http://tutsplus.com/courses"><span class="global-nav__mobile-top-level-link-title">Courses</span></a><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-expansion-link" href="http://code.tutsplus.com/tutorials/creating-an-advanced-password-recovery-utility--net-4741#"><span class="global-nav__mobile-top-level-expand-text"><i class="fa fa-plus global-nav__mobile-top-level-link-icon"></i></span><span class="global-nav__mobile-top-level-collapse-text"><i class="fa fa-minus global-nav__mobile-top-level-link-icon"></i></span></a><div class="global-nav__mobile-second-level"><div class="global-nav__mobile-second-level-item"></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-design" href="http://design.tutsplus.com/courses">Design &amp; Illustration</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-code" href="http://code.tutsplus.com/courses">Code</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-webdesign" href="http://webdesign.tutsplus.com/courses">Web Design</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-photography" href="http://photography.tutsplus.com/courses">Photo &amp; Video</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-music" href="http://music.tutsplus.com/courses">Music &amp; Audio</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-cgi" href="http://cgi.tutsplus.com/courses">3D &amp; Motion Graphics</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-business" href="http://business.tutsplus.com/courses">Business</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-bundles-link" href="http://tutsplus.com/bundles"><span class="translation_missing" title="translation missing: en.views.courses.courses_menu.bundles">Bundles</span></a></div></div></li><li class="global-nav__mobile-top-level-item"><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-link-expandable" href="http://tutsplus.com/ebooks"><span class="global-nav__mobile-top-level-link-title">eBooks</span></a><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-expansion-link" href="http://code.tutsplus.com/tutorials/creating-an-advanced-password-recovery-utility--net-4741#"><span class="global-nav__mobile-top-level-expand-text"><i class="fa fa-plus global-nav__mobile-top-level-link-icon"></i></span><span class="global-nav__mobile-top-level-collapse-text"><i class="fa fa-minus global-nav__mobile-top-level-link-icon"></i></span></a><div class="global-nav__mobile-second-level"><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-design" href="http://design.tutsplus.com/ebooks">Design &amp; Illustration</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-code" href="http://code.tutsplus.com/ebooks">Code</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-webdesign" href="http://webdesign.tutsplus.com/ebooks">Web Design</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-photography" href="http://photography.tutsplus.com/ebooks">Photo &amp; Video</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-music" href="http://music.tutsplus.com/ebooks">Music &amp; Audio</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-cgi" href="http://cgi.tutsplus.com/ebooks">3D &amp; Motion Graphics</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-business" href="http://business.tutsplus.com/ebooks">Business</a></div></div></li><li class="global-nav__mobile-top-level-item"><a class="global-nav__mobile-top-level-link" href="http://tutsplus.com/pricing">Pricing</a></li></ul><ul class="global-nav-mobile__envato-links"><li class="global-nav__mobile-top-level-item"><a class="global-mobile__header-item--envato-link" href="http://market.envato.com/">Envato Market</a></li><li class="global-nav__mobile-top-level-item"><a class="global-mobile__header-item--envato-link" href="http://studio.envato.com/">Envato Studio</a></li><li class="global-nav__mobile-top-level-item"><a class="global-mobile__header-item--envato-link" href="http://community.envato.com/">Community</a></li><li class="global-nav__mobile-top-level-item"><a class="global-mobile__header-item--envato-link" href="http://tutsplus.com/blog">Blog</a></li><li class="global-nav__mobile-top-level-item"><a class="global-mobile__header-item--envato-link" href="http://tutsplus.com/faq">Help</a></li></ul></div><div class="global-nav__header"><div class="global-nav__header-content"><div class="global-nav__header-top"><a class="global-nav__header-tuts-logo-link" href="http://tutsplus.com/"><img alt="envato-tuts+" class="global-nav__header-tuts-logo-image" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/tuts_logo-b4f5f5fad9a5f4b3f91e3b770689a808.svg"></a><div class="global-nav__header-right"><ul class="global-nav__header-list"><li class="global-nav__header-item"><a class="global-nav__header-item--envato-link" href="http://market.envato.com/">Envato Market</a></li><li class="global-nav__header-item"><a class="global-nav__header-item--envato-link" href="http://studio.envato.com/">Envato Studio</a></li><li class="global-nav__header-item"><a class="global-nav__header-item--envato-link" href="http://community.envato.com/">Community</a></li><li class="global-nav__header-item"><a class="global-nav__header-item--envato-link" href="http://tutsplus.com/blog">Blog</a></li><li class="global-nav__header-item"><a class="global-nav__header-item--envato-link" href="http://tutsplus.com/faq">Help</a></li></ul><ul class="global-nav__header-buttons"><li class="global-nav__header-item"><a class="global-nav__header-item--internal-link global-nav__header-item--free-account-button" href="http://tutsplus.com/sign_up">Free Preview</a></li><li class="global-nav__header-item"><a class="global-nav__header-item--sign-in-button global-nav__header-item--internal-link" href="https://tutsplus.com/sign_in?redirect_to=https%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fcreating-an-advanced-password-recovery-utility--net-4741">Sign In</a></li></ul></div></div><div class="global-nav__header-bottom"><ul class="global-nav__header-list"><li class="global-nav__header-item"><nav class="topics-menu view view--loaded" data-toggle=".topics-menu__dropdown-toggle"><a class="topics-menu__dropdown-toggle global-nav__header-link global-nav__header-link--primary global-nav__header-link--active" href="http://tutsplus.com/tutorials">How-to Tutorials<i class="fa fa-chevron-down"></i></a><ul class="topics-menu__topics topics-menu__topics--expanded"><li class="topics-menu__topic topic-design" data-slug="design"><a class="topics-menu__topic-link topic-design topics-menu__topic-link--active" href="http://design.tutsplus.com/">Design &amp; Illustration<i class="fa fa-chevron-right topics-menu__topic-link-chevron topics-menu__topic-link-chevron--active"></i></a><div class="topics-menu__topic-submenu topic-design topics-menu__topic-submenu--visible"><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/vector">Vector</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/adobe-photoshop">Adobe Photoshop</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/adobe-illustrator">Adobe Illustrator</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/illustration">Illustration</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/tools-tips">Tools &amp; Tips</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/inspiration">Inspiration</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/news">News</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/drawing">Drawing</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/designing">Designing</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/graphic-design">Graphic Design</a></li></ul><a class="topics-menu__more-categories-link topic-design" href="http://design.tutsplus.com/categories">More Categories...</a><a class="topics-menu__submenu-footer-link topic-design" href="http://design.tutsplus.com/series">Learning Guides</a></div></li><li class="topics-menu__topic topic-code" data-slug="code"><a class="topics-menu__topic-link topic-code" href="http://code.tutsplus.com/">Code<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-code"><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/web-development">Web Development</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/wordpress">WordPress</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/mobile-development">Mobile Development</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/php">PHP</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/flash">Flash</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/javascript">JavaScript</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/news">News</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/ios-sdk">iOS SDK</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/cms">CMS</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/android-sdk">Android SDK</a></li></ul><a class="topics-menu__more-categories-link topic-code" href="http://code.tutsplus.com/categories">More Categories...</a><a class="topics-menu__submenu-footer-link topic-code" href="http://code.tutsplus.com/series">Learning Guides</a></div></li><li class="topics-menu__topic topic-webdesign" data-slug="webdesign"><a class="topics-menu__topic-link topic-webdesign" href="http://webdesign.tutsplus.com/">Web Design<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-webdesign"><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/css">CSS</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/html-css">HTML &amp; CSS</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/html">HTML</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/adobe-photoshop">Adobe Photoshop</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/complete-websites">Complete Websites</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/ui-design">UI Design</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/workflow">Workflow</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/design-theory">Design Theory</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/general">General</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/blog">Blog</a></li></ul><a class="topics-menu__more-categories-link topic-webdesign" href="http://webdesign.tutsplus.com/categories">More Categories...</a><a class="topics-menu__submenu-footer-link topic-webdesign" href="http://webdesign.tutsplus.com/series">Learning Guides</a></div></li><li class="topics-menu__topic topic-photography" data-slug="photography"><a class="topics-menu__topic-link topic-photography" href="http://photography.tutsplus.com/">Photo &amp; Video<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-photography"><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/shooting">Shooting</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/post-processing">Post-Processing</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/photo-critique">Photo Critique</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/adobe-photoshop">Adobe Photoshop</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/inspiration">Inspiration</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/lighting">Lighting</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/news">News</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/adobe-lightroom">Adobe Lightroom</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/lectures">Lectures</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/video">Video</a></li></ul><a class="topics-menu__more-categories-link topic-photography" href="http://photography.tutsplus.com/categories">More Categories...</a><a class="topics-menu__submenu-footer-link topic-photography" href="http://photography.tutsplus.com/series">Learning Guides</a></div></li><li class="topics-menu__topic topic-music" data-slug="music"><a class="topics-menu__topic-link topic-music" href="http://music.tutsplus.com/">Music &amp; Audio<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-music"><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/audio-production">Audio Production</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/general">General</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/logic-pro">Logic Pro</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/workshops">Workshops</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/mixing-mastering">Mixing &amp; Mastering</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/open-mic">Open Mic</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/sound-design">Sound Design</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/ableton-live">Ableton Live</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/reason">Reason</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/recording">Recording</a></li></ul><a class="topics-menu__more-categories-link topic-music" href="http://music.tutsplus.com/categories">More Categories...</a><a class="topics-menu__submenu-footer-link topic-music" href="http://music.tutsplus.com/series">Learning Guides</a></div></li><li class="topics-menu__topic topic-cgi" data-slug="cgi"><a class="topics-menu__topic-link topic-cgi" href="http://cgi.tutsplus.com/">3D &amp; Motion Graphics<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-cgi"><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/adobe-after-effects">Adobe After Effects</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/3d">3D</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/motion-graphics">Motion Graphics</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/3d-studio-max">3D Studio Max</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/cinema-4d">Cinema 4D</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/maya">Maya</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/workflow">Workflow</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/news">News</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/visual-effects">Visual Effects</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/roundup">Roundup</a></li></ul><a class="topics-menu__more-categories-link topic-cgi" href="http://cgi.tutsplus.com/categories">More Categories...</a><a class="topics-menu__submenu-footer-link topic-cgi" href="http://cgi.tutsplus.com/series">Learning Guides</a></div></li><li class="topics-menu__topic topic-gamedevelopment" data-slug="gamedevelopment"><a class="topics-menu__topic-link topic-gamedevelopment" href="http://gamedevelopment.tutsplus.com/">Game Development<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-gamedevelopment"><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/game-design">Game Design</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/implementation">Implementation</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/platform-agnostic">Platform Agnostic</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/business">Business</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/programming">Programming</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/flash">Flash</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/from-scratch">From Scratch</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/html5">HTML5</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/news">News</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/construct-2">Construct 2</a></li></ul><a class="topics-menu__more-categories-link topic-gamedevelopment" href="http://gamedevelopment.tutsplus.com/categories">More Categories...</a><a class="topics-menu__submenu-footer-link topic-gamedevelopment" href="http://gamedevelopment.tutsplus.com/series">Learning Guides</a></div></li><li class="topics-menu__topic topic-computers" data-slug="computers"><a class="topics-menu__topic-link topic-computers" href="http://computers.tutsplus.com/">Computer Skills<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-computers"><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/os-x">OS X</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/app-training">App Training</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/productivity">Productivity</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/tips-shortcuts">Tips &amp; Shortcuts</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/electronics">Electronics</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/automation">Automation</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/security">Security</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/office">Office</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/hardware">Hardware</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/terminal">Terminal</a></li></ul><a class="topics-menu__more-categories-link topic-computers" href="http://computers.tutsplus.com/categories">More Categories...</a><a class="topics-menu__submenu-footer-link topic-computers" href="http://computers.tutsplus.com/series">Learning Guides</a></div></li><li class="topics-menu__topic topic-business" data-slug="business"><a class="topics-menu__topic-link topic-business" href="http://business.tutsplus.com/">Business<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-business"><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/freelance">Freelance</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/marketing">Marketing</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/communication">Communication</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/planning">Planning</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/finance">Finance</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/sales">Sales</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/productivity">Productivity</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/entrepreneurship">Entrepreneurship</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/career-development">Career Development</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/blogging">Blogging</a></li></ul><a class="topics-menu__more-categories-link topic-business" href="http://business.tutsplus.com/categories">More Categories...</a><a class="topics-menu__submenu-footer-link topic-business" href="http://business.tutsplus.com/series">Learning Guides</a></div></li></ul></nav></li><li class="global-nav__header-item"><nav class="courses-menu view" data-toggle=".courses-menu__dropdown-toggle"><a class="courses-menu__dropdown-toggle global-nav__header-link global-nav__header-link--primary " href="http://tutsplus.com/courses">Courses<i class="fa fa-chevron-down"></i></a><ul class="courses-menu__topics"><li class="courses-menu__topic topic-design" data-slug="design"><a class="courses-menu__topic-link topic-design" href="http://design.tutsplus.com/courses">Design &amp; Illustration</a></li><li class="courses-menu__topic topic-code" data-slug="code"><a class="courses-menu__topic-link topic-code" href="http://code.tutsplus.com/courses">Code</a></li><li class="courses-menu__topic topic-webdesign" data-slug="webdesign"><a class="courses-menu__topic-link topic-webdesign" href="http://webdesign.tutsplus.com/courses">Web Design</a></li><li class="courses-menu__topic topic-photography" data-slug="photography"><a class="courses-menu__topic-link topic-photography" href="http://photography.tutsplus.com/courses">Photo &amp; Video</a></li><li class="courses-menu__topic topic-music" data-slug="music"><a class="courses-menu__topic-link topic-music" href="http://music.tutsplus.com/courses">Music &amp; Audio</a></li><li class="courses-menu__topic topic-cgi" data-slug="cgi"><a class="courses-menu__topic-link topic-cgi" href="http://cgi.tutsplus.com/courses">3D &amp; Motion Graphics</a></li><li class="courses-menu__topic topic-business" data-slug="business"><a class="courses-menu__topic-link topic-business" href="http://business.tutsplus.com/courses">Business</a></li><a class="courses-menu__topic-link courses-menu__bundles-link" href="http://tutsplus.com/bundles"><span class="translation_missing" title="translation missing: en.views.courses.courses_menu.bundles">Bundles</span></a></ul></nav></li><li class="global-nav__header-item"><nav class="ebooks-menu view" data-toggle=".ebooks-menu__dropdown-toggle"><a class="ebooks-menu__dropdown-toggle global-nav__header-link global-nav__header-link--primary " href="http://tutsplus.com/ebooks">eBooks<i class="fa fa-chevron-down"></i></a><ul class="ebooks-menu__topics"><li class="ebooks-menu__topic topic-design" data-slug="design"><a class="ebooks-menu__topic-link topic-design" href="http://design.tutsplus.com/ebooks">Design &amp; Illustration</a></li><li class="ebooks-menu__topic topic-code" data-slug="code"><a class="ebooks-menu__topic-link topic-code" href="http://code.tutsplus.com/ebooks">Code</a></li><li class="ebooks-menu__topic topic-webdesign" data-slug="webdesign"><a class="ebooks-menu__topic-link topic-webdesign" href="http://webdesign.tutsplus.com/ebooks">Web Design</a></li><li class="ebooks-menu__topic topic-photography" data-slug="photography"><a class="ebooks-menu__topic-link topic-photography" href="http://photography.tutsplus.com/ebooks">Photo &amp; Video</a></li><li class="ebooks-menu__topic topic-music" data-slug="music"><a class="ebooks-menu__topic-link topic-music" href="http://music.tutsplus.com/ebooks">Music &amp; Audio</a></li><li class="ebooks-menu__topic topic-cgi" data-slug="cgi"><a class="ebooks-menu__topic-link topic-cgi" href="http://cgi.tutsplus.com/ebooks">3D &amp; Motion Graphics</a></li><li class="ebooks-menu__topic topic-business" data-slug="business"><a class="ebooks-menu__topic-link topic-business" href="http://business.tutsplus.com/ebooks">Business</a></li></ul></nav></li><li class="global-nav__header-item"><a class="global-nav__header-link" href="http://tutsplus.com/pricing">Pricing</a></li></ul><div class="global-nav__header-right"><div class="global-nav__search"><form action="http://tutsplus.com/tutorials/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="✓"><span class="twitter-typeahead" style="position: relative; display: inline-block; direction: ltr;"><input type="text" class="global-nav__search-terms tt-hint" readonly="" autocomplete="off" spellcheck="false" tabindex="-1" style="position: absolute; top: 0px; left: 0px; border-color: transparent; box-shadow: none; opacity: 1; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><input type="text" name="search[terms]" id="search_terms" placeholder="Search Envato Tuts+" class="global-nav__search-terms tt-input" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top; background-color: transparent;"><pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: 0px; text-indent: 0px; text-rendering: auto; text-transform: none;"></pre><span class="tt-dropdown-menu" style="position: absolute; top: 100%; left: 0px; z-index: 100; display: none; right: auto;"><div class="tt-dataset-search"></div></span></span><button name="button" type="submit" class="global-nav__search-button"><i class="fa fa-search"></i></button></form></div></div></div></div></div><div class="global-nav__mobile-toggle"><a class="global-nav__mobile-toggle-link" href="javascript:"><i class="fa fa-reorder"></i><i class="fa fa-times"></i></a></div></nav><div class="ad view ad--leaderboard"><div class="ad__wrapper"><div class="ad__content" id="div-gpt-1391730982123-0"><div id="google_ads_iframe_/11757429/hub_development_leader_0__container__" style="border: 0pt none; display: inline-block; width: 728px; height: 90px;"><iframe frameborder="0" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/container(1).html" id="google_ads_iframe_/11757429/hub_development_leader_0" name="1-0-2;32433;&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body leftMargin=&quot;0&quot; topMargin=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot;&gt;&lt;script&gt;var viewReq = new Array();function vu(u) {var i=new Image();i.src=u.replace(&quot;&amp;amp;&quot;,&quot;&amp;&quot;);viewReq.push(i);}&lt;/script&gt;&lt;script&gt;vu(&quot;https://adx.g.doubleclick.net/pagead/adview?ai\x3dCJzp27bl4VpugEJbRfOmhqYgCvvGEkQW2nKvDTcCNtwEQASAAYLUCggEXY2EtcHViLTM1NTg4NzA1NjQ1Mjc0MTbIAQngAgCoAwGqBOoBT9BKKJlex7bB8dIcy6SmyQVa9NJlYgVe28ybQoVTPSE6pFaDpv0NW6WUPBb6_OxxJ2w5vRvkdklitbcLu5LNgTIjd9LO4fBgRcF5Bwu2qdFbnBi7ke1nP9RH7a2Yg0t7_sx2sP-5NF_R-WV2F-5nUT2iycqYhsueQqFfFTsIqqolzQv-b_n96MKEnfvNTnh5gTl3dw5A9TdWYKxkcg3cRNtF-Bsd2qsYchCtTbIZAfrnA_uXGxGlpOdRz9m30YjEC_zdf1SjIjMj2QbofuKJjogMVFBp3GqGiry908qoi-0CCVVqLP8eTJtK4AQBgAaJ0p-jwsLf6UagBiHYBwA\x26sigh\x3dEy0j3_PzvS0&quot;)&lt;/script&gt;
    &lt;div style=&quot;text-align: center;&quot;&gt;
       &lt;script type=&quot;text/javascript&quot;&gt;
           adroll_width = 728;
           adroll_height = 90;
           adroll_a_id = &quot;UAZEVLFYKZGQPMOT77ULX3&quot;;
           adroll_s_id = &quot;N34ZPOW5TRGMJKDEFHM2G4&quot;;
           adroll_c_id = &quot;UHBVRXFI65F3PEUFSLXGNL&quot;;
           adroll_render_link = false;
           adroll_ext_network = &quot;g&quot;;
           adroll_subnetwork = &quot;r&quot;;
           adroll_ad_payload = &quot;AFB1cy1lYXN0LTFhABgxMTcAODE2ODQzNzQAEDU4AEBjb2xsaWRlcgAQNjAAMDI3NjUyNAAQOTIBGDI2NzYxNjU5OTU4ODY4MTI1MTU0MTUwNzExMDU0NjY3MjY1ABA3MAAQLTEAGDEyNAAQLTEAGDEyNQB4MjAxNTEyMTVfdjVfMF8xABA2MwBgcnVubmluZ18yMDAxABgxMjAAsFJOT1pRQURMNTVERzNQVTZGTFM2T1oAEDI2ALBTN1pWVkdaQktGQkFWT0M1WkRPNE5VABA1NgAwMzE0MDgyABgyMDMAODQwNTQzNjcAGDIwMgEYMjY3NjE2NTk5NTg4NjgxMTAwODQ4OTE1ODA0NTIwODM5NTYAGDIwNACQeyJldmlkb25fdCI6MTUwMDB9ABgyNTAAIDAuNDUAGDI1MwAIdAAgMTEwMAAIZgAQNzUAsFI2UUpHTllCVzVBR0pBTEtRU0VKNjMACDQAiGNvZGUudHV0c3BsdXMuY29tABgxMzcAiGNvZGUudHV0c3BsdXMuY29tABgxNjAAUDE0NTA3NTI0OTMAGDE1NQAIMAAQNzEACDYAEDc4AAgwABgxNjIAEDI3ABgxNjQACGYAGDE2MwAwMzAwNzgxABg2MDAAODE2ODQzNzQAGDYwNgBgc3FwdWdfdjVfMF8xABg2MDEACHQAGDYwMgA4NDAwMDAwMAAYNjA1ABBlbgAYMTMyAAhmABgxMDQAIDM5NzEAEDk0AHBBQk9WRV9USEVfRk9MRAAQOTgAUDEwMzMzNzg5MDIAGDEyOQ&quot;;
           adroll_c_macro = &quot;http://adclick.g.doubleclick.net/aclk%3Fsa%3DL%26ai%3DCJzp27bl4VpugEJbRfOmhqYgCvvGEkQW2nKvDTcCNtwEQASAAYLUCggEXY2EtcHViLTM1NTg4NzA1NjQ1Mjc0MTbIAQngAgCoAwGqBOoBT9BKKJlex7bB8dIcy6SmyQVa9NJlYgVe28ybQoVTPSE6pFaDpv0NW6WUPBb6_OxxJ2w5vRvkdklitbcLu5LNgTIjd9LO4fBgRcF5Bwu2qdFbnBi7ke1nP9RH7a2Yg0t7_sx2sP-5NF_R-WV2F-5nUT2iycqYhsueQqFfFTsIqqolzQv-b_n96MKEnfvNTnh5gTl3dw5A9TdWYKxkcg3cRNtF-Bsd2qsYchCtTbIZAfrnA_uXGxGlpOdRz9m30YjEC_zdf1SjIjMj2QbofuKJjogMVFBp3GqGiry908qoi-0CCVVqLP8eTJtK4AQBgAaJ0p-jwsLf6UagBiHYBwA%26num%3D1%26sig%3DAOD64_19hMTTB0oWzbDQCVNDNUlzieGnlw%26client%3Dca-pub-3558870564527416%26adurl%3D&quot;;
           adroll_url_macro = &quot;tutsplus.com&quot;;
           adroll_cpm_macro = &quot;Vni57QAEEBsKHyiWAApQ6ZgEmj5RgHQ4EGRqsw&quot;;
           adroll_win_notif = &quot;adx-winners-us-east-1-rtb.adroll.com/win/g?c=S7ZVVGZBKFBAVOC5ZDO4NU&amp;amp;bid=AAABUceWRxgAAAUnc6MFtl3ThYpGzp2OAUJgwsFv8jbEmNNGltFsvdw&amp;amp;payload=AQA3MmM5ZTE2OTZmNzcxNmEyMjE4MDM5YzZiYjA0M2M3ZAAIYQFIZWMyLTU0LTE2MC0yMTYtMzYuY29tcHV0ZS0xLmFtYXpvbmF3cy5jb20ACGgACGYACHQAsFM3WlZWR1pCS0ZCQVZPQzVaRE80TlUACGMBGDI2NzYxNjU5OTU4ODY4MTI1MTU0MTUwNzExMDU0NjY3MjY1AAhiAAgwABBhYxjQQUZCMWN5MWxZWE4wTFRGaEFCZ3hNVGNBT0RFMk9EUXpOelFBRURVNEFFQmpiMnhzYVdSbGNnQVFOakFBTURJM05qVXlOQUFRT1RJQkdESTJOell4TmpVNU9UVTRPRFk0TVRJMU1UVTBNVFV3TnpFeE1EVTBOalkzTWpZMUFCQTNNQUFRTFRFQUdERXlOQUFRTFRFQUdERXlOUUI0TWpBeE5URXlNVFZmZGpWZk1GOHhBQkEyTXdCZ2NuVnVibWx1WjE4eU1EQXhBQmd4TWpBQXNGSk9UMXBSUVVSTU5UVkVSek5RVlRaR1RGTTJUMW9BRURJMkFMQlROMXBXVmtkYVFrdEdRa0ZXVDBNMVdrUlBORTVWQUJBMU5nQXdNekUwTURneUFCZ3lNRE1BT0RRd05UUXpOamNBR0RJd01nRVlNalkzTmpFMk5UazVOVGc0TmpneE1UQXdPRFE0T1RFMU9EQTBOVEl3T0RNNU5UWUFHREl3TkFDUWV5SmxkbWxrYjI1ZmRDSTZNVFV3TURCOUFCZ3lOVEFBSURBdU5EVUFHREkxTXdBSWRBQWdNVEV3TUFBSVpnQVFOelVBc0ZJMlVVcEhUbGxDVnpWQlIwcEJURXRSVTBWS05qTUFDRFFBaUdOdlpHVXVkSFYwYzNCc2RYTXVZMjl0QUJneE16Y0FpR052WkdVdWRIVjBjM0JzZFhNdVkyOXRBQmd4TmpBQVVERTBOVEEzTlRJME9UTUFHREUxTlFBSU1BQVFOekVBQ0RZQUVEYzRBQWd3QUJneE5qSUFFREkzQUJneE5qUUFDR1lBR0RFMk13QXdNekF3TnpneEFCZzJNREFBT0RFMk9EUXpOelFBR0RZd05nQmdjM0Z3ZFdkZmRqVmZNRjh4QUJnMk1ERUFDSFFBR0RZd01nQTROREF3TURBd01BQVlOakExQUJCbGJnQVlNVE15QUFobUFCZ3hNRFFBSURNNU56RUFFRGswQUhCQlFrOVdSVjlVU0VWZlJrOU1SQUFRT1RnQVVERXdNek16TnpnNU1ESUFHREV5T1EACHA&amp;amp;micros=&quot;;
           adroll_imp_macros = [{&quot;key&quot;: &quot;[ADROLL:MOBILE_ID]&quot;, &quot;value&quot;: &quot;72c9e1696f7716a2218039c6bb043c7d&quot;}];
       &lt;/script&gt;
       &lt;script type=&quot;text/javascript&quot;&gt;
           var _url_info =
                (&#39;https:&#39; == document.location.protocol
                    ? {adserver_hostname:&quot;s.adroll.com&quot;, protocol:&quot;https://&quot;}
                    : {adserver_hostname:&quot;a.adroll.com&quot;, protocol:&quot;http://&quot;}
                );

           (function () {
               document.write(&#39;&lt;scr&#39;+&#39;ipt type=&quot;text/javascript&quot; src=&quot;&#39; + _url_info.protocol + _url_info.adserver_hostname + &#39;/j/rolling.js&quot;&gt;&lt;/scr&#39;+&#39;ipt&gt;&#39;);
           }());
       &lt;/script&gt;
    &lt;/div&gt;
    &lt;script&gt;(function(){var g,h=this,aa=function(a,b,c){return a.call.apply(a.bind,arguments)},ba=function(a,b,c){if(!a)throw Error();if(2&lt;arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}},l=function(a,b,c){l=Function.prototype.bind&amp;&amp;-1!=Function.prototype.bind.toString().indexOf(&quot;native code&quot;)?aa:ba;return l.apply(null,arguments)},m=Date.now||function(){return+new Date};var n=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},p=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var q=function(a){return Array.prototype.concat.apply(Array.prototype,arguments)},ca=function(a){var b=a.length;if(0&lt;b){for(var c=Array(b),d=0;d&lt;b;d++)c[d]=a[d];return c}return[]};var r;a:{var t=h.navigator;if(t){var u=t.userAgent;if(u){r=u;break a}}r=&quot;&quot;}var v=function(a){return-1!=r.indexOf(a)};var w=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&amp;&amp;a.attachEvent(&quot;on&quot;+b,c)};var da=v(&quot;Opera&quot;)||v(&quot;OPR&quot;),x=v(&quot;Trident&quot;)||v(&quot;MSIE&quot;),ea=v(&quot;Edge&quot;),y=v(&quot;Gecko&quot;)&amp;&amp;!(-1!=r.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!v(&quot;Edge&quot;))&amp;&amp;!(v(&quot;Trident&quot;)||v(&quot;MSIE&quot;))&amp;&amp;!v(&quot;Edge&quot;),fa=-1!=r.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!v(&quot;Edge&quot;),ga=function(){var a=r;if(y)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ea)return/Edge\/([\d\.]+)/.exec(a);if(x)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(fa)return/WebKit\/(\S+)/.exec(a)},z=function(){var a=h.document;return a?a.documentMode:void 0},A=function(){if(da&amp;&amp;h.opera){var a;var b=h.opera.version;try{a=b()}catch(c){a=b}return a}a=&quot;&quot;;(b=ga())&amp;&amp;(a=b?b[1]:&quot;&quot;);return x&amp;&amp;(b=z(),b&gt;parseFloat(a))?String(b):a}(),D={},E=function(a){if(!D[a]){for(var b=0,c=n(String(A)).split(&quot;.&quot;),d=n(String(a)).split(&quot;.&quot;),e=Math.max(c.length,d.length),f=0;0==b&amp;&amp;f&lt;e;f++){var k=c[f]||&quot;&quot;,pa=d[f]||&quot;&quot;,qa=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),ra=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var B=qa.exec(k)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],C=ra.exec(pa)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==B[0].length&amp;&amp;0==C[0].length)break;b=p(0==B[1].length?0:parseInt(B[1],10),0==C[1].length?0:parseInt(C[1],10))||p(0==B[2].length,0==C[2].length)||p(B[2],C[2])}while(0==b)}D[a]=0&lt;=b}},ha=h.document,ia=ha&amp;&amp;x?z()||(&quot;CSS1Compat&quot;==ha.compatMode?parseInt(A,10):5):void 0;var F;if(!(F=!y&amp;&amp;!x)){var G;if(G=x)G=9&lt;=ia;F=G}F||y&amp;&amp;E(&quot;1.9.1&quot;);x&amp;&amp;E(&quot;9&quot;);var H=document,I=window;var ka=&quot;StopIteration&quot;in h?h.StopIteration:{message:&quot;StopIteration&quot;,stack:&quot;&quot;},J=function(){};J.prototype.next=function(){throw ka;};J.prototype.W=function(){return this};var K=function(a,b){this.m={};this.i=[];this.J=this.h=0;var c=arguments.length;if(1&lt;c){if(c%2)throw Error(&quot;Uneven number of arguments&quot;);for(var d=0;d&lt;c;d+=2)this.set(arguments[d],arguments[d+1])}else a&amp;&amp;this.addAll(a)};K.prototype.v=function(){L(this);for(var a=[],b=0;b&lt;this.i.length;b++)a.push(this.m[this.i[b]]);return a};K.prototype.B=function(){L(this);return this.i.concat()};K.prototype.A=function(a){return M(this.m,a)};K.prototype.remove=function(a){return M(this.m,a)?(delete this.m[a],this.h--,this.J++,this.i.length&gt;2*this.h&amp;&amp;L(this),!0):!1};var L=function(a){if(a.h!=a.i.length){for(var b=0,c=0;b&lt;a.i.length;){var d=a.i[b];M(a.m,d)&amp;&amp;(a.i[c++]=d);b++}a.i.length=c}if(a.h!=a.i.length){for(var e={},c=b=0;b&lt;a.i.length;)d=a.i[b],M(e,d)||(a.i[c++]=d,e[d]=1),b++;a.i.length=c}};g=K.prototype;g.get=function(a,b){return M(this.m,a)?this.m[a]:b};g.set=function(a,b){M(this.m,a)||(this.h++,this.i.push(a),this.J++);this.m[a]=b};g.addAll=function(a){var b;if(a instanceof K)b=a.B(),a=a.v();else{b=[];var c=0,d;for(d in a)b[c++]=d;c=[];d=0;for(var e in a)c[d++]=a[e];a=c}for(e=0;e&lt;b.length;e++)this.set(b[e],a[e])};g.forEach=function(a,b){for(var c=this.B(),d=0;d&lt;c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};g.clone=function(){return new K(this)};g.W=function(a){L(this);var b=0,c=this.J,d=this,e=new J;e.next=function(){if(c!=d.J)throw Error(&quot;The map has changed since the iterator was created&quot;);if(b&gt;=d.i.length)throw ka;var e=d.i[b++];return a?e:d.m[e]};return e};var M=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};var la=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,ma=function(a,b){if(a)for(var c=a.split(&quot;&amp;&quot;),d=0;d&lt;c.length;d++){var e=c[d].indexOf(&quot;=&quot;),f=null,k=null;0&lt;=e?(f=c[d].substring(0,e),k=c[d].substring(e+1)):f=c[d];b(f,k?decodeURIComponent(k.replace(/\+/g,&quot; &quot;)):&quot;&quot;)}};var N=function(a,b){this.u=this.I=this.w=&quot;&quot;;this.H=null;this.F=this.D=&quot;&quot;;this.l=this.Z=!1;var c;if(a instanceof N)this.l=void 0!==b?b:a.l,na(this,a.w),c=a.I,O(this),this.I=c,c=a.u,O(this),this.u=c,oa(this,a.H),c=a.D,O(this),this.D=c,sa(this,a.o.clone()),c=a.F,O(this),this.F=c;else if(a&amp;&amp;(c=String(a).match(la))){this.l=!!b;na(this,c[1]||&quot;&quot;,!0);var d=c[2]||&quot;&quot;;O(this);this.I=P(d);d=c[3]||&quot;&quot;;O(this);this.u=P(d,!0);oa(this,c[4]);d=c[5]||&quot;&quot;;O(this);this.D=P(d,!0);sa(this,c[6]||&quot;&quot;,!0);c=c[7]||&quot;&quot;;O(this);this.F=P(c)}else this.l=!!b,this.o=new Q(null,0,this.l)};N.prototype.toString=function(){var a=[],b=this.w;b&amp;&amp;a.push(R(b,ta,!0),&quot;:&quot;);var c=this.u;if(c||&quot;file&quot;==b)a.push(&quot;//&quot;),(b=this.I)&amp;&amp;a.push(R(b,ta,!0),&quot;@&quot;),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,&quot;%$1&quot;)),c=this.H,null!=c&amp;&amp;a.push(&quot;:&quot;,String(c));if(c=this.D)this.u&amp;&amp;&quot;/&quot;!=c.charAt(0)&amp;&amp;a.push(&quot;/&quot;),a.push(R(c,&quot;/&quot;==c.charAt(0)?ua:va,!0));(c=this.o.toString())&amp;&amp;a.push(&quot;?&quot;,c);(c=this.F)&amp;&amp;a.push(&quot;#&quot;,R(c,wa));return a.join(&quot;&quot;)};N.prototype.clone=function(){return new N(this)};var na=function(a,b,c){O(a);a.w=c?P(b,!0):b;a.w&amp;&amp;(a.w=a.w.replace(/:$/,&quot;&quot;))},oa=function(a,b){O(a);if(b){b=Number(b);if(isNaN(b)||0&gt;b)throw Error(&quot;Bad port number &quot;+b);a.H=b}else a.H=null},sa=function(a,b,c){O(a);b instanceof Q?(a.o=b,a.o.N(a.l)):(c||(b=R(b,xa)),a.o=new Q(b,0,a.l))},O=function(a){if(a.Z)throw Error(&quot;Tried to modify a read-only Uri&quot;);};N.prototype.N=function(a){this.l=a;this.o&amp;&amp;this.o.N(a);return this};var P=function(a,b){return a?b?decodeURI(a.replace(/%25/g,&quot;%2525&quot;)):decodeURIComponent(a):&quot;&quot;},R=function(a,b,c){return&quot;string&quot;==typeof a?(a=encodeURI(a).replace(b,ya),c&amp;&amp;(a=a.replace(/%25([0-9a-fA-F]{2})/g,&quot;%$1&quot;)),a):null},ya=function(a){a=a.charCodeAt(0);return&quot;%&quot;+(a&gt;&gt;4&amp;15).toString(16)+(a&amp;15).toString(16)},ta=/[#\/\?@]/g,va=/[\#\?:]/g,ua=/[\#\?]/g,xa=/[\#\?@]/g,wa=/#/g,Q=function(a,b,c){this.h=this.g=null;this.j=a||null;this.l=!!c},S=function(a){a.g||(a.g=new K,a.h=0,a.j&amp;&amp;ma(a.j,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g,&quot; &quot;)),c)}))};g=Q.prototype;g.add=function(a,b){S(this);this.j=null;a=T(this,a);var c=this.g.get(a);c||this.g.set(a,c=[]);c.push(b);this.h++;return this};g.remove=function(a){S(this);a=T(this,a);return this.g.A(a)?(this.j=null,this.h-=this.g.get(a).length,this.g.remove(a)):!1};g.A=function(a){S(this);a=T(this,a);return this.g.A(a)};g.B=function(){S(this);for(var a=this.g.v(),b=this.g.B(),c=[],d=0;d&lt;b.length;d++)for(var e=a[d],f=0;f&lt;e.length;f++)c.push(b[d]);return c};g.v=function(a){S(this);var b=[];if(&quot;string&quot;==typeof a)this.A(a)&amp;&amp;(b=q(b,this.g.get(T(this,a))));else{a=this.g.v();for(var c=0;c&lt;a.length;c++)b=q(b,a[c])}return b};g.set=function(a,b){S(this);this.j=null;a=T(this,a);this.A(a)&amp;&amp;(this.h-=this.g.get(a).length);this.g.set(a,[b]);this.h++;return this};g.get=function(a,b){var c=a?this.v(a):[];return 0&lt;c.length?String(c[0]):b};g.toString=function(){if(this.j)return this.j;if(!this.g)return&quot;&quot;;for(var a=[],b=this.g.B(),c=0;c&lt;b.length;c++)for(var d=b[c],e=encodeURIComponent(String(d)),d=this.v(d),f=0;f&lt;d.length;f++){var k=e;&quot;&quot;!==d[f]&amp;&amp;(k+=&quot;=&quot;+encodeURIComponent(String(d[f])));a.push(k)}return this.j=a.join(&quot;&amp;&quot;)};g.clone=function(){var a=new Q;a.j=this.j;this.g&amp;&amp;(a.g=this.g.clone(),a.h=this.h);return a};var T=function(a,b){var c=String(b);a.l&amp;&amp;(c=c.toLowerCase());return c};Q.prototype.N=function(a){a&amp;&amp;!this.l&amp;&amp;(S(this),this.j=null,this.g.forEach(function(a,c){var d=c.toLowerCase();c!=d&amp;&amp;(this.remove(c),this.remove(d),0&lt;a.length&amp;&amp;(this.j=null,this.g.set(T(this,d),ca(a)),this.h+=a.length))},this));this.l=a};var W=function(a,b,c,d,e,f,k){U(H.hidden)?(this.C=&quot;hidden&quot;,this.K=&quot;visibilitychange&quot;):U(H.mozHidden)?(this.C=&quot;mozHidden&quot;,this.K=&quot;mozvisibilitychange&quot;):U(H.msHidden)?(this.C=&quot;msHidden&quot;,this.K=&quot;msvisibilitychange&quot;):U(H.webkitHidden)&amp;&amp;(this.C=&quot;webkitHidden&quot;,this.K=&quot;webkitvisibilitychange&quot;);this.M=!1;this.s=a;this.G=-1;this.T=b;this.V=c;this.$=d;this.X=f;this.P=k?&quot;mousedown&quot;:&quot;click&quot;;e&amp;&amp;H[this.C]&amp;&amp;V(this,2);this.O=this.R=this.L=null;a=l(this.Y,this);w(H,this.K,a);za(this)};W.prototype.Y=function(){if(H[this.C])this.M&amp;&amp;(this.S(),this.G=m(),V(this,0));else{if(-1!=this.G){var a=m()-this.G;this.G=-1;V(this,1,a);null!==this.s&amp;&amp;this.s.registerFinalizeCallback(l(this.s.fireOnObject,this.s,&quot;attempt_survey_trigger&quot;,[&quot;wfocus&quot;,this.V,this.T,this.L,this.R,this.O,a]))}this.X&amp;&amp;V(this,3)}};var za=function(a){if(null!==a.s){var b=l(function(a,b){this.L=b.ca().ba();if(!this.L){var c=new N(b.aa());this.L=c.u+c.D}this.R=b.creativeConversionUrl();this.O=b.adGroupCreativeId();this.U()},a),c=a.P;a.s.forEachAd(function(a){a.forEachNavigationAdPiece(function(d){a.listen(d,c,b)})})}else{var d=l(a.U,a);w(I,a.P,d)}};W.prototype.U=function(){this.M=!0;var a=l(this.S,this);I.setTimeout(a,5E3)};W.prototype.S=function(){this.M=!1};var V=function(a,b,c){a=[&quot;//&quot;,a.$?&quot;googleads.g.doubleclick.net&quot;:&quot;pagead2.googlesyndication.com&quot;,&quot;/pagead/gen_204?id=wfocus&quot;,&quot;&amp;gqid=&quot;+a.T,&quot;&amp;qqid=&quot;+a.V].join(&quot;&quot;);0==b&amp;&amp;(a+=&quot;&amp;return=0&quot;);1==b&amp;&amp;(a+=&quot;&amp;return=1&amp;timeDelta=&quot;+c);2==b&amp;&amp;(a+=&quot;&amp;bgload=1&quot;);3==b&amp;&amp;(a+=&quot;&amp;fg=1&quot;);I.google_image_requests||(I.google_image_requests=[]);b=I.document.createElement(&quot;img&quot;);b.src=a;I.google_image_requests.push(b)},U=function(a){return&quot;undefined&quot;!==typeof a};var Aa=function(a,b,c,d,e,f){return new W(null,a,b,c,d,e,f)},X=[&quot;wfocusnhinit&quot;],Y=h;X[0]in Y||!Y.execScript||Y.execScript(&quot;var &quot;+X[0]);for(var Z;X.length&amp;&amp;(Z=X.shift());)X.length||void 0===Aa?Y=Y[Z]?Y[Z]:Y[Z]={}:Y[Z]=Aa;}).call(this);wfocusnhinit(&quot;7bl4VuDBD4-2fNGsjBA&quot;,&quot;CNvKkpi67skCFZYoHwod6VAKIQ&quot;,true,true,true,false);&lt;/script&gt;&lt;iframe scrolling=&quot;no&quot; frameborder=0 height=0 width=0 src=&quot;https://cm.g.doubleclick.net/push?client=ca-pub-3558870564527416&quot; style=&quot;position:absolute&quot;&gt;&lt;/iframe&gt;&lt;script type=&quot;text/javascript&quot;&gt;(function(){var h=this,aa=function(a){var b=typeof a;if(&quot;object&quot;==b)if(a){if(a instanceof Array)return&quot;array&quot;;if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if(&quot;[object Window]&quot;==c)return&quot;object&quot;;if(&quot;[object Array]&quot;==c||&quot;number&quot;==typeof a.length&amp;&amp;&quot;undefined&quot;!=typeof a.splice&amp;&amp;&quot;undefined&quot;!=typeof a.propertyIsEnumerable&amp;&amp;!a.propertyIsEnumerable(&quot;splice&quot;))return&quot;array&quot;;if(&quot;[object Function]&quot;==c||&quot;undefined&quot;!=typeof a.call&amp;&amp;&quot;undefined&quot;!=typeof a.propertyIsEnumerable&amp;&amp;!a.propertyIsEnumerable(&quot;call&quot;))return&quot;function&quot;}else return&quot;null&quot;;else if(&quot;function&quot;==b&amp;&amp;&quot;undefined&quot;==typeof a.call)return&quot;object&quot;;return b},k=function(a){return&quot;string&quot;==typeof a},ba=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}},m=Date.now||function(){return+new Date},n=function(a,b){var c=a.split(&quot;.&quot;),d=h;c[0]in d||!d.execScript||d.execScript(&quot;var &quot;+c[0]);for(var e;c.length&amp;&amp;(e=c.shift());)c.length||void 0===b?d=d[e]?d[e]:d[e]={}:d[e]=b};var p=function(a,b,c,d,e){if(e)c=a+(&quot;&amp;&quot;+b+&quot;=&quot;+c);else{var f=&quot;&amp;&quot;+b+&quot;=&quot;,g=a.indexOf(f);0&gt;g?c=a+f+c:(g+=f.length,f=a.indexOf(&quot;&amp;&quot;,g),c=0&lt;=f?a.substring(0,g)+c+a.substring(f):a.substring(0,g)+c)}return 2E3&lt;c.length?void 0!==d?p(a,b,d,void 0,e):a:c};var ca=function(){var a=/[&amp;\?]exk=([^&amp; ]+)/.exec(q.location.href);return a&amp;&amp;2==a.length?a[1]:null};var r=function(a,b){this.width=a;this.height=b};r.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};var da=function(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&amp;&amp;b.call(void 0,a[c],c,a)},fa=function(){var a=ea;if(!a)return&quot;&quot;;var b=/.*[&amp;#?]google_debug(=[^&amp;]*)?(&amp;.*)?$/;try{var c=b.exec(decodeURIComponent(a));if(c)return c[1]&amp;&amp;1&lt;c[1].length?c[1].substring(1):&quot;true&quot;}catch(d){}return&quot;&quot;};var ga=function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&amp;&amp;a.attachEvent(&quot;on&quot;+b,c)};var ha=function(a){var b=&quot;&quot;;da(a,function(a,d){if(0===a||a)b+=&quot;&amp;&quot;+d+&quot;=&quot;+encodeURIComponent(String(a))});return b},ia=function(a,b,c){a.google_image_requests||(a.google_image_requests=[]);var d=a.document.createElement(&quot;img&quot;);if(c){var e=function(a){c(a);a=e;d.removeEventListener?d.removeEventListener(&quot;load&quot;,a,!1):d.detachEvent&amp;&amp;d.detachEvent(&quot;onload&quot;,a);a=e;d.removeEventListener?d.removeEventListener(&quot;error&quot;,a,!1):d.detachEvent&amp;&amp;d.detachEvent(&quot;onerror&quot;,a)};ga(d,&quot;load&quot;,e);ga(d,&quot;error&quot;,e)}d.src=b;a.google_image_requests.push(d)};var ja=function(a,b,c){this.v=a;this.u=b;this.c=c;this.f=null;this.s=this.g;this.A=!1},ka=function(a,b,c){this.message=a;this.fileName=b||&quot;&quot;;this.lineNumber=c||-1},ma=function(a,b,c){var d;try{d=c()}catch(g){var e=a.c;try{var f=la(g),e=a.s.call(a,b,f,void 0,void 0)}catch(l){a.g(&quot;pAR&quot;,l)}if(!e)throw g;}finally{}return d},t=function(a,b){var c=na;return function(){var d=arguments;return ma(c,a,function(){return b.apply(void 0,d)})}};ja.prototype.g=function(a,b,c,d,e){var f={};f.context=a;b instanceof ka||(b=la(b));f.msg=b.message.substring(0,512);b.fileName&amp;&amp;(f.file=b.fileName);0&lt;b.lineNumber&amp;&amp;(f.line=b.lineNumber.toString());a=h.document;f.url=a.URL.substring(0,512);f.ref=a.referrer.substring(0,512);if(this.f)try{this.f(f)}catch(l){}if(d)try{d(f)}catch(l){}d=this.v;try{if((this.A?d.w:Math.random())&lt;(c||d.o)){var g=d.m+(e||this.u)+ha(f),g=g.substring(0,2E3);ia(h,g)}}catch(l){}return this.c};var la=function(a){var b=a.toString();a.name&amp;&amp;-1==b.indexOf(a.name)&amp;&amp;(b+=&quot;: &quot;+a.name);a.message&amp;&amp;-1==b.indexOf(a.message)&amp;&amp;(b+=&quot;: &quot;+a.message);if(a.stack){var c=a.stack,d=b;try{-1==c.indexOf(d)&amp;&amp;(c=d+&quot;\n&quot;+c);for(var e;c!=e;)e=c,c=c.replace(/((https?:\/..*\/)[^\/:]*:\d+(?:.|\n)*)\2/,&quot;$1&quot;);b=c.replace(/\n */g,&quot;\n&quot;)}catch(f){b=d}}return new ka(b,a.fileName,a.lineNumber)};var oa=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,&quot;&quot;)},pa=function(a,b){return a&lt;b?-1:a&gt;b?1:0};var qa=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0&gt;c?Math.max(0,a.length+c):c;if(k(a))return k(b)&amp;&amp;1==b.length?a.indexOf(b,c):-1;for(;c&lt;a.length;c++)if(c in a&amp;&amp;a[c]===b)return c;return-1},ra=Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=k(a)?a.split(&quot;&quot;):a,g=0;g&lt;d;g++)g in f&amp;&amp;(e[g]=b.call(c,f[g],g,a));return e};var sa=function(a,b){for(var c in a)b.call(void 0,a[c],c,a)};var v;a:{var ta=h.navigator;if(ta){var ua=ta.userAgent;if(ua){v=ua;break a}}v=&quot;&quot;}var w=function(a){return-1!=v.indexOf(a)};var x=function(){return w(&quot;Opera&quot;)||w(&quot;OPR&quot;)},va=function(){return(w(&quot;Chrome&quot;)||w(&quot;CriOS&quot;))&amp;&amp;!x()&amp;&amp;!w(&quot;Edge&quot;)};var wa=function(){return w(&quot;iPhone&quot;)&amp;&amp;!w(&quot;iPod&quot;)&amp;&amp;!w(&quot;iPad&quot;)};var xa=x(),y=w(&quot;Trident&quot;)||w(&quot;MSIE&quot;),ya=w(&quot;Edge&quot;),z=w(&quot;Gecko&quot;)&amp;&amp;!(-1!=v.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!w(&quot;Edge&quot;))&amp;&amp;!(w(&quot;Trident&quot;)||w(&quot;MSIE&quot;))&amp;&amp;!w(&quot;Edge&quot;),za=-1!=v.toLowerCase().indexOf(&quot;webkit&quot;)&amp;&amp;!w(&quot;Edge&quot;),Aa=function(){var a=v;if(z)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ya)return/Edge\/([\d\.]+)/.exec(a);if(y)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(za)return/WebKit\/(\S+)/.exec(a)},Ba=function(){var a=h.document;return a?a.documentMode:void 0},Ca=function(){if(xa&amp;&amp;h.opera){var a;var b=h.opera.version;try{a=b()}catch(c){a=b}return a}a=&quot;&quot;;(b=Aa())&amp;&amp;(a=b?b[1]:&quot;&quot;);return y&amp;&amp;(b=Ba(),b&gt;parseFloat(a))?String(b):a}(),Da={},A=function(a){var b;if(!(b=Da[a])){b=0;for(var c=oa(String(Ca)).split(&quot;.&quot;),d=oa(String(a)).split(&quot;.&quot;),e=Math.max(c.length,d.length),f=0;0==b&amp;&amp;f&lt;e;f++){var g=c[f]||&quot;&quot;,l=d[f]||&quot;&quot;,V=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;),u=RegExp(&quot;(\\d*)(\\D*)&quot;,&quot;g&quot;);do{var M=V.exec(g)||[&quot;&quot;,&quot;&quot;,&quot;&quot;],N=u.exec(l)||[&quot;&quot;,&quot;&quot;,&quot;&quot;];if(0==M[0].length&amp;&amp;0==N[0].length)break;b=pa(0==M[1].length?0:parseInt(M[1],10),0==N[1].length?0:parseInt(N[1],10))||pa(0==M[2].length,0==N[2].length)||pa(M[2],N[2])}while(0==b)}b=Da[a]=0&lt;=b}return b},Ea=h.document,Fa=Ea&amp;&amp;y?Ba()||(&quot;CSS1Compat&quot;==Ea.compatMode?parseInt(Ca,10):5):void 0;!z&amp;&amp;!y||y&amp;&amp;9&lt;=Fa||z&amp;&amp;A(&quot;1.9.1&quot;);y&amp;&amp;A(&quot;9&quot;);var B=document,q=window;var C=null;function D(a){return&quot;function&quot;==typeof encodeURIComponent?encodeURIComponent(a):escape(a)}var E=function(a,b){ia(a,b,void 0)},Ga=function(){if(!B.body)return!1;if(!C){var a=B.createElement(&quot;iframe&quot;);a.style.display=&quot;none&quot;;a.id=&quot;anonIframe&quot;;C=a;B.body.appendChild(a)}return!0},Ha={};var na;na=new ja(new function(){this.m=&quot;http&quot;+(&quot;http:&quot;==q.location.protocol?&quot;&quot;:&quot;s&quot;)+&quot;://pagead2.googlesyndication.com/pagead/gen_204?id=&quot;;this.o=.01;this.w=Math.random()},&quot;jserror&quot;,!0);var F=function(a,b){return t(a,b)};y&amp;&amp;A(&quot;9&quot;);!za||A(&quot;528&quot;);z&amp;&amp;A(&quot;1.9b&quot;)||y&amp;&amp;A(&quot;8&quot;)||xa&amp;&amp;A(&quot;9.5&quot;)||za&amp;&amp;A(&quot;528&quot;);z&amp;&amp;!A(&quot;8&quot;)||y&amp;&amp;A(&quot;9&quot;);var Ia=function(a,b,c){if(&quot;array&quot;==aa(b))for(var d=0;d&lt;b.length;d++)Ia(a,String(b[d]),c);else null!=b&amp;&amp;c.push(&quot;&amp;&quot;,a,&quot;&quot;===b?&quot;&quot;:&quot;=&quot;,encodeURIComponent(String(b)))},Ja=function(a,b,c){for(c=c||0;c&lt;b.length;c+=2)Ia(b[c],b[c+1],a);return a},Ka=function(a,b){var c=2==arguments.length?Ja([a],arguments[1],0):Ja([a],arguments,1);if(c[1]){var d=c[0],e=d.indexOf(&quot;#&quot;);0&lt;=e&amp;&amp;(c.push(d.substr(e)),c[0]=d=d.substr(0,e));e=d.indexOf(&quot;?&quot;);0&gt;e?c[1]=&quot;?&quot;:e==d.length-1&amp;&amp;(c[1]=void 0)}return c.join(&quot;&quot;)};var La=0,G={},Na=function(a){var b=G.imageLoadingEnabled;if(null!=b)a(b);else{var c=!1;Ma(function(b,e){delete G[e];c||(c=!0,null!=G.imageLoadingEnabled||(G.imageLoadingEnabled=b),a(b))})}},Ma=function(a){var b=new Image,c,d=&quot;&quot;+La++;G[d]=b;b.onload=function(){clearTimeout(c);a(!0,d)};c=setTimeout(function(){a(!1,d)},300);b.src=&quot;data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==&quot;},Oa=function(a){if(a){var b=document.createElement(&quot;OBJECT&quot;);b.data=a;b.width=1;b.height=1;b.style.visibility=&quot;hidden&quot;;var c=&quot;&quot;+La++;G[c]=b;b.onload=b.onerror=function(){delete G[c]};document.body.appendChild(b)}},Pa=function(a){if(a){var b=new Image,c=&quot;&quot;+La++;G[c]=b;b.onload=b.onerror=function(){delete G[c]};b.src=a}},Qa=function(a){Na(function(b){b?Pa(a):Oa(a)})};var Ra={l:&quot;ud=1&quot;,j:&quot;ts=0&quot;,B:&quot;sc=1&quot;,h:&quot;gz=1&quot;,i:&quot;op=1&quot;};if(B&amp;&amp;B.URL){var ea=B.URL,Sa=!(ea&amp;&amp;0&lt;fa().length);na.c=Sa}var H=function(a,b,c,d){ga(a,b,t(d||&quot;osd_or_lidar::&quot;+b,c),void 0)},Ta=function(a,b,c){if(!(0&gt;=b)){var d=0,e=function(){a();d++;d&lt;b&amp;&amp;q.setTimeout(t(c,e),100)};e()}};var I=function(a,b){this.b=a||0;this.a=b||&quot;&quot;},J=function(a,b){a.b&amp;&amp;(b[4]=a.b);a.a&amp;&amp;(b[12]=a.a)};I.prototype.match=function(a){return(this.b||this.a)&amp;&amp;(a.b||a.a)?this.a||a.a?this.a==a.a:this.b||a.b?this.b==a.b:!1:!1};I.prototype.toString=function(){var a=&quot;&quot;+this.b;this.a&amp;&amp;(a+=&quot;-&quot;+this.a);return a};var Ua=function(){var a=K,b=[];a.b&amp;&amp;b.push(&quot;adk=&quot;+a.b);a.a&amp;&amp;b.push(&quot;exk=&quot;+a.a);return b},L=function(a){var b=[];sa(a,function(a,d){var e=D(d),f=a;k(f)&amp;&amp;(f=D(f));b.push(e+&quot;=&quot;+f)});return b.join(&quot;\n&quot;)},Va=0,Wa=0,Xa=function(a){var b=0,c=q;try{if(c&amp;&amp;c.Goog_AdSense_getAdAdapterInstance)return c}catch(d){}for(;c&amp;&amp;5&gt;b;){try{if(c.google_osd_static_frame)return c}catch(d){}try{if(c.aswift_0&amp;&amp;(!a||c.aswift_0.google_osd_static_frame))return c.aswift_0}catch(d){}b++;c=c!=c.parent?c.parent:null}return null},Ya=function(a,b,c,d,e){if(10&lt;Wa)q.clearInterval(Va);else if(++Wa,q.postMessage&amp;&amp;(b.b||b.a)){var f=Xa(!0);if(f){var g={};J(b,g);g[0]=&quot;goog_request_monitoring&quot;;g[6]=a;g[16]=c;d&amp;&amp;d.length&amp;&amp;(g[17]=d.join(&quot;,&quot;));e&amp;&amp;(g[19]=e);try{var l=L(g);f.postMessage(l,&quot;*&quot;)}catch(V){}}}},Za=function(a){var b=Xa(!1),c=!b;!b&amp;&amp;q&amp;&amp;(b=q.parent);if(b&amp;&amp;b.postMessage)try{b.postMessage(a,&quot;*&quot;),c&amp;&amp;q.postMessage(a,&quot;*&quot;)}catch(d){}};var O=!1,$a=function(a){if(a=a.match(/[\d]+/g))a.length=3};(function(){if(navigator.plugins&amp;&amp;navigator.plugins.length){var a=navigator.plugins[&quot;Shockwave Flash&quot;];if(a&amp;&amp;(O=!0,a.description)){$a(a.description);return}if(navigator.plugins[&quot;Shockwave Flash 2.0&quot;]){O=!0;return}}if(navigator.mimeTypes&amp;&amp;navigator.mimeTypes.length&amp;&amp;(O=(a=navigator.mimeTypes[&quot;application/x-shockwave-flash&quot;])&amp;&amp;a.enabledPlugin)){$a(a.enabledPlugin.description);return}try{var b=new ActiveXObject(&quot;ShockwaveFlash.ShockwaveFlash.7&quot;);O=!0;$a(b.GetVariable(&quot;$version&quot;));return}catch(c){}try{b=new ActiveXObject(&quot;ShockwaveFlash.ShockwaveFlash.6&quot;);O=!0;return}catch(c){}try{b=new ActiveXObject(&quot;ShockwaveFlash.ShockwaveFlash&quot;),O=!0,$a(b.GetVariable(&quot;$version&quot;))}catch(c){}})();var ab=w(&quot;Firefox&quot;),bb=wa()||w(&quot;iPod&quot;),cb=w(&quot;iPad&quot;),db=w(&quot;Android&quot;)&amp;&amp;!(va()||w(&quot;Firefox&quot;)||x()||w(&quot;Silk&quot;)),eb=va(),fb=w(&quot;Safari&quot;)&amp;&amp;!(va()||w(&quot;Coast&quot;)||x()||w(&quot;Edge&quot;)||w(&quot;Silk&quot;)||w(&quot;Android&quot;))&amp;&amp;!(wa()||w(&quot;iPad&quot;)||w(&quot;iPod&quot;));var P=function(a){return(a=a.exec(v))?a[1]:&quot;&quot;};(function(){if(ab)return P(/Firefox\/([0-9.]+)/);if(y||ya||xa)return Ca;if(eb)return P(/Chrome\/([0-9.]+)/);if(fb&amp;&amp;!(wa()||w(&quot;iPad&quot;)||w(&quot;iPod&quot;)))return P(/Version\/([0-9.]+)/);if(bb||cb){var a;if(a=/Version\/(\S+).*Mobile\/(\S+)/.exec(v))return a[1]+&quot;.&quot;+a[2]}else if(db)return(a=P(/Android\s+([0-9.]+)/))?a:P(/Version\/([0-9.]+)/);return&quot;&quot;})();var hb=function(){var a=q.parent&amp;&amp;q.parent!=q,b=a&amp;&amp;0&lt;=&quot;//tpc.googlesyndication.com&quot;.indexOf(q.location.host);if(a&amp;&amp;q.name&amp;&amp;0==q.name.indexOf(&quot;google_ads_iframe&quot;)||b){var c;a=q||q;try{var d;if(a.document&amp;&amp;!a.document.body)d=new r(-1,-1);else{var e=(a||window).document,f=&quot;CSS1Compat&quot;==e.compatMode?e.documentElement:e.body;d=(new r(f.clientWidth,f.clientHeight)).round()}c=d}catch(g){c=new r(-12245933,-12245933)}return gb(c)}c=q.document.getElementsByTagName(&quot;SCRIPT&quot;);return 0&lt;c.length&amp;&amp;(c=c[c.length-1],c.parentElement&amp;&amp;c.parentElement.id&amp;&amp;0&lt;c.parentElement.id.indexOf(&quot;_ad_container&quot;))?gb(void 0,c.parentElement):null},gb=function(a,b){var c=ib(&quot;IMG&quot;,a,b);return c||(c=ib(&quot;IFRAME&quot;,a,b))?c:(c=ib(&quot;OBJECT&quot;,a,b))?c:null},ib=function(a,b,c){var d=document;c=c||d;d=a&amp;&amp;&quot;*&quot;!=a?a.toUpperCase():&quot;&quot;;c=c.querySelectorAll&amp;&amp;c.querySelector&amp;&amp;d?c.querySelectorAll(d+&quot;&quot;):c.getElementsByTagName(d||&quot;*&quot;);for(d=0;d&lt;c.length;d++){var e=c[d];if(&quot;OBJECT&quot;==a)a:{var f=e.getAttribute(&quot;height&quot;);if(null!=f&amp;&amp;0&lt;f&amp;&amp;0==e.clientHeight)for(var f=e.children,g=0;g&lt;f.length;g++){var l=f[g];if(&quot;OBJECT&quot;==l.nodeName||&quot;EMBED&quot;==l.nodeName){e=l;break a}}}f=e.clientHeight;g=e.clientWidth;if(l=b)l=new r(g,f),l=Math.abs(b.width-l.width)&lt;.1*b.width&amp;&amp;Math.abs(b.height-l.height)&lt;.1*b.height;if(l||!b&amp;&amp;10&lt;f&amp;&amp;10&lt;g)return e}return null};var jb,Q=0,R=&quot;&quot;,S=!1,T=!1,U=!1,kb=!0,lb=!1,mb=!1,nb=!1,ob=!1,pb=!1,qb=&quot;&quot;,rb=0,sb=0,W=0,tb=[],K=null,ub=&quot;&quot;,vb=[],wb=null,xb=[],yb=!1,zb=&quot;&quot;,Ab=&quot;&quot;,Bb=(new Date).getTime(),Cb=!1,Db=&quot;&quot;,Eb=!1,Fb=[&quot;1&quot;,&quot;0&quot;,&quot;3&quot;],X=0,Y=0,Gb=0,Hb=&quot;&quot;,Jb=function(a,b,c){S&amp;&amp;(kb||3!=(c||3)||nb)&amp;&amp;Ib(a,b,!0);if(U||T&amp;&amp;mb)Ib(a,b),T=U=!1},Kb=function(){var a=wb;return a?2!=a():!0},Ib=function(a,b,c){(b=b||ub)&amp;&amp;!yb&amp;&amp;(2==Y||c)&amp;&amp;Kb()&amp;&amp;(b=Lb(b,c),lb?Qa(b):E(a,b),pb=!0,c?S=!1:yb=!0)},Lb=function(a,b){var c;c=b?&quot;osdim&quot;:U?&quot;osd2&quot;:&quot;osdtos&quot;;var d=[&quot;//pagead2.googlesyndication.com/activeview&quot;,&quot;?id=&quot;,c];&quot;osd2&quot;==c&amp;&amp;T&amp;&amp;mb&amp;&amp;d.push(&quot;&amp;ts=1&quot;);R&amp;&amp;d.push(&quot;&amp;avi=&quot;,R);jb&amp;&amp;d.push(&quot;&amp;cid=&quot;,jb);d.push(&quot;&amp;ti=1&quot;);d.push(&quot;&amp;&quot;,a);d.push(&quot;&amp;uc=&quot;+Gb);Cb?d.push(&quot;&amp;tgt=&quot;+Db):d.push(&quot;&amp;tgt=nf&quot;);d.push(&quot;&amp;cl=&quot;+(Eb?1:0));&quot;&quot;!=qb&amp;&amp;(d.push(&quot;&amp;lop=1&quot;),c=m()-rb,d.push(&quot;&amp;tslp=&quot;+c));d=d.join(&quot;&quot;);for(c=0;c&lt;vb.length;c++){try{var e=vb[c]()}catch(g){}var f=&quot;max_length&quot;;2&lt;=e.length&amp;&amp;(3==e.length&amp;&amp;(f=e[2]),d=p(d,D(e[0]),D(e[1]),f))}2E3&lt;d.length&amp;&amp;(d=d.substring(0,2E3));return d},Z=function(a,b){if(zb){try{var c=p(zb,&quot;vi&quot;,a);Ga()&amp;&amp;E(C.contentWindow,c)}catch(e){}0&lt;=qa(Fb,a)&amp;&amp;(zb=&quot;&quot;);var c=b||ub,d;d=p(&quot;//pagead2.googlesyndication.com/pagead/gen_204?id=sldb&quot;,&quot;avi&quot;,R);d=p(d,&quot;vi&quot;,a);c&amp;&amp;(d+=&quot;&amp;&quot;+c);try{E(q,d)}catch(e){}}},Mb=function(){Z(&quot;-1&quot;)},Ob=function(a){if(a&amp;&amp;a.data&amp;&amp;k(a.data)){var b;var c=a.data;if(k(c)){b={};for(var c=c.split(&quot;\n&quot;),d=0;d&lt;c.length;d++){var e=c[d].indexOf(&quot;=&quot;);if(!(0&gt;=e)){var f=Number(c[d].substr(0,e)),e=c[d].substr(e+1);switch(f){case 5:case 8:case 11:case 15:case 16:case 18:e=&quot;true&quot;==e;break;case 4:case 7:case 6:case 14:case 20:case 21:case 22:case 23:e=Number(e);break;case 3:case 19:if(&quot;function&quot;==aa(decodeURIComponent))try{e=decodeURIComponent(e)}catch(l){throw Error(&quot;Error: URI malformed: &quot;+e);}break;case 17:e=ra(decodeURIComponent(e).split(&quot;,&quot;),Number)}b[f]=e}}b=b[0]?b:null}else b=null;if(b&amp;&amp;(c=new I(b[4],b[12]),K&amp;&amp;K.match(c))){for(c=0;c&lt;xb.length;c++)xb[c](b);void 0!=b[18]&amp;&amp;(nb=b[18],nb||2!=W||(W=3,Nb()));c=b[0];if(&quot;goog_acknowledge_monitoring&quot;==c)q.clearInterval(Va),X=2;else if(&quot;goog_get_mode&quot;==c){X=1;d={};K&amp;&amp;J(K,d);d[0]=&quot;goog_provide_mode&quot;;d[6]=Y;d[19]=Hb;d[16]=T;try{var g=L(d);a.source.postMessage(g,a.origin)}catch(l){}q.clearInterval(Va);X=2}else&quot;goog_update_data&quot;==c?(ub=b[3],++Gb):&quot;goog_image_request&quot;==c&amp;&amp;(Jb(q,b[3]),b[5]||b[11]||Z(&quot;0&quot;,b[3]));if(&quot;goog_update_data&quot;==c||&quot;goog_image_request&quot;==c)(1==Y||2==Y||S)&amp;&amp;b[5]&amp;&amp;(a=1==b[15]&amp;&amp;&quot;goog_update_data&quot;==c,mb=!0,Z(&quot;1&quot;),Ab&amp;&amp;Kb()&amp;&amp;(g=Ab,Ga()&amp;&amp;E(C.contentWindow,g),Ab=&quot;&quot;),S&amp;&amp;!a&amp;&amp;(Ib(q,void 0,!0),ob=!0,sb=m()),3==W&amp;&amp;(W=4,Nb()),S||1!=Y||(yb=!0)),(1==Y||2==Y||S)&amp;&amp;b[11]&amp;&amp;(T=!1,Z(&quot;3&quot;),S&amp;&amp;(Ib(q,void 0,!0),1==W&amp;&amp;nb&amp;&amp;(W=2)))}}},Nb=function(){var a=q,b=W;0!=b&amp;&amp;1!=b&amp;&amp;Pb(a,&quot;osdim&quot;,&quot;zas=&quot;+b)},Pb=function(a,b,c){b=&quot;//pagead2.googlesyndication.com/pagead/gen_204?id=&quot;+b+&quot;&amp;&quot;;var d=[];d.push(&quot;ovr_value=&quot;+Q);d.push(&quot;avi=&quot;+R);K&amp;&amp;(d=d.concat(Ua()));d.push(&quot;tt=&quot;+((new Date).getTime()-Bb));d.push(c);a.document&amp;&amp;a.document.referrer&amp;&amp;d.push(&quot;ref=&quot;+D(a.document.referrer));b+=d.join(&quot;&amp;&quot;);try{E(a,b)}catch(e){}},Qb=function(){Jb(q);Z(&quot;0&quot;);2&gt;X&amp;&amp;!T&amp;&amp;2==Y&amp;&amp;Pb(q,&quot;osd2&quot;,&quot;hs=&quot;+X)},Rb=function(){var a={};J(K,a);a[0]=&quot;goog_dom_content_loaded&quot;;var b=L(a);try{Ta(function(){Za(b)},10,&quot;osd_listener::ldcl_int&quot;)}catch(c){}},Sb=function(){var a={};J(K,a);a[0]=&quot;goog_creative_loaded&quot;;var b=L(a);Ta(function(){Za(b)},10,&quot;osd_listener::lcel_int&quot;);Eb=!0},Tb=function(a){if(k(a)){a=a.split(&quot;&amp;&quot;);for(var b=a.length-1;0&lt;=b;b--){var c=a[b],d=Ra;c==d.l?(kb=!1,a.splice(b,1)):c==d.h?(W=1,a.splice(b,1)):c==d.j?(T=!1,a.splice(b,1)):c==d.i&amp;&amp;(lb=!0,a.splice(b,1))}Hb=a.join(&quot;&amp;&quot;)}},Ub=function(){if(!Cb){var a=hb();a&amp;&amp;(Cb=!0,Db=a.tagName,a.complete||a.naturalWidth?Sb():H(a,&quot;load&quot;,Sb,&quot;osd_listener::creative_load&quot;))}};n(&quot;osdlfm&quot;,F(&quot;osd_listener::init&quot;,function(a,b,c,d,e,f,g,l,V){Q=a;zb=b;Ab=d;S=f;jb=V;g&amp;&amp;Tb(g);T=f;1==l?tb.push(947190538):2==l?tb.push(947190541):3==l&amp;&amp;tb.push(947190542);K=new I(e,ca());H(q,&quot;load&quot;,Mb,&quot;osd_listener::load&quot;);H(q,&quot;message&quot;,Ob,&quot;osd_listener::message&quot;);R=c||&quot;&quot;;H(q,&quot;unload&quot;,Qb,&quot;osd_listener::unload&quot;);var u=q.document;!u.readyState||&quot;complete&quot;!=u.readyState&amp;&amp;&quot;loaded&quot;!=u.readyState?(&quot;msie&quot;in Ha?Ha.msie:Ha.msie=-1!=navigator.userAgent.toLowerCase().indexOf(&quot;msie&quot;))&amp;&amp;!window.opera?H(u,&quot;readystatechange&quot;,function(){&quot;complete&quot;!=u.readyState&amp;&amp;&quot;loaded&quot;!=u.readyState||Rb()},&quot;osd_listener::rsc&quot;):H(u,&quot;DOMContentLoaded&quot;,Rb,&quot;osd_listener::dcl&quot;):Rb();-1==Q?Y=f?3:1:-2==Q?Y=3:0&lt;Q&amp;&amp;(Y=2,U=!0);T&amp;&amp;!U&amp;&amp;-1==Q&amp;&amp;(Y=2);K&amp;&amp;(K.b||K.a)&amp;&amp;(X=1,Va=q.setInterval(t(&quot;osd_proto::reqm_int&quot;,ba(Ya,Y,K,T,tb,Hb)),500));Ta(Ub,5,&quot;osd_listener:sfc&quot;)}));n(&quot;osdlac&quot;,F(&quot;osd_listener::lac_ex&quot;,function(a){vb.push(a)}));n(&quot;osdlamrc&quot;,F(&quot;osd_listener::lamrc_ex&quot;,function(a){xb.push(a)}));n(&quot;osdsir&quot;,t(&quot;osd_listener::sir_ex&quot;,Jb));n(&quot;osdacrc&quot;,F(&quot;osd_listener::acrc_ex&quot;,function(a){wb=a}));n(&quot;osdpcls&quot;,F(&quot;osd_listener::acrc_ex&quot;,function(a){if(&quot;&quot;==a||q==q.top||yb||pb&amp;&amp;!ob)return!1;qb=a;if(ob){var b=R;R=a;var c=Lb(ub,!0);R=b;b=m()-sb;c=Ka(c,&quot;tsvp&quot;,b);b=q;lb?Qa(c):E(b,c)}R=&quot;&quot;==R?a:R+&quot;,&quot;+a;rb=m();return!0}));}).call(this);osdlfm(-1,&#39;&#39;,&#39;BkHsv7bl4VpugEJbRfOmhqYgCALacq8NNAAAQATgByAEJ4AIA4AQBoAYh&#39;,&#39;&#39;,1033378902,true,&#39;ud\x3d1\x26la\x3d0\x26&#39;,3,&#39;5GiF_uAi8XrTrZMGFMRUw3Zq0pg&#39;);&lt;/script&gt;&lt;img src=&quot;//www.google.com/ads/measurement/l?ebcid=ALh7CaTYvEzOftqz4hQ85pC40z6wprCHBCy-pebvyiZlwui03hSGQUliexKacibCOj79iGNF8RZub5MLUrZ7ILccea0lvwqw6g&quot; style=&quot;display:none;&quot;&gt;&lt;/img&gt;&lt;/body&gt;&lt;/html&gt;{&quot;uid&quot;:1,&quot;hostPeerName&quot;:&quot;http://code.tutsplus.com&quot;,&quot;initialGeometry&quot;:&quot;{\&quot;windowCoords_t\&quot;:0,\&quot;windowCoords_r\&quot;:1280,\&quot;windowCoords_b\&quot;:994,\&quot;windowCoords_l\&quot;:0,\&quot;frameCoords_t\&quot;:197,\&quot;frameCoords_r\&quot;:995.5,\&quot;frameCoords_b\&quot;:287,\&quot;frameCoords_l\&quot;:267.5,\&quot;styleZIndex\&quot;:\&quot;auto\&quot;,\&quot;allowedExpansion_t\&quot;:10,\&quot;allowedExpansion_r\&quot;:116,\&quot;allowedExpansion_b\&quot;:10,\&quot;allowedExpansion_l\&quot;:116,\&quot;xInView\&quot;:1,\&quot;yInView\&quot;:1}&quot;,&quot;permissions&quot;:&quot;{\&quot;expandByOverlay\&quot;:false,\&quot;expandByPush\&quot;:false,\&quot;readCookie\&quot;:false,\&quot;writeCookie\&quot;:false}&quot;,&quot;metadata&quot;:&quot;{\&quot;shared\&quot;:{\&quot;sf_ver\&quot;:\&quot;1-0-2\&quot;,\&quot;ck_on\&quot;:1,\&quot;flash_ver\&quot;:\&quot;20.0.0\&quot;}}&quot;,&quot;reportCreativeGeometry&quot;:false}" scrolling="no" marginwidth="0" marginheight="0" width="728" height="90" data-is-safeframe="true" style="border: 0px; vertical-align: bottom;"></iframe></div></div><div class="ad__label">Advertisement</div></div></div><div class="page-content" style="height: auto;"><main class="content"><div class="section-header view view--loaded"><div class="section-header__navigation"><div class="section-header__topic"><a class="section-header__topic-link topic-link topic-code" href="http://code.tutsplus.com/"><div class="section-header__section-icon section-header__section-icon--tutorials"></div>Code Tutorials</a></div><ul class="section-header__nav-links"><li class="section-header__nav-link section-header__nav-link--dropdown"><div class="section-header__categories-menu"><a class="section-header__categories-menu-toggle" href="javascript:"><span class="section-header__categories-menu-title">Categories</span> <i class="fa fa-chevron-down"></i></a><ul class="section-header__categories-menu-items"><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/web-development">Web Development</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/wordpress">WordPress</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/mobile-development">Mobile Development</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/php">PHP</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/flash">Flash</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/javascript">JavaScript</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/news">News</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/ios-sdk">iOS SDK</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/cms">CMS</a></li><li class="section-header__categories-menu-more"><a class="section-header__categories-menu-link section-header__categories-menu-more-link" href="http://code.tutsplus.com/categories">More...</a></li></ul></div></li><li class="section-header__nav-link section-header__nav-link--direct"><a href="http://code.tutsplus.com/categories">Categories</a></li><li class="section-header__nav-link section-header__nav-link--dropdown"><div class="section-header__learning-guides-menu"><a class="section-header__learning-guides-menu-toggle" href="javascript:"><span class="section-header__learning-guides-menu-title">Learning Guides</span> <i class="fa fa-chevron-down"></i></a><ul class="section-header__learning-guides-menu-items"><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/mobile-wordpress-theming--mobile-22898">Mobile WordPress Theming</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/swift-from-scratch--cms-709">Swift from Scratch</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/the-solid-principles--cms-634">The SOLID Principles</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/the-complete-guide-to-the-wordpress-settings-api--cms-624">The Complete Guide To The WordPress Settings API</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/use-jquery-mobile-to-build-a-native-android-news-reader-app--mobile-22910">Use jQuery Mobile to Build a Native Android News Reader App</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/getting-to-know-backbonejs--net-24408">Getting to Know Backbone.js</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/introduction-to-craft-cms--cms-846">Introduction to Craft CMS</a></li><li class="section-header__learning-guides-menu-more"><a class="section-header__learning-guides-menu-link section-header__learning-guides-menu-more-link" href="http://code.tutsplus.com/series">More...</a></li></ul></div></li><li class="section-header__nav-link section-header__nav-link--direct"><a href="http://code.tutsplus.com/series">Learning Guides</a></li><li class="section-header__nav-link"><a href="https://community.tutsplus.com/">Forum</a></li></ul></div></div><article class="post tutorial"><div class="post__inarticle-ad-template" style="display: none"><div class="ad view ad--inarticle"><div class="ad__wrapper"><div class="ad__content" id="div-gpt-1392179526912-0"><div id="google_ads_iframe_/11757429/hub_development_inarticle_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/11757429/hub_development_inarticle_0" name="google_ads_iframe_/11757429/hub_development_inarticle_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:&quot;&lt;html&gt;&lt;body style=&#39;background:transparent&#39;&gt;&lt;/body&gt;&lt;/html&gt;&quot;" style="border: 0px; vertical-align: bottom;"></iframe></div><iframe id="google_ads_iframe_/11757429/hub_development_inarticle_0__hidden__" name="google_ads_iframe_/11757429/hub_development_inarticle_0__hidden__" width="0" height="0" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:&quot;&lt;html&gt;&lt;body style=&#39;background:transparent&#39;&gt;&lt;/body&gt;&lt;/html&gt;&quot;" style="border: 0px; vertical-align: bottom; visibility: hidden; display: none;"></iframe></div><div class="ad__label">Advertisement</div></div></div></div><div class="layout__offset-content-with-sidebar layout__offset-content-with-sidebar--post"><div class="post__header"><div class="content-header view content-header--post view--loaded"><div class="content-header__category"><a class="content-header__category-link" href="http://code.tutsplus.com/categories/php">PHP</a></div><h1 class="content-header__title nolinks">Creating an Advanced Password Recovery Utility</h1><div class="content-header__publication-meta"><span class="content-header__author-by"></span>by <span class="content-header__author"><a class="content-header__author-link" rel="author" href="http://tutsplus.com/authors/andrew-steenbuck">Andrew Steenbuck</a></span><time class="content-header__publication-date" datetime="2009-05-05T14:57:50Z" title="5 May 2009">5 May 2009</time><span class="content-header__comment-count"><i class="icon tutsicon-comment content-header__comment-icon"></i><a data-disqus-identifier="4741 http://net.tutsplus.com/?p=4741" class="content-header__comment-count-link" href="http://code.tutsplus.com/tutorials/creating-an-advanced-password-recovery-utility--net-4741#disqus_thread">78 Comments</a></span></div><div class="content-header__social-share-links sticky-block--floating"><ul class="social-share-links"><li class="social-share-links__item"><a title="Share on Facebook" class="social-share-links__link social-share-links__link--facebook" href="https://www.facebook.com/dialog/feed?app_id=1494084460809023&amp;link=http%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fcreating-an-advanced-password-recovery-utility--net-4741&amp;display=page&amp;name=Creating%20an%20Advanced%20Password%20Recovery%20Utility&amp;redirect_uri=http%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fcreating-an-advanced-password-recovery-utility--net-4741"><i class="fa fa-facebook-square social-share-links__icon"></i><div class="social-share-links__count">6</div></a></li><li class="social-share-links__item"><a target="_blank" title="Share on Twitter" class="social-share-links__link social-share-links__link--twitter" href="https://twitter.com/intent/tweet?text=Creating%20an%20Advanced%20Password%20Recovery%20Utility&amp;url=http%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fcreating-an-advanced-password-recovery-utility--net-4741&amp;via=tutsplus"><i class="fa fa-twitter social-share-links__icon"></i><div class="social-share-links__count--blank">Share</div></a></li><li class="social-share-links__item"><a target="_blank" title="Share on Google+" class="social-share-links__link social-share-links__link--google-plus" href="https://plus.google.com/share?url=http%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fcreating-an-advanced-password-recovery-utility--net-4741"><i class="fa fa-google-plus social-share-links__icon"></i><div class="social-share-links__count--blank">Share</div></a></li><li class="social-share-links__item"><a target="_blank" title="Pin on Pinterest" class="social-share-links__link social-share-links__link--pinterest" href="https://www.pinterest.com/pin/create/button/?url=http%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fcreating-an-advanced-password-recovery-utility--net-4741&amp;description=Creating%20an%20Advanced%20Password%20Recovery%20Utility&amp;media=https%3A%2F%2Fcdn.tutsplus.com%2Fnet%2Fuploads%2Flegacy%2F315_passwordRecovery%2F200x200.png"><i class="fa fa-pinterest social-share-links__icon"></i><div class="social-share-links__count--blank">Share</div></a></li></ul></div></div></div><div class="post-body view view--loaded"><div class="post-body__body"><script async="" charset="utf-8" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/widgets.js"></script><div class="post-body__content"><p>In my last tutorial, '<a href="http://net.tutsplus.com/tutorials/php/a-better-login-system/" target="_blank">A Better Login System</a>', a few people commented on how they would like to see a tutorial on password recovery, which is something you don't always see in user access tutorials. The tutorial I am bringing you today will deal with just that. Using mySQLi, we will learn to recover unencrypted and (one-way) encrypted passwords.</p>
<p><!--more--></p>
<div class="tutorial_image">
<a href="http://cdn.tutsplus.com/net/uploads/legacy/315_passwordRecovery/passwordRecovery.zip" data-original-url="http://nettuts.s3.amazonaws.com/315_passwordRecovery/passwordRecovery.zip"><img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/button_src_nm.jpg"></a>
</div>
<h3 class="nolinks">Introduction</h3>
<p>Password recovery is always a useful feature to have on your site; however, many tutorials dealing with user authentication neglect this topic. In this tutorial, I will cover handling encrypted and unencrypted passwords, basic mySQLi functions, and we will also build in a temporary lockout if the user answers the security question incorrectly too many times. I hope that by the end of this tutorial, you will have a better understanding of recovering passwords, and the mySQLi interface.</p>
<p>For unencrypted passwords, we will create an email that will email the password to the user's registered email address.</p>
<p>When dealing with encrypted passwords, things are a little more complicated. When a password is encrypted with <strong>md5()</strong>, it can't be decrypted. Because of this, we will send the user an email with a link that will allow them to reset their password. To secure this process we will use a unique email key that will be checked when the user returns to the password page. Our passwords will be encrypted with a <a href="http://en.wikipedia.org/wiki/Salt_(cryptography)" target="_blank">salt</a> to improve security.</p>
<p><strong>IMPORTANT NOTE:</strong> This tutorial uses the mysqli interface instead of mysql. Although the PHP documentation says that it should  work, I was unable to use the mysqli classes successfully until I upgraded from 5.1.4 to 5.2.9. If you are getting errors about using an 'unsupported buffer', try the upgrade. You may also have to change your <span class="skimlinks-unlinked">php.ini</span> file to load the mysqli extension if you see errors about not finding the class mysqli.</p>
<p>Depending on whether your site uses encrypted or unencrypted user passwords, you should follow the directions a little differently. The directions as a whole are for encrypted passwords; but there are special notes here and there for dealing with the regular passwords.</p>
<h3 class="nolinks">Step 1: Database Tables</h3>
<p>After creating a new database, we need to create three tables:</p>
<div class="tutorial_image"><img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/1.jpg" data-original-url="http://nettuts.s3.amazonaws.com/315_passwordRecovery/1.jpg" width="548" height="239" alt="Database tables"></div>
<p>The <strong>recoveryemails_enc</strong> table holds information about the emails that are sent out to allow users to reset passwords (such as the security key, the userID and expiration date). The <strong>users</strong> tables holds the user information. If you are following the encrypted example, use the <strong>users_enc</strong> table, otherwise use the table <strong>users</strong>.</p>
<p>If you already have a table of users, you will need to add security question and answer fields. The question field will hold an integer which equates to a security question in an array, and the answer field holds a varchar answer. The security question is used as verification before sending a password email. Here is the code you should run to create the tables (also available in <span class="skimlinks-unlinked">sql.txt</span> in the download):</p>
<div><div id="highlighter_1062" class="syntaxhighlighter noskimlinks noskimwords sql"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="sql keyword">CREATE</code> <code class="sql keyword">TABLE</code> <code class="sql plain">IF </code><code class="sql color1">NOT</code> <code class="sql plain">EXISTS `recoveryemails_enc` (</code></div><div class="line number2 index1 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`ID` </code><code class="sql keyword">bigint</code><code class="sql plain">(20) unsigned zerofill </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code> <code class="sql plain">auto_increment,</code></div><div class="line number3 index2 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`UserID` </code><code class="sql keyword">bigint</code><code class="sql plain">(20) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number4 index3 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`</code><code class="sql keyword">Key</code><code class="sql plain">` </code><code class="sql keyword">varchar</code><code class="sql plain">(32) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number5 index4 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`expDate` datetime </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number6 index5 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql keyword">PRIMARY</code> <code class="sql keyword">KEY</code>&nbsp; <code class="sql plain">(`ID`)</code></div><div class="line number7 index6 alt2"><code class="sql plain">) ENGINE=InnoDB </code><code class="sql keyword">DEFAULT</code> <code class="sql plain">CHARSET=latin1 AUTO_INCREMENT=1 ;</code></div><div class="line number8 index7 alt1"><code class="sql keyword">CREATE</code> <code class="sql keyword">TABLE</code> <code class="sql plain">IF </code><code class="sql color1">NOT</code> <code class="sql plain">EXISTS `users` (</code></div><div class="line number9 index8 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`ID` </code><code class="sql keyword">bigint</code><code class="sql plain">(20) unsigned zerofill </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code> <code class="sql plain">auto_increment,</code></div><div class="line number10 index9 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`Username` </code><code class="sql keyword">varchar</code><code class="sql plain">(20) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number11 index10 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`Email` </code><code class="sql keyword">varchar</code><code class="sql plain">(255) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number12 index11 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`</code><code class="sql keyword">Password</code><code class="sql plain">` </code><code class="sql keyword">varchar</code><code class="sql plain">(20) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number13 index12 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`secQ` tinyint(4) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number14 index13 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`secA` </code><code class="sql keyword">varchar</code><code class="sql plain">(30) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number15 index14 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql keyword">PRIMARY</code> <code class="sql keyword">KEY</code>&nbsp; <code class="sql plain">(`ID`)</code></div><div class="line number16 index15 alt1"><code class="sql plain">) ENGINE=InnoDB </code><code class="sql keyword">DEFAULT</code> <code class="sql plain">CHARSET=latin1 AUTO_INCREMENT=5 ;</code></div><div class="line number17 index16 alt2"><code class="sql keyword">INSERT</code> <code class="sql keyword">INTO</code> <code class="sql plain">`users` (`ID`, `Username`, `Email`, `</code><code class="sql keyword">Password</code><code class="sql plain">`, `secQ`, `secA`) </code><code class="sql keyword">VALUES</code> <code class="sql plain">(00000000000000000002, </code><code class="sql string">'jDoe'</code><code class="sql plain">, </code><code class="sql string">'jDoe@gmail.com'</code><code class="sql plain">, </code><code class="sql string">'johnDoe2009'</code><code class="sql plain">, 0, </code><code class="sql string">'Smith'</code><code class="sql plain">),</code></div><div class="line number18 index17 alt1"><code class="sql plain">(00000000000000000003, </code><code class="sql string">'envato'</code><code class="sql plain">, </code><code class="sql string">'webmaster@envato.com'</code><code class="sql plain">, </code><code class="sql string">'envatouser'</code><code class="sql plain">, 1, </code><code class="sql string">'Sydney'</code><code class="sql plain">),</code></div><div class="line number19 index18 alt2"><code class="sql plain">(00000000000000000004, </code><code class="sql string">'sToaster'</code><code class="sql plain">, </code><code class="sql string">'toast@yahoo.com'</code><code class="sql plain">, </code><code class="sql string">'toastrules'</code><code class="sql plain">, 3, </code><code class="sql string">'2001'</code><code class="sql plain">);</code></div><div class="line number20 index19 alt1"><code class="sql keyword">CREATE</code> <code class="sql keyword">TABLE</code> <code class="sql plain">IF </code><code class="sql color1">NOT</code> <code class="sql plain">EXISTS `users_enc` (</code></div><div class="line number21 index20 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`ID` </code><code class="sql keyword">bigint</code><code class="sql plain">(20) unsigned zerofill </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code> <code class="sql plain">auto_increment,</code></div><div class="line number22 index21 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`Username` </code><code class="sql keyword">varchar</code><code class="sql plain">(20) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number23 index22 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`</code><code class="sql keyword">Password</code><code class="sql plain">` </code><code class="sql keyword">char</code><code class="sql plain">(32) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number24 index23 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`Email` </code><code class="sql keyword">varchar</code><code class="sql plain">(255) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number25 index24 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`secQ` tinyint(4) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code> <code class="sql keyword">default</code> <code class="sql string">'0'</code><code class="sql plain">,</code></div><div class="line number26 index25 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`secA` </code><code class="sql keyword">varchar</code><code class="sql plain">(32) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number27 index26 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql keyword">PRIMARY</code> <code class="sql keyword">KEY</code>&nbsp; <code class="sql plain">(`ID`)</code></div><div class="line number28 index27 alt1"><code class="sql plain">) ENGINE=InnoDB </code><code class="sql keyword">DEFAULT</code> <code class="sql plain">CHARSET=latin1 AUTO_INCREMENT=4 ;</code></div><div class="line number29 index28 alt2"><code class="sql keyword">INSERT</code> <code class="sql keyword">INTO</code> <code class="sql plain">`users_enc` (`ID`, `Username`, `</code><code class="sql keyword">Password</code><code class="sql plain">`, `Email`, `secQ`, `secA`) </code><code class="sql keyword">VALUES</code> <code class="sql plain">(00000000000000000001, </code><code class="sql string">'jDoe'</code><code class="sql plain">, </code><code class="sql string">'fd2ba57673c57ac5a0650c38fe60b648'</code><code class="sql plain">, </code><code class="sql string">'jDoe@gmail.com'</code><code class="sql plain">, 0, </code><code class="sql string">'Smith'</code><code class="sql plain">),</code></div><div class="line number30 index29 alt1"><code class="sql plain">(00000000000000000002, </code><code class="sql string">'envato'</code><code class="sql plain">, </code><code class="sql string">'1ecc663314777c8e3c2328027447f194'</code><code class="sql plain">, </code><code class="sql string">'webmaster@envato.com'</code><code class="sql plain">, 1, </code><code class="sql string">'Sydney'</code><code class="sql plain">),</code></div><div class="line number31 index30 alt2"><code class="sql plain">(00000000000000000003, </code><code class="sql string">'sToaster'</code><code class="sql plain">, </code><code class="sql string">'e05fd29cbca7ea9add48ba6dafc300e8'</code><code class="sql plain">, </code><code class="sql string">'toast@yahoo.com'</code><code class="sql plain">, 3, </code><code class="sql string">'2001'</code><code class="sql plain">);</code></div></div></td></tr></tbody></table></div></div>
<h3 class="nolinks">Step 2: Database Include</h3>
<div class="tutorial_image"><img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/2.jpg" data-original-url="http://nettuts.s3.amazonaws.com/315_passwordRecovery/2.jpg" width="491" height="243" alt="Database Connection"></div>
<p>We need to create an include file so that we can connect to our database. For our database interaction, we will use mysqli, which provides an object-oriented approach to database interaction. Create a file called assets/php/<span class="skimlinks-unlinked">database.php</span>. We will add the following code to it (replace the variable values with the information appropriate for your hosting situation):</p>
<div><div id="highlighter_148824" class="syntaxhighlighter noskimlinks noskimwords php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php plain">session_start();</code></div><div class="line number3 index2 alt2"><code class="php plain">ob_start();</code></div><div class="line number4 index3 alt1"><code class="php variable">$hasDB</code> <code class="php plain">= false;</code></div><div class="line number5 index4 alt2"><code class="php variable">$server</code> <code class="php plain">= </code><code class="php string">'localhost'</code><code class="php plain">;</code></div><div class="line number6 index5 alt1"><code class="php variable">$user</code> <code class="php plain">= </code><code class="php string">'user'</code><code class="php plain">;</code></div><div class="line number7 index6 alt2"><code class="php variable">$pass</code> <code class="php plain">= </code><code class="php string">'password'</code><code class="php plain">;</code></div><div class="line number8 index7 alt1"><code class="php variable">$db</code> <code class="php plain">= </code><code class="php string">'db'</code><code class="php plain">;</code></div><div class="line number9 index8 alt2"><code class="php variable">$mySQL</code> <code class="php plain">= </code><code class="php keyword">new</code> <code class="php plain">mysqli(</code><code class="php variable">$server</code><code class="php plain">,</code><code class="php variable">$user</code><code class="php plain">,</code><code class="php variable">$pass</code><code class="php plain">,</code><code class="php variable">$db</code><code class="php plain">);</code></div><div class="line number10 index9 alt1"><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$mySQL</code><code class="php plain">-&gt;connect_error)</code></div><div class="line number11 index10 alt2"><code class="php plain">{</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">die</code><code class="php plain">(</code><code class="php string">'Connect Error ('</code> <code class="php plain">. </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;connect_errno . </code><code class="php string">') '</code><code class="php plain">. </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;connect_error);</code></div><div class="line number13 index12 alt2"><code class="php plain">}</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>In the first line of the code, we call <strong>session_start()</strong>, we will not actually use the session variables but you will need a session as part of a user login system. Then, we call <strong>ob_start()</strong> to start the output buffer.</p>
<p>Lines 4-8 set up our variables to connect to the server. Then we create a new <strong>mysqli</strong> object by passing it our variables. For the remainder of our script, <strong>$mySQL</strong> will allow us to interact with the database as needed.</p>
<p>Mysqli handles error events slightly different, so we have to check the <strong>connect_error</strong> property after connecting, and print an error message if something went wrong. This goes the same for making queries; we must check the <strong>error</strong> property of our query or connection object to check for errors.</p>
<h3 class="nolinks">Step 3: Create the Forgot Password Page</h3>
<p>Let's start off this step by creating the file <span class="skimlinks-unlinked">forgotPass.php</span>. Then, we'll add this code to it:</p>
<div><div id="highlighter_206328" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;!</code><code class="html keyword">DOCTYPE</code> <code class="html plain">HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "<a href="http://www.w3.org/TR/html4/strict.dtd">http://www.w3.org/TR/html4/strict.dtd</a>"&gt;</code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;</code><code class="html keyword">html</code><code class="html plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="html plain">&lt;</code><code class="html keyword">head</code><code class="html plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="html plain">&lt;</code><code class="html keyword">meta</code> <code class="html color1">http-equiv</code><code class="html plain">=</code><code class="html string">"Content-Type"</code> <code class="html color1">content</code><code class="html plain">=</code><code class="html string">"text/html; charset=utf-8"</code><code class="html plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="html plain">&lt;</code><code class="html keyword">title</code><code class="html plain">&gt;Password Recovery&lt;/</code><code class="html keyword">title</code><code class="html plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="html plain">&lt;</code><code class="html keyword">link</code> <code class="html color1">href</code><code class="html plain">=</code><code class="html string">"assets/css/styles.css"</code> <code class="html color1">rel</code><code class="html plain">=</code><code class="html string">"stylesheet"</code> <code class="html color1">type</code><code class="html plain">=</code><code class="html string">"text/css"</code><code class="html plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="html plain">&lt;/</code><code class="html keyword">head</code><code class="html plain">&gt;</code></div><div class="line number8 index7 alt1"><code class="html plain">&lt;</code><code class="html keyword">body</code><code class="html plain">&gt;</code></div><div class="line number9 index8 alt2"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">id</code><code class="html plain">=</code><code class="html string">"header"</code><code class="html plain">&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt;</code></div><div class="line number10 index9 alt1"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">id</code><code class="html plain">=</code><code class="html string">"page"</code><code class="html plain">&gt;</code></div><div class="line number11 index10 alt2"><code class="html comments">&lt;!--PAGE CONTENT--&gt;</code></div><div class="line number12 index11 alt1"><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt;</code></div><div class="line number13 index12 alt2"><code class="html plain">&lt;/</code><code class="html keyword">body</code><code class="html plain">&gt;</code></div><div class="line number14 index13 alt1"><code class="html plain">&lt;/</code><code class="html keyword">html</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>This html gives us a nice base to build on and gives us this:</p>
<div class="tutorial_image"><img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/3.jpg" data-original-url="http://nettuts.s3.amazonaws.com/315_passwordRecovery/3.jpg" width="600" height="189" alt="Page Tamplate"></div>
<p>Then, add this code to the very top of the page, above the html we just entered:</p>
<div><div id="highlighter_883929" class="syntaxhighlighter noskimlinks noskimwords php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php keyword">include</code><code class="php plain">(</code><code class="php string">"assets/php/database.php"</code><code class="php plain">); </code></div><div class="line number3 index2 alt2"><code class="php keyword">include</code><code class="php plain">(</code><code class="php string">"assets/php/functions.php"</code><code class="php plain">);</code></div><div class="line number4 index3 alt1"><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'emailForm'</code><code class="php plain">; </code><code class="php comments">//which form step to show by default</code></div><div class="line number5 index4 alt2"><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'lockout'</code><code class="php plain">] == true &amp;&amp; (</code><code class="php functions">mktime</code><code class="php plain">() &gt; </code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'lastTime'</code><code class="php plain">] + 900))</code></div><div class="line number6 index5 alt1"><code class="php plain">{</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'lockout'</code><code class="php plain">] = false;</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'badCount'</code><code class="php plain">] = 0;</code></div><div class="line number9 index8 alt2"><code class="php plain">}</code></div><div class="line number10 index9 alt1"><code class="php keyword">if</code> <code class="php plain">(isset(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'subStep'</code><code class="php plain">]) &amp;&amp; !isset(</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'a'</code><code class="php plain">]) &amp;&amp; </code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'lockout'</code><code class="php plain">] != true)</code></div><div class="line number11 index10 alt2"><code class="php plain">{</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">switch</code><code class="php plain">(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'subStep'</code><code class="php plain">])</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">case</code> <code class="php plain">1:</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//we just submitted an email or username for verification</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$result</code> <code class="php plain">= checkUNEmail(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'uname'</code><code class="php plain">],</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'email'</code><code class="php plain">]);</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$result</code><code class="php plain">[</code><code class="php string">'status'</code><code class="php plain">] == false )</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$error</code> <code class="php plain">= true;</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'userNotFound'</code><code class="php plain">;</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$error</code> <code class="php plain">= false;</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'securityForm'</code><code class="php plain">;</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$securityUser</code> <code class="php plain">= </code><code class="php variable">$result</code><code class="php plain">[</code><code class="php string">'userID'</code><code class="php plain">];</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">break</code><code class="php plain">;</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">case</code> <code class="php plain">2:</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//we just submitted the security question for verification</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'userID'</code><code class="php plain">] != </code><code class="php string">""</code> <code class="php plain">&amp;&amp; </code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'answer'</code><code class="php plain">] != </code><code class="php string">""</code><code class="php plain">)</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$result</code> <code class="php plain">= checkSecAnswer(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'userID'</code><code class="php plain">],</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'answer'</code><code class="php plain">]);</code></div><div class="line number32 index31 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$result</code> <code class="php plain">== true)</code></div><div class="line number33 index32 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//answer was right</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$error</code> <code class="php plain">= false;</code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'successPage'</code><code class="php plain">;</code></div><div class="line number37 index36 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$passwordMessage</code> <code class="php plain">= sendPasswordEmail(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'userID'</code><code class="php plain">]);</code></div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'badCount'</code><code class="php plain">] = 0;</code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{</code></div><div class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//answer was wrong</code></div><div class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$error</code> <code class="php plain">= true;</code></div><div class="line number42 index41 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'securityForm'</code><code class="php plain">;</code></div><div class="line number43 index42 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$securityUser</code> <code class="php plain">= </code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'userID'</code><code class="php plain">];</code></div><div class="line number44 index43 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'badCount'</code><code class="php plain">]++;</code></div><div class="line number45 index44 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number46 index45 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{</code></div><div class="line number47 index46 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$error</code> <code class="php plain">= true;</code></div><div class="line number48 index47 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'securityForm'</code><code class="php plain">;</code></div><div class="line number49 index48 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number50 index49 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">break</code><code class="php plain">;</code></div><div class="line number51 index50 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">case</code> <code class="php plain">3:</code></div><div class="line number52 index51 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//we are submitting a new password (only for encrypted)</code></div><div class="line number53 index52 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'userID'</code><code class="php plain">] == </code><code class="php string">''</code> <code class="php plain">|| </code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'key'</code><code class="php plain">] == </code><code class="php string">''</code><code class="php plain">) header(</code><code class="php string">"location: login.php"</code><code class="php plain">);</code></div><div class="line number54 index53 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php functions">strcmp</code><code class="php plain">(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'pw0'</code><code class="php plain">],</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'pw1'</code><code class="php plain">]) != 0 || trim(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'pw0'</code><code class="php plain">]) == </code><code class="php string">''</code><code class="php plain">)</code></div><div class="line number55 index54 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number56 index55 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$error</code> <code class="php plain">= true;</code></div><div class="line number57 index56 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'recoverForm'</code><code class="php plain">;</code></div><div class="line number58 index57 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{</code></div><div class="line number59 index58 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$error</code> <code class="php plain">= false;</code></div><div class="line number60 index59 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'recoverSuccess'</code><code class="php plain">;</code></div><div class="line number61 index60 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">updateUserPassword(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'userID'</code><code class="php plain">],</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'pw0'</code><code class="php plain">],</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'key'</code><code class="php plain">]);</code></div><div class="line number62 index61 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number63 index62 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">break</code><code class="php plain">;</code></div><div class="line number64 index63 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number65 index64 alt2"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>The first things we do are include the database file and a functions file that we will create shortly. Then we create a variable called <strong>$show</strong> that determines which interface element to display, by default we want to show the email input form.</p>
<p>After that, we check some session variables. If the session lockout variable is true, and more than 900 seconds (15 min) have elapsed since the lockout took place, we want to end the lockout, which lines 7 and 8 do for us.</p>
<p>Then we create an if block that checks to see if anything has been posted to the page. You can also see that we are checking to make sure that <strong>$_GET['a']</strong> is not set, this variable will be set when the user clicks on the link in their recovery email, so if that is happening, we can skip the post check. Also in the logic block, we make sure that the lockout variable isn't set to true.</p>
<p>Once inside the if block, we use <strong>switch($_POST['subStep'])</strong> to check which stage of the form has been submitted. There are three stages that we will handle: Step 1 means that we just entered a username or email address that we want to reset the password for. To do that, we call the function <strong>checkUNEmail()</strong>, which we will write momentarily. This function returns an array that has a boolean value to determine if the user was found, and an integer of the userID if the user was found. Line 17 checks to see if the user check returned false (the user wasn't found), if so we set the error flag, and the <strong>$show</strong> variable so that we see the 'User Not Found' message. If the user was found, we should show the security question form, and set <strong>$securityUser</strong> so we know which user to load the question for.</p>
<p>In stage 2, we have submitted the security question. The first thing we do here is check to make sure that both a userID and an answer were returned. If either one was omitted, we display the security question form again. If both values were included, we call a function to check the answer against the database. This function returns a simple boolean. If the question was answered correctly, we will show the success page, send the reset email, and set the bad entry count to 0. If the question was answered incorrectly, we display the question page again, and also increment the bad answer counter.</p>
<p>The third stage happens after the user has received the password reset email, and has clicked on the link and submitted the password reset form. First, either userID or the security key are empty, we redirect to the homepage. Then we check to make sure that the two passwords match and were not empty. If they don't match, we show the password reset form again. If they do match, though, we show the success message, and call a function to reset the user's password.</p>
<p><strong>NOTE:</strong> If you are using unencrypted passwords, you can leave out <strong>case 3</strong> above. This is the method that saves a new password after it has been reset. Since we can email unencrypted passwords, they don't need to reset it.</p>
<p>Now we will add an else block to that same if block from above:</p>
<div><div id="highlighter_249595" class="syntaxhighlighter noskimlinks noskimwords php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php keyword">elseif</code> <code class="php plain">(isset(</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'a'</code><code class="php plain">]) &amp;&amp; </code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'a'</code><code class="php plain">] == </code><code class="php string">'recover'</code> <code class="php plain">&amp;&amp; </code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'email'</code><code class="php plain">] != </code><code class="php string">""</code><code class="php plain">) {</code></div><div class="line number2 index1 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'invalidKey'</code><code class="php plain">;</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$result</code> <code class="php plain">= checkEmailKey(</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'email'</code><code class="php plain">],urldecode(</code><code class="php functions">base64_decode</code><code class="php plain">(</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'u'</code><code class="php plain">])));</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$result</code> <code class="php plain">== false)</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$error</code> <code class="php plain">= true;</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'invalidKey'</code><code class="php plain">;</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">elseif</code> <code class="php plain">(</code><code class="php variable">$result</code><code class="php plain">[</code><code class="php string">'status'</code><code class="php plain">] == true) {</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$error</code> <code class="php plain">= false;</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'recoverForm'</code><code class="php plain">;</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$securityUser</code> <code class="php plain">= </code><code class="php variable">$result</code><code class="php plain">[</code><code class="php string">'userID'</code><code class="php plain">];</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number13 index12 alt2"><code class="php plain">}</code></div><div class="line number14 index13 alt1"><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'badCount'</code><code class="php plain">] &gt;= 3)</code></div><div class="line number15 index14 alt2"><code class="php plain">{</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$show</code> <code class="php plain">= </code><code class="php string">'speedLimit'</code><code class="php plain">;</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'lockout'</code><code class="php plain">] = true;</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'lastTime'</code><code class="php plain">] = </code><code class="php string">''</code> <code class="php plain">? </code><code class="php functions">mktime</code><code class="php plain">() : </code><code class="php variable">$_SESSION</code><code class="php plain">[</code><code class="php string">'lastTime'</code><code class="php plain">];</code></div><div class="line number19 index18 alt2"><code class="php plain">}</code></div><div class="line number20 index19 alt1"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>This else block determines if <strong>$_GET['a']</strong> is set, which means that the user has come to the page via the email reset link. If we've figured out they clicked on the link, we want to check if they email key is valid using <strong>checkEmailKey()</strong>. If the key is not found or not valid, it returns boolean false, and we display the invalid key message. If the key is valid, however, it returns an array that we can grab the userID out of (so we know which user's password to reset).</p>
<p><strong>NOTE:</strong> If you are using unencrypted passwords, you can leave out the <strong>elseif</strong> block. This deals with displaying the password change form after clicking on the link in the email.</p>
<p>The second if block there checks to see if the user has answered the security question incorrectly more than 3 times. If they have, we set the lockout variable to true, and set the lockout time, which is the time the lockout went into effect. Notice that if the lockout time is already set, we will use that variable, but if not, we will generate a new time.</p>
<p>Setting a speedlimit is important for security. Mostly it will serve to deter people from just sitting there and trying to guess the answer to security questions. It can also help to prevent bots from submitting the form over and over. The main drawback of this method is that a user can just delete the PHPSESS_ID cookie, and then they can start over. If you want a very secure solution, you could add a 'lockout' flag to the users table, and when they have answered wrong 3 times, set that flag to true. Then you can write some code to lockout if they try to access the account.</p>
<h3 class="nolinks">Step 4: Function file</h3>
<div class="tutorial_image"><img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/4.jpg" data-original-url="http://nettuts.s3.amazonaws.com/315_passwordRecovery/4.jpg" width="600" height="265" alt="Functions"></div>
<p>Now let's create the file assets/php/<span class="skimlinks-unlinked">functions.php</span> to hold all of the functions we were referencing earlier. Now let's go through them a few at a time:</p>
<p><strong>NOTE:</strong> In the sample files, the encrypted example uses the table <em>'users_enc'</em>, while the unencrypted example uses the table <em>'users'</em> so the table name will change in your functions depending on which version you use.</p>
<div><div id="highlighter_315053" class="syntaxhighlighter noskimlinks noskimwords php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php plain">define(PW_SALT,</code><code class="php string">'(+3%_'</code><code class="php plain">);</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="php keyword">function</code> <code class="php plain">checkUNEmail(</code><code class="php variable">$uname</code><code class="php plain">,</code><code class="php variable">$email</code><code class="php plain">)</code></div><div class="line number5 index4 alt2"><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$mySQL</code><code class="php plain">;</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$error</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'status'</code><code class="php plain">=&gt;false,</code><code class="php string">'userID'</code><code class="php plain">=&gt;0);</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(isset(</code><code class="php variable">$email</code><code class="php plain">) &amp;&amp; trim(</code><code class="php variable">$email</code><code class="php plain">) != </code><code class="php string">''</code><code class="php plain">) {</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//email was entered</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$SQL</code> <code class="php plain">= </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;prepare(</code><code class="php string">"SELECT `ID` FROM `users_enc` WHERE `Email` = ? LIMIT 1"</code><code class="php plain">))</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_param(</code><code class="php string">'s'</code><code class="php plain">,trim(</code><code class="php variable">$email</code><code class="php plain">));</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;store_result();</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$numRows</code> <code class="php plain">= </code><code class="php variable">$SQL</code><code class="php plain">-&gt;num_rows();</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_result(</code><code class="php variable">$userID</code><code class="php plain">);</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;fetch();</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;close();</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$numRows</code> <code class="php plain">&gt;= 1) </code><code class="php keyword">return</code> <code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'status'</code><code class="php plain">=&gt;true,</code><code class="php string">'userID'</code><code class="php plain">=&gt;</code><code class="php variable">$userID</code><code class="php plain">);</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{ </code><code class="php keyword">return</code> <code class="php variable">$error</code><code class="php plain">; }</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">elseif</code> <code class="php plain">(isset(</code><code class="php variable">$uname</code><code class="php plain">) &amp;&amp; trim(</code><code class="php variable">$uname</code><code class="php plain">) != </code><code class="php string">''</code><code class="php plain">) {</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//username was entered</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$SQL</code> <code class="php plain">= </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;prepare(</code><code class="php string">"SELECT `ID` FROM `users_enc` WHERE Username = ? LIMIT 1"</code><code class="php plain">))</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_param(</code><code class="php string">'s'</code><code class="php plain">,trim(</code><code class="php variable">$uname</code><code class="php plain">));</code></div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;store_result();</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$numRows</code> <code class="php plain">= </code><code class="php variable">$SQL</code><code class="php plain">-&gt;num_rows();</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_result(</code><code class="php variable">$userID</code><code class="php plain">);</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;fetch();</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;close();</code></div><div class="line number32 index31 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$numRows</code> <code class="php plain">&gt;= 1) </code><code class="php keyword">return</code> <code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'status'</code><code class="php plain">=&gt;true,</code><code class="php string">'userID'</code><code class="php plain">=&gt;</code><code class="php variable">$userID</code><code class="php plain">);</code></div><div class="line number33 index32 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{ </code><code class="php keyword">return</code> <code class="php variable">$error</code><code class="php plain">; }</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//nothing was entered;</code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$error</code><code class="php plain">;</code></div><div class="line number37 index36 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number38 index37 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>At the top of the file, we want to define <strong>PW_SALT</strong>, which is the salt we will use to encrypt passwords throughout. The first function takes the username and password values from the $_POST and sees if a matching user exists in the database. The first thing we need to do is make <strong>$mySQL</strong> global so we can access the database. We also create a generic error array that we will return if no user was found. Then we check to see if there is a value for the email. If there was, we build a mySQLi prepared statement. The great thing about using prepared statements is the security, especially when dealing with user input, the overall process is similar to using <strong>sprintf()</strong>.</p>
<p>Notice that we call the <strong>-&gt;prepare()</strong> method with our SQL query as the parameter, and use question marks where our variables would go. Also note that we <strong>don't </strong>put any form of quotes around the question marks (even for string).This is what allows us to parameterize a statement. <strong>mySQLi::prepare()</strong> will return true if the statement was created successfully. If it was created, we need to bind parameters to our query using <strong>mySQLi::bind_param()</strong>. This function accepts at least two arguments. The first is a string of letters that represent the datatypes of the data to be bound. The rest of the arguments are the variables that you want to be in each parameter. In our case, we are using <strong>'s'</strong> (for a string), and <strong>$email</strong>, since that variable has the email address. Note that the order is important, so the first question mark in your query corresponds to the first letter in the format string, and the first variable.</p>
<p>Then we need to call <strong>-&gt;execute()</strong> and <strong>-&gt;store_result()</strong>. These two methods run the prepared query and store it in memory until freed. Then we check for the number of rows returned to make sure that the user was found. <strong>-&gt;bind_result()</strong> is very similar to <strong>-&gt;bind_param()</strong> except in the opposite direction. It allows us to take a returned value from a result, and map it to a local variable. Variables are assigned based on their order in the result set. The local variable is not actually written until we call <strong>-&gt;fetch()</strong>, after we call <strong>-&gt;fetch(),</strong> the variable <strong>$userID</strong> will hold the variable from the database. Then we use <strong>-&gt;close()</strong> on the query to free the result. Lastly, we will return an array that holds the boolean value for success and an integer for the userID.</p>
<div><div id="highlighter_388040" class="syntaxhighlighter noskimlinks noskimwords php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php keyword">function</code> <code class="php plain">getSecurityQuestion(</code><code class="php variable">$userID</code><code class="php plain">)</code></div><div class="line number2 index1 alt1"><code class="php plain">{</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$mySQL</code><code class="php plain">;</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$questions</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">();</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$questions</code><code class="php plain">[0] = </code><code class="php string">"What is your mother's maiden name?"</code><code class="php plain">;</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$questions</code><code class="php plain">[1] = </code><code class="php string">"What city were you born in?"</code><code class="php plain">;</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$questions</code><code class="php plain">[2] = </code><code class="php string">"What is your favorite color?"</code><code class="php plain">;</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$questions</code><code class="php plain">[3] = </code><code class="php string">"What year did you graduate from High School?"</code><code class="php plain">;</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$questions</code><code class="php plain">[4] = </code><code class="php string">"What was the name of your first boyfriend/girlfriend?"</code><code class="php plain">;</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$questions</code><code class="php plain">[5] = </code><code class="php string">"What is your favorite model of car?"</code><code class="php plain">;</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$SQL</code> <code class="php plain">= </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;prepare(</code><code class="php string">"SELECT `secQ` FROM `users_enc` WHERE `ID` = ? LIMIT 1"</code><code class="php plain">))</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_param(</code><code class="php string">'i'</code><code class="php plain">,</code><code class="php variable">$userID</code><code class="php plain">);</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;store_result();</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_result(</code><code class="php variable">$secQ</code><code class="php plain">);</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;fetch();</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;close();</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$questions</code><code class="php plain">[</code><code class="php variable">$secQ</code><code class="php plain">];</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number23 index22 alt2"><code class="php plain">}</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="php keyword">function</code> <code class="php plain">checkSecAnswer(</code><code class="php variable">$userID</code><code class="php plain">,</code><code class="php variable">$answer</code><code class="php plain">)</code></div><div class="line number26 index25 alt1"><code class="php plain">{</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$mySQL</code><code class="php plain">;</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$SQL</code> <code class="php plain">= </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;prepare(</code><code class="php string">"SELECT `Username` FROM `users_enc` WHERE `ID` = ? AND LOWER(`secA`) = ? LIMIT 1"</code><code class="php plain">))</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$answer</code> <code class="php plain">= </code><code class="php functions">strtolower</code><code class="php plain">(</code><code class="php variable">$answer</code><code class="php plain">);</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_param(</code><code class="php string">'is'</code><code class="php plain">,</code><code class="php variable">$userID</code><code class="php plain">,</code><code class="php variable">$answer</code><code class="php plain">);</code></div><div class="line number32 index31 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number33 index32 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;store_result();</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$numRows</code> <code class="php plain">= </code><code class="php variable">$SQL</code><code class="php plain">-&gt;num_rows();</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;close();</code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$numRows</code> <code class="php plain">&gt;= 1) { </code><code class="php keyword">return</code> <code class="php plain">true; }</code></div><div class="line number37 index36 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{</code></div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number40 index39 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p><strong>getSecurityQuestion()</strong> accepts the id of a user, and returns their security question as a string. Once again, we make <strong>$mySQL</strong> global. Then we create an array of the 6 different security questions possible. Using a method similar to the above, we see which security question the user has selected, then we return that index from the array.</p>
<p><strong>checkSecAnswer()</strong> accepts a userID and a string answer and checks the database to see if it is correct. Note that we are converting the passed answer and the database answer to lowercase to increase chances of a match (optional for you). This is an excellent example of a multi parameter prepared statement. Notice the order of the arguments in the <strong>bind_param()</strong> method. This function will return true if it finds a record where the userID and the answer match what is passed. It will return false otherwise.</p>
<div><div id="highlighter_285716" class="syntaxhighlighter noskimlinks noskimwords php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php keyword">function</code> <code class="php plain">sendPasswordEmail(</code><code class="php variable">$userID</code><code class="php plain">)</code></div><div class="line number2 index1 alt1"><code class="php plain">{</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$mySQL</code><code class="php plain">;</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$SQL</code> <code class="php plain">= </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;prepare(</code><code class="php string">"SELECT `Username`,`Email`,`Password` FROM `users_enc` WHERE `ID` = ? LIMIT 1"</code><code class="php plain">))</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_param(</code><code class="php string">'i'</code><code class="php plain">,</code><code class="php variable">$userID</code><code class="php plain">);</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;store_result();</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_result(</code><code class="php variable">$uname</code><code class="php plain">,</code><code class="php variable">$email</code><code class="php plain">,</code><code class="php variable">$pword</code><code class="php plain">);</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;fetch();</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;close();</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$expFormat</code> <code class="php plain">= </code><code class="php functions">mktime</code><code class="php plain">(</code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"H"</code><code class="php plain">), </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"i"</code><code class="php plain">), </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"s"</code><code class="php plain">), </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"m"</code><code class="php plain">)&nbsp; , </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"d"</code><code class="php plain">)+3, </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"Y"</code><code class="php plain">));</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$expDate</code> <code class="php plain">= </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"Y-m-d H:i:s"</code><code class="php plain">,</code><code class="php variable">$expFormat</code><code class="php plain">);</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$key</code> <code class="php plain">= md5(</code><code class="php variable">$uname</code> <code class="php plain">. </code><code class="php string">'_'</code> <code class="php plain">. </code><code class="php variable">$email</code> <code class="php plain">. rand(0,10000) .</code><code class="php variable">$expDate</code> <code class="php plain">. PW_SALT);</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$SQL</code> <code class="php plain">= </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;prepare(</code><code class="php string">"INSERT INTO `recoveryemails_enc` (`UserID`,`Key`,`expDate`) VALUES (?,?,?)"</code><code class="php plain">))</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_param(</code><code class="php string">'iss'</code><code class="php plain">,</code><code class="php variable">$userID</code><code class="php plain">,</code><code class="php variable">$key</code><code class="php plain">,</code><code class="php variable">$expDate</code><code class="php plain">);</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;close();</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$passwordLink</code> <code class="php plain">= </code><code class="php string">"&lt;a href=\"?a=recover&amp;email="</code> <code class="php plain">. </code><code class="php variable">$key</code> <code class="php plain">. </code><code class="php string">"&amp;u="</code> <code class="php plain">. urlencode(</code><code class="php functions">base64_encode</code><code class="php plain">(</code><code class="php variable">$userID</code><code class="php plain">)) . </code><code class="php string">"\"&gt;<a href="http://www.oursite.com/forgotPass.php?a=recover&amp;email=">http://www.oursite.com/forgotPass.php?a=recover&amp;email=</a>"</code> <code class="php plain">. </code><code class="php variable">$key</code> <code class="php plain">. </code><code class="php string">"&amp;u="</code> <code class="php plain">. urlencode(</code><code class="php functions">base64_encode</code><code class="php plain">(</code><code class="php variable">$userID</code><code class="php plain">)) . </code><code class="php string">"&lt;/a&gt;"</code><code class="php plain">;</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">= </code><code class="php string">"Dear $uname,\r\n"</code><code class="php plain">;</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">.= </code><code class="php string">"Please visit the following link to reset your password:\r\n"</code><code class="php plain">;</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">.= </code><code class="php string">"-----------------------\r\n"</code><code class="php plain">;</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">.= </code><code class="php string">"$passwordLink\r\n"</code><code class="php plain">;</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">.= </code><code class="php string">"-----------------------\r\n"</code><code class="php plain">;</code></div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">.= </code><code class="php string">"Please be sure to copy the entire link into your browser. The link will expire after 3 days for security reasons.\r\n\r\n"</code><code class="php plain">;</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">.= </code><code class="php string">"If you did not request this forgotten password email, no action is needed, your password will not be reset as long as the link above is not visited. However, you may want to log into your account and change your security password and answer, as someone may have guessed it.\r\n\r\n"</code><code class="php plain">;</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">.= </code><code class="php string">"Thanks,\r\n"</code><code class="php plain">;</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">.= </code><code class="php string">"-- Our site team"</code><code class="php plain">;</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$headers</code> <code class="php plain">.= </code><code class="php string">"From: Our Site &lt;webmaster@oursite.com&gt; \n"</code><code class="php plain">;</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$headers</code> <code class="php plain">.= </code><code class="php string">"To-Sender: \n"</code><code class="php plain">;</code></div><div class="line number32 index31 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$headers</code> <code class="php plain">.= </code><code class="php string">"X-Mailer: PHP\n"</code><code class="php plain">; </code><code class="php comments">// mailer</code></div><div class="line number33 index32 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$headers</code> <code class="php plain">.= </code><code class="php string">"Reply-To: webmaster@oursite.com\n"</code><code class="php plain">; </code><code class="php comments">// Reply address</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$headers</code> <code class="php plain">.= </code><code class="php string">"Return-Path: webmaster@oursite.com\n"</code><code class="php plain">; </code><code class="php comments">//Return Path for errors</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$headers</code> <code class="php plain">.= </code><code class="php string">"Content-Type: text/html; charset=iso-8859-1"</code><code class="php plain">; </code><code class="php comments">//Enc-type</code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$subject</code> <code class="php plain">= </code><code class="php string">"Your Lost Password"</code><code class="php plain">;</code></div><div class="line number37 index36 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">@mail(</code><code class="php variable">$email</code><code class="php plain">,</code><code class="php variable">$subject</code><code class="php plain">,</code><code class="php variable">$message</code><code class="php plain">,</code><code class="php variable">$headers</code><code class="php plain">);</code></div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php functions">str_replace</code><code class="php plain">(</code><code class="php string">"\r\n"</code><code class="php plain">,</code><code class="php string">"&lt;br/ &gt;"</code><code class="php plain">,</code><code class="php variable">$message</code><code class="php plain">);</code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number41 index40 alt2"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>This function takes care of sending the email to reset a password. We start out by making a SQL query to get the username and email address of the passed user. After binding the parameters and the result, we close the query. For security reasons, we only want the link we generate to be good for 3 days. To do this, we create a new date that is 3 days in the future. Them, using several of the values that are passed in, the date, a random number and our salt, we generate an MD5 hash that will be our security key. Because of the every changing future date and random number, we should be assured a completely random key every time. Then we build a SQL query to insert it into the database. After executing the query, we make the link that will be sent in the email. We want to include 'a=recover' and our key, and userID which we <strong>base64_encode()</strong> and <strong>urlencode()</strong> to make it not readable. Once the link is generated, we make the rest of our email text and send it.</p>
<p><strong>NOTE:</strong> If you are using the unencrypted example, you want to change your message text to instead print out the variable <strong>$pword</strong> instead of a link to reset the password.</p>
<p><strong>NOTE:</strong> If you are developing this on a local server, it is unlikely that you have smtp installed, so you will be unable to send mail. This is why we are using the <strong>@mail()</strong> command (to prevent error messages). Also for that reason, this function returns the string of the message so it can be printed on the screen. Now for the last 3 function:</p>
<div><div id="highlighter_378116" class="syntaxhighlighter noskimlinks noskimwords php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php keyword">function</code> <code class="php plain">checkEmailKey(</code><code class="php variable">$key</code><code class="php plain">,</code><code class="php variable">$userID</code><code class="php plain">)</code></div><div class="line number2 index1 alt1"><code class="php plain">{</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$mySQL</code><code class="php plain">;</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$curDate</code> <code class="php plain">= </code><code class="php functions">date</code><code class="php plain">(</code><code class="php string">"Y-m-d H:i:s"</code><code class="php plain">);</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$SQL</code> <code class="php plain">= </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;prepare(</code><code class="php string">"SELECT `UserID` FROM `recoveryemails_enc` WHERE `Key` = ? AND `UserID` = ? AND `expDate` &gt;= ?"</code><code class="php plain">))</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_param(</code><code class="php string">'sis'</code><code class="php plain">,</code><code class="php variable">$key</code><code class="php plain">,</code><code class="php variable">$userID</code><code class="php plain">,</code><code class="php variable">$curDate</code><code class="php plain">);</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;store_result();</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$numRows</code> <code class="php plain">= </code><code class="php variable">$SQL</code><code class="php plain">-&gt;num_rows();</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_result(</code><code class="php variable">$userID</code><code class="php plain">);</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;fetch();</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;close();</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$numRows</code> <code class="php plain">&gt; 0 &amp;&amp; </code><code class="php variable">$userID</code> <code class="php plain">!= </code><code class="php string">''</code><code class="php plain">)</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'status'</code><code class="php plain">=&gt;true,</code><code class="php string">'userID'</code><code class="php plain">=&gt;</code><code class="php variable">$userID</code><code class="php plain">);</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></div><div class="line number21 index20 alt2"><code class="php plain">}</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="php keyword">function</code> <code class="php plain">updateUserPassword(</code><code class="php variable">$userID</code><code class="php plain">,</code><code class="php variable">$password</code><code class="php plain">,</code><code class="php variable">$key</code><code class="php plain">)</code></div><div class="line number24 index23 alt1"><code class="php plain">{</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$mySQL</code><code class="php plain">;</code></div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(checkEmailKey(</code><code class="php variable">$key</code><code class="php plain">,</code><code class="php variable">$userID</code><code class="php plain">) === false) </code><code class="php keyword">return</code> <code class="php plain">false;</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$SQL</code> <code class="php plain">= </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;prepare(</code><code class="php string">"UPDATE `users_enc` SET `Password` = ? WHERE `ID` = ?"</code><code class="php plain">))</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$password</code> <code class="php plain">= md5(trim(</code><code class="php variable">$password</code><code class="php plain">) . PW_SALT);</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_param(</code><code class="php string">'si'</code><code class="php plain">,</code><code class="php variable">$password</code><code class="php plain">,</code><code class="php variable">$userID</code><code class="php plain">);</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number32 index31 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;close();</code></div><div class="line number33 index32 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code> <code class="php plain">= </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;prepare(</code><code class="php string">"DELETE FROM `recoveryemails_enc` WHERE `Key` = ?"</code><code class="php plain">);</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_param(</code><code class="php string">'s'</code><code class="php plain">,</code><code class="php variable">$key</code><code class="php plain">);</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number37 index36 alt2"><code class="php plain">}</code></div><div class="line number38 index37 alt1">&nbsp;</div><div class="line number39 index38 alt2"><code class="php keyword">function</code> <code class="php plain">getUserName(</code><code class="php variable">$userID</code><code class="php plain">)</code></div><div class="line number40 index39 alt1"><code class="php plain">{</code></div><div class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$mySQL</code><code class="php plain">;</code></div><div class="line number42 index41 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$SQL</code> <code class="php plain">= </code><code class="php variable">$mySQL</code><code class="php plain">-&gt;prepare(</code><code class="php string">"SELECT `Username` FROM `users_enc` WHERE `ID` = ?"</code><code class="php plain">))</code></div><div class="line number43 index42 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">{</code></div><div class="line number44 index43 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_param(</code><code class="php string">'i'</code><code class="php plain">,</code><code class="php variable">$userID</code><code class="php plain">);</code></div><div class="line number45 index44 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;execute();</code></div><div class="line number46 index45 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;store_result();</code></div><div class="line number47 index46 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;bind_result(</code><code class="php variable">$uname</code><code class="php plain">);</code></div><div class="line number48 index47 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;fetch();</code></div><div class="line number49 index48 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$SQL</code><code class="php plain">-&gt;close();</code></div><div class="line number50 index49 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number51 index50 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$uname</code><code class="php plain">;</code></div><div class="line number52 index51 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>The first function checks the email key that was passed. We make a date string to represent today's date (so we know if the key is expired). Then our SQL checks to see if any records exist for a key that matches the passed user, security key, and that the expiration date is after right now. If such a key exists, we return an array with the userID in it, or false otherwise.</p>
<p>The function <strong>updateUserPassword()</strong> takes care of changing the actual password in the database. First we verify the email key against the passed in user and key info to make sure things are safe. We generate a new password by combining the passed password and the previously defined salt, and then running <strong>md5()</strong> on that string. Then we perform our update. Once that is completed, we delete the record of the recovery key from the database so it can't be used again.</p>
<p><strong>NOTE: </strong>The function <strong>updateUserPassword()</strong> is not needed in the unencrypted example, since we are not changing their password.</p>
<p><strong>getUserName()</strong> is simply a utility function to get the username of the assed userID. It uses a basic SQL statement like the others.</p>
<h3 class="nolinks">Step 5: Complete the Forgot Password Page</h3>
<p>Now that we have the functions we need built, we'll add some more to <span class="skimlinks-unlinked">forgotPass.php</span>. Add this code inside the div with the id "page":</p>
<div><div id="highlighter_452264" class="syntaxhighlighter noskimlinks noskimwords php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php </code><code class="php keyword">switch</code><code class="php plain">(</code><code class="php variable">$show</code><code class="php plain">) {</code></div><div class="line number2 index1 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">case</code> <code class="php string">'emailForm'</code><code class="php plain">: ?&gt;</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;h2&gt;Password Recovery&lt;/h2&gt;</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;p&gt;You can </code><code class="php keyword">use</code> <code class="php plain">this form to recover your password </code><code class="php keyword">if</code> <code class="php plain">you have forgotten it. Because your password is securely encrypted in our database, it is impossible actually recover your password, but we will email you a link that will enable you to reset it securely. Enter either your username </code><code class="php keyword">or</code> <code class="php plain">your email address below to get started.&lt;/p&gt;</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php </code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$error</code> <code class="php plain">== true) { ?&gt;&lt;span </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"error"</code><code class="php plain">&gt;You must enter either a username </code><code class="php keyword">or</code> <code class="php plain">password to </code><code class="php keyword">continue</code><code class="php plain">.&lt;/span&gt;&lt;?php } ?&gt;</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;form action=</code><code class="php string">"&lt;?= $_SERVER['PHP_SELF']; ?&gt;"</code> <code class="php plain">method=</code><code class="php string">"post"</code><code class="php plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"fieldGroup"</code><code class="php plain">&gt;&lt;label </code><code class="php keyword">for</code><code class="php plain">=</code><code class="php string">"uname"</code><code class="php plain">&gt;Username&lt;/label&gt;&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"field"</code><code class="php plain">&gt;&lt;input type=</code><code class="php string">"text"</code> <code class="php plain">name=</code><code class="php string">"uname"</code> <code class="php plain">id=</code><code class="php string">"uname"</code> <code class="php plain">value=</code><code class="php string">""</code> <code class="php plain">maxlength=</code><code class="php string">"20"</code><code class="php plain">&gt;&lt;/div&gt;&lt;/div&gt;</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"fieldGroup"</code><code class="php plain">&gt;&lt;label&gt;- OR -&lt;/label&gt;&lt;/div&gt;</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"fieldGroup"</code><code class="php plain">&gt;&lt;label </code><code class="php keyword">for</code><code class="php plain">=</code><code class="php string">"email"</code><code class="php plain">&gt;Email&lt;/label&gt;&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"field"</code><code class="php plain">&gt;&lt;input type=</code><code class="php string">"text"</code> <code class="php plain">name=</code><code class="php string">"email"</code> <code class="php plain">id=</code><code class="php string">"email"</code> <code class="php plain">value=</code><code class="php string">""</code> <code class="php plain">maxlength=</code><code class="php string">"255"</code><code class="php plain">&gt;&lt;/div&gt;&lt;/div&gt;</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;input type=</code><code class="php string">"hidden"</code> <code class="php plain">name=</code><code class="php string">"subStep"</code> <code class="php plain">value=</code><code class="php string">"1"</code> <code class="php plain">/&gt;</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"fieldGroup"</code><code class="php plain">&gt;&lt;input type=</code><code class="php string">"submit"</code> <code class="php plain">value=</code><code class="php string">"Submit"</code> <code class="php plain">style=</code><code class="php string">"margin-left: 150px;"</code> <code class="php plain">/&gt;&lt;/div&gt;</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"clear"</code><code class="php plain">&gt;&lt;/div&gt;</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/form&gt;</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php </code><code class="php keyword">break</code><code class="php plain">; </code><code class="php keyword">case</code> <code class="php string">'securityForm'</code><code class="php plain">: ?&gt;</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;h2&gt;Password Recovery&lt;/h2&gt;</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;p&gt;Please answer the security question below:&lt;/p&gt;</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php </code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$error</code> <code class="php plain">== true) { ?&gt;&lt;span </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"error"</code><code class="php plain">&gt;You must answer the security question correctly to receive your lost password.&lt;/span&gt;&lt;?php } ?&gt;</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;form action=</code><code class="php string">"&lt;?= $_SERVER['PHP_SELF']; ?&gt;"</code> <code class="php plain">method=</code><code class="php string">"post"</code><code class="php plain">&gt;</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"fieldGroup"</code><code class="php plain">&gt;&lt;label&gt;Question&lt;/label&gt;&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"field"</code><code class="php plain">&gt;&lt;?= getSecurityQuestion(</code><code class="php variable">$securityUser</code><code class="php plain">); ?&gt;&lt;/div&gt;&lt;/div&gt;</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"fieldGroup"</code><code class="php plain">&gt;&lt;label </code><code class="php keyword">for</code><code class="php plain">=</code><code class="php string">"answer"</code><code class="php plain">&gt;Answer&lt;/label&gt;&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"field"</code><code class="php plain">&gt;&lt;input type=</code><code class="php string">"text"</code> <code class="php plain">name=</code><code class="php string">"answer"</code> <code class="php plain">id=</code><code class="php string">"answer"</code> <code class="php plain">value=</code><code class="php string">""</code> <code class="php plain">maxlength=</code><code class="php string">"255"</code><code class="php plain">&gt;&lt;/div&gt;&lt;/div&gt;</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;input type=</code><code class="php string">"hidden"</code> <code class="php plain">name=</code><code class="php string">"subStep"</code> <code class="php plain">value=</code><code class="php string">"2"</code> <code class="php plain">/&gt;</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;input type=</code><code class="php string">"hidden"</code> <code class="php plain">name=</code><code class="php string">"userID"</code> <code class="php plain">value=</code><code class="php string">"&lt;?= $securityUser; ?&gt;"</code> <code class="php plain">/&gt;</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"fieldGroup"</code><code class="php plain">&gt;&lt;input type=</code><code class="php string">"submit"</code> <code class="php plain">value=</code><code class="php string">"Submit"</code> <code class="php plain">style=</code><code class="php string">"margin-left: 150px;"</code> <code class="php plain">/&gt;&lt;/div&gt;</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"clear"</code><code class="php plain">&gt;&lt;/div&gt;</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/form&gt;</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php </code><code class="php keyword">break</code><code class="php plain">; </code><code class="php keyword">case</code> <code class="php string">'userNotFound'</code><code class="php plain">: ?&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp; &lt;h2&gt;Password Recovery&lt;/h2&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp; &lt;p&gt;The username </code><code class="php keyword">or</code> <code class="php plain">email you entered was not found in our database.&lt;br /&gt;&lt;br /&gt;&lt;a href=</code><code class="php string">"?"</code><code class="php plain">&gt;Click here&lt;/a&gt; to </code><code class="php keyword">try</code> <code class="php plain">again.&lt;/p&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp; &lt;?php </code><code class="php keyword">break</code><code class="php plain">; </code><code class="php keyword">case</code> <code class="php string">'successPage'</code><code class="php plain">: ?&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp; &lt;h2&gt;Password Recovery&lt;/h2&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp; &lt;p&gt;An email has been sent to you with instructions on how to reset your password. &lt;strong&gt;(Mail will not send unless you have an smtp server running locally.)&lt;/strong&gt;&lt;br /&gt;&lt;br /&gt;&lt;a href=</code><code class="php string">"login.php"</code><code class="php plain">&gt;Return&lt;/a&gt; to the login page. &lt;/p&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp; &lt;p&gt;This is the message that would appear in the email:&lt;/p&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp; &lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"message"</code><code class="php plain">&gt;&lt;?= </code><code class="php variable">$passwordMessage</code><code class="php plain">;?&gt;&lt;/div&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp; &lt;?php </code><code class="php keyword">break</code><code class="php plain">;</code></div></div></td></tr></tbody></table></div></div>
<p>This code will deal with actually displaying all of the interface elements. We start off by examining the <strong>$show</strong> variable from earlier with <strong>switch()</strong>. As you may remember from earlier, there are many different values that <strong>$show</strong> can have, so we must create a case for each one. The first case, "emailForm", is where the user will enter either a username or email that they want to recover the password for. Basically we need two text fields, and a hidden input so we know which step we have submitted. There is also an <strong>if ($error == true)</strong> block that will display an error message if the <strong>$error</strong> flag is true.</p>
<div class="tutorial_image"><img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/5.jpg" data-original-url="http://nettuts.s3.amazonaws.com/315_passwordRecovery/5.jpg" width="600" height="362" alt="Email Form"></div>
<p>The second case is "securityForm". This is where the security question will be displayed. You can see that we also have an error message, and we use <span class="php"><strong>getSecurityQuestion(</strong></span><strong>)</strong> to print the security question. Then we have an input for the answer, as well as the step, and the userID.</p>
<div class="tutorial_image"><img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/6.jpg" data-original-url="http://nettuts.s3.amazonaws.com/315_passwordRecovery/6.jpg" width="600" height="285" alt="Security Question"></div>
<p>The message for "userNotFound" is simply a text message that tells the user that the record wasn't found.</p>
<p>"SuccessPage" is shown when the security question has been answered correctly and the email has been sent. Notice that we have printed out the email message at the bottom of this prompt, you would not do this in a production environment, because then you give the person instant access to the security code meant only for the registered user.</p>
<div class="tutorial_image"><img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/7.jpg" data-original-url="http://nettuts.s3.amazonaws.com/315_passwordRecovery/7.jpg" width="600" height="497" alt="Email"></div>
<p>Let's continue with this code:</p>
<div><div id="highlighter_266162" class="syntaxhighlighter noskimlinks noskimwords php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php keyword">case</code> <code class="php string">'recoverForm'</code><code class="php plain">: ?&gt;</code></div><div class="line number2 index1 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;h2&gt;Password Recovery&lt;/h2&gt;</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;p&gt;Welcome back, &lt;?= getUserName(</code><code class="php variable">$securityUser</code><code class="php plain">==</code><code class="php string">''</code> <code class="php plain">? </code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">'userID'</code><code class="php plain">] : </code><code class="php variable">$securityUser</code><code class="php plain">); ?&gt;.&lt;/p&gt;</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;p&gt;In the fields below, enter your </code><code class="php keyword">new</code> <code class="php plain">password.&lt;/p&gt;</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php </code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$error</code> <code class="php plain">== true) { ?&gt;&lt;span </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"error"</code><code class="php plain">&gt;The </code><code class="php keyword">new</code> <code class="php plain">passwords must match </code><code class="php keyword">and</code> <code class="php plain">must not be </code><code class="php functions">empty</code><code class="php plain">.&lt;/span&gt;&lt;?php } ?&gt;</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;form action=</code><code class="php string">"&lt;?= $_SERVER['PHP_SELF']; ?&gt;"</code> <code class="php plain">method=</code><code class="php string">"post"</code><code class="php plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"fieldGroup"</code><code class="php plain">&gt;&lt;label </code><code class="php keyword">for</code><code class="php plain">=</code><code class="php string">"pw0"</code><code class="php plain">&gt;New Password&lt;/label&gt;&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"field"</code><code class="php plain">&gt;&lt;input type=</code><code class="php string">"password"</code> <code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"input"</code> <code class="php plain">name=</code><code class="php string">"pw0"</code> <code class="php plain">id=</code><code class="php string">"pw0"</code> <code class="php plain">value=</code><code class="php string">""</code> <code class="php plain">maxlength=</code><code class="php string">"20"</code><code class="php plain">&gt;&lt;/div&gt;&lt;/div&gt;</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"fieldGroup"</code><code class="php plain">&gt;&lt;label </code><code class="php keyword">for</code><code class="php plain">=</code><code class="php string">"pw1"</code><code class="php plain">&gt;Confirm Password&lt;/label&gt;&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"field"</code><code class="php plain">&gt;&lt;input type=</code><code class="php string">"password"</code> <code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"input"</code> <code class="php plain">name=</code><code class="php string">"pw1"</code> <code class="php plain">id=</code><code class="php string">"pw1"</code> <code class="php plain">value=</code><code class="php string">""</code> <code class="php plain">maxlength=</code><code class="php string">"20"</code><code class="php plain">&gt;&lt;/div&gt;&lt;/div&gt;</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;input type=</code><code class="php string">"hidden"</code> <code class="php plain">name=</code><code class="php string">"subStep"</code> <code class="php plain">value=</code><code class="php string">"3"</code> <code class="php plain">/&gt;</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;input type=</code><code class="php string">"hidden"</code> <code class="php plain">name=</code><code class="php string">"userID"</code> <code class="php plain">value=</code><code class="php string">"&lt;?= $securityUser=='' ? $_POST['userID'] : $securityUser; ?&gt;"</code> <code class="php plain">/&gt;</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;input type=</code><code class="php string">"hidden"</code> <code class="php plain">name=</code><code class="php string">"key"</code> <code class="php plain">value=</code><code class="php string">"&lt;?= $_GET['email']=='' ? $_POST['key'] : $_GET['email']; ?&gt;"</code> <code class="php plain">/&gt;</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"fieldGroup"</code><code class="php plain">&gt;&lt;input type=</code><code class="php string">"submit"</code> <code class="php plain">value=</code><code class="php string">"Submit"</code> <code class="php plain">style=</code><code class="php string">"margin-left: 150px;"</code> <code class="php plain">/&gt;&lt;/div&gt;</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"clear"</code><code class="php plain">&gt;&lt;/div&gt;</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/form&gt;</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php </code><code class="php keyword">break</code><code class="php plain">; </code><code class="php keyword">case</code> <code class="php string">'invalidKey'</code><code class="php plain">: ?&gt;</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;h2&gt;Invalid Key&lt;/h2&gt;</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;p&gt;The key that you entered was invalid. Either you did not </code><code class="php functions">copy</code> <code class="php plain">the entire key from the email, you are trying to </code><code class="php keyword">use</code> <code class="php plain">the key after it has expired (3 days after request), </code><code class="php keyword">or</code> <code class="php plain">you have already used the key in which </code><code class="php keyword">case</code> <code class="php plain">it is deactivated.&lt;br /&gt;&lt;br /&gt;&lt;a href=</code><code class="php string">"login.php"</code><code class="php plain">&gt;Return&lt;/a&gt; to the login page. &lt;/p&gt;</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php </code><code class="php keyword">break</code><code class="php plain">; </code><code class="php keyword">case</code> <code class="php string">'recoverSuccess'</code><code class="php plain">: ?&gt;</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;h2&gt;Password Reset&lt;/h2&gt;</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;p&gt;Congratulations! your password has been reset successfully.&lt;/p&gt;&lt;br /&gt;&lt;br /&gt;&lt;a href=</code><code class="php string">"login.php"</code><code class="php plain">&gt;Return&lt;/a&gt; to the login page. &lt;/p&gt;</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php </code><code class="php keyword">break</code><code class="php plain">; </code><code class="php keyword">case</code> <code class="php string">'speedLimit'</code><code class="php plain">: ?&gt;</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;h2&gt;Warning&lt;/h2&gt;</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;p&gt;You have answered the security question wrong too many times. You will be locked out </code><code class="php keyword">for</code> <code class="php plain">15 minutes, after which you can </code><code class="php keyword">try</code> <code class="php plain">again.&lt;/p&gt;&lt;br /&gt;&lt;br /&gt;&lt;a href=</code><code class="php string">"login.php"</code><code class="php plain">&gt;Return&lt;/a&gt; to the login page. &lt;/p&gt;</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php </code><code class="php keyword">break</code><code class="php plain">; }</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">ob_flush();</code></div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$mySQL</code><code class="php plain">-&gt;close();</code></div><div class="line number27 index26 alt2"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Continuing the switch statement, we have "recoverForm", which displays the form to change the password. We print out the user's name, and an error message if needed. Then we have input fields for a password and confirmation password, the submission step, the userID and the security key from the email. For the key and userID, e are using the special <strong>if()</strong> syntax to make sure that we are getting the variable from the right place. If the querystring variable is null, we will look in the post variables to make sure that we always have a value here.</p>
<div class="tutorial_image"><img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/8.jpg" data-original-url="http://nettuts.s3.amazonaws.com/315_passwordRecovery/8.jpg" width="600" height="317" alt="Change Password"></div>
<p>Then, "invalidKey" means that the key provided did not exist or was expired. The "speedLimit" message is displayed if the user has been locked out because of too many incorrect answers. Finally, we call <strong>ob_flush()</strong> to send the page to the browser, and <strong>$mySQL-&gt;close()</strong> to disconnect from the database.</p>
<p><strong>NOTE:</strong> "recoverForm" and "invalidKey" messages from above are not needed for unencrypted passwords.</p>
<h3 class="nolinks">Conclusion</h3>
<p>In this article, we've looked at adding an extremely useful feature for any membership site. Whether you store your passwords as plain text or encrypted, this tutorial should have helped you add a password recovery function. We looked at the logic behind encrypting passwords, sending emails to recover the passwords, and some security concerns when doing so.</p>
<p>Additionally, we looked at using mysqli to improve our interaction with the database. While this tutorial didn't go that in depth with mysqli, it should leave you a little better off than you were before.</p>
<p>I hope you can use the techniques discussed here to add this extremely useful feature to your next user membership site.</p>
<p><strong>Note on the Download: </strong>In the download files, I have implemented both encrypted and unencrypted versions in two different folders.</p>
<ul class="webroundup">
<li>Follow us on <a href="http://www.twitter.com/nettuts">Twitter</a>, or subscribe to the <a href="http://feeds.feedburner.com/nettuts" title="NETTUTS RSS Feed">NETTUTS RSS Feed</a> for more daily web development tuts and articles.</li>
</ul>
<p>
<script type="text/javascript"><!--digg_url = "post permalink (not digg url)"; // -->
</script><br>
<script src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/diggthis.js" type="text/javascript"></script></p>
</div></div></div></div><div class="layout__sidebar"><div class="ad view"><div class="ad__wrapper"><div class="ad__content" id="div-gpt-1379650391729-0"><div id="google_ads_iframe_/11757429/hub_development_post_top_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/11757429/hub_development_post_top_0" name="google_ads_iframe_/11757429/hub_development_post_top_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:&quot;&lt;html&gt;&lt;body style=&#39;background:transparent&#39;&gt;&lt;/body&gt;&lt;/html&gt;&quot;" style="border: 0px; vertical-align: bottom;"></iframe></div></div><div class="ad__label">Advertisement</div></div></div><div class="post__sidebar"><div class="post__sidebar-primary"><div class="post__series-info"></div><div class="post-meta"><img sizes="100px" alt="Preview for Creating an Advanced Password Recovery Utility" class="post-meta__image" srcset="https://cdn.tutsplus.com/net/uploads/legacy/315_passwordRecovery/200x200.png 400w" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/200x200.png"><div class="post-meta__description"><div class="post-meta__item"><div class="post-meta__label">Difficulty:</div><div class="post-meta__value">Intermediate</div></div><div class="post-meta__item"><div class="post-meta__label">Categories:</div><div class="post-meta__value"><span class="post-meta__tag"><a class="post-meta__category-link" href="http://code.tutsplus.com/categories/php">PHP</a></span><span class="post-meta__tag"><a class="post-meta__category-link" href="http://code.tutsplus.com/categories/web-development">Web Development</a></span></div></div><div class="post-meta__label">Translations:</div><div class="post-meta__translate-this-post"><p>Envato Tuts+ tutorials are translated into other languages by our community members—you can be involved too!</p><a class="post-meta__translate-button" href="https://getnative.me/?ref=tutsplus&amp;lang=en&amp;url=http://code.tutsplus.com/tutorials/creating-an-advanced-password-recovery-utility--net-4741&amp;title=Creating%20an%20Advanced%20Password%20Recovery%20Utility">Translate this post</a><span class="post-meta__translate-powered-by-native">Powered by<img class="post-meta__native-translate-image" title="Native" alt="Native logo" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/native-logo-658bb251c3d4aa0b1f50e8cdc1e3a003.png"></span></div></div></div><div class="instructor-bio view view--loaded"><div class="instructor-bio__title">About <a class="instructor-bio__title-link" href="http://tutsplus.com/authors/andrew-steenbuck">Andrew Steenbuck</a></div><div class="instructor-bio__details"><a class="instructor-bio__title-link" href="http://tutsplus.com/authors/andrew-steenbuck"><img alt="" class="instructor-bio__image" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/be9212e83235fd788b0584a9ff0fd237"></a>N/A</div><a class="instructor-bio__expand-link" href="javascript:;">+ Expand Bio</a><a class="instructor-bio__collapse-link" href="javascript:;" style="display: none;">- Collapse Bio</a></div><div class="post__ad"><div class="ad view"><div class="ad__wrapper"><div class="ad__content" id="div-gpt-1382314910331-0"><div id="google_ads_iframe_/11757429/hub_development_post_mid_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/11757429/hub_development_post_mid_0" name="google_ads_iframe_/11757429/hub_development_post_mid_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:&quot;&lt;html&gt;&lt;body style=&#39;background:transparent&#39;&gt;&lt;/body&gt;&lt;/html&gt;&quot;" style="border: 0px; vertical-align: bottom;"></iframe></div></div><div class="ad__label">Advertisement</div></div></div></div></div><div class="post__sidebar-secondary"><div class="post__recommended-courses"><div class="suggested-course"><div class="suggested-course__title">Suggested Envato Tuts+ Course</div><div class="suggested-course__video"><div class="lesson-video view view--loaded" data-course-sku="CRS-200273" data-human-readable-id="CRS-200273_1.1_introduction" data-wistia-id="a0au10u6rs"><div class="lesson-video__wrapper"><div class="wistia_video_foam_dummy" data-source-container-id="wistia_a0au10u6rs" style="border: 0px; display: block; height: 0px; margin: 0px; padding: 0px; position: static; visibility: hidden; width: auto;"></div><div class="lesson-video__video" data-video-height="540" data-video-width="960" id="wistia_a0au10u6rs" style="width: 298px; height: 186px;"><div id="wistia_chrome_11" style="display: inline-block; height: 186px; margin: 0px; padding: 0px; position: relative; vertical-align: top; width: 298px; zoom: 1; overflow: hidden; box-sizing: content-box;"><div id="wistia_grid_15_wrapper" style="display: block; width: 298px; height: 186px;"><div id="wistia_grid_15_above" style="height: 0px; font-size: 0px; line-height: 0px;"> </div><div id="wistia_grid_15_main" style="width: 298px; left: 0px; height: 186px; margin-top: 0px;"><div id="wistia_grid_15_behind"></div><div id="wistia_grid_15_center" style="width: 100%; height: 100%;"><div id="wistia_video_wrapper_17" style="display: inline-block; height: 100%; margin: 0px; padding: 0px; position: relative; vertical-align: top; width: 100%; zoom: 1; overflow: hidden;"><div id="wistia_14_romulus" style="display: block; height: 100%; overflow: hidden; position: relative; width: 100%; background: rgb(0, 0, 0);"><video id="wistia_14" preload="none" poster="//fast.wistia.com/assets/images/blank.gif" style="display: block; height: 100%; position: relative; visibility: visible; width: 100%; object-fit: fill; background: transparent;"><source id="wistia_14_source" src="http://embed.wistia.com/deliveries/24d05974631e9249cce165d5b30f9549161f69b6/file.mp4" type="video/mp4"></video><style id="wistia_18_style" type="text/css" class="wistia_injected_style">#wistia_chrome_11:fullscreen,
#wistia_chrome_11:-webkit-full-screen,
#wistia_chrome_11:-moz-full-screen {
background:#000;
}
#wistia_a0au10u6rs .wistia_romulus_control {
  -webkit-font-smoothing: antialiased;
  z-index: 1;
}
#wistia_a0au10u6rs .wistia_romulus_hidden {
  opacity: 0;
  -webkit-transition: opacity 200ms linear 0s,width 0s linear 200ms,height 0s linear 200ms;
-moz-transition: opacity 200ms linear 0s,width 0s linear 200ms,height 0s linear 200ms;
-o-transition: opacity 200ms linear 0s,width 0s linear 200ms,height 0s linear 200ms;
-ms-transition: opacity 200ms linear 0s,width 0s linear 200ms,height 0s linear 200ms;
transition: opacity 200ms linear 0s,width 0s linear 200ms,height 0s linear 200ms;
}
#wistia_a0au10u6rs .wistia_romulus_visible {
  opacity: 1;
  visibility: visible;
  -webkit-transition: opacity 200ms linear 0s;
-moz-transition: opacity 200ms linear 0s;
-o-transition: opacity 200ms linear 0s;
-ms-transition: opacity 200ms linear 0s;
transition: opacity 200ms linear 0s;
}
#wistia_a0au10u6rs .wistia_played {
  -webkit-transition: width 300ms linear 0s;
-moz-transition: width 300ms linear 0s;
-o-transition: width 300ms linear 0s;
-ms-transition: width 300ms linear 0s;
transition: width 300ms linear 0s;
}
#wistia_a0au10u6rs .wistia_playbar.wistia_dragging .wistia_played {
  -webkit-transition: left 0 linear 0s;
-moz-transition: left 0 linear 0s;
-o-transition: left 0 linear 0s;
-ms-transition: left 0 linear 0s;
transition: left 0 linear 0s;
}
#wistia_a0au10u6rs .wistia_scrub_bar {
  -webkit-transition: left 300ms linear 0s;
-moz-transition: left 300ms linear 0s;
-o-transition: left 300ms linear 0s;
-ms-transition: left 300ms linear 0s;
transition: left 300ms linear 0s;
}
#wistia_a0au10u6rs .wistia_playbar.wistia_dragging .wistia_scrub_bar {
  -webkit-transition: left 0 linear 0s;
-moz-transition: left 0 linear 0s;
-o-transition: left 0 linear 0s;
-ms-transition: left 0 linear 0s;
transition: left 0 linear 0s;
}
#wistia_a0au10u6rs .wistia_scrub_bar_top {
  background: rgba(255, 255, 255, .33);
  height: 4px;
  left: 0;
  position: absolute;
  top: 0;
  width: 4px;
}
#wistia_a0au10u6rs .wistia_scrub_bar_middle {
  background: rgba(255, 255, 255, .66);
  height: 24px;
  left: 0;
  position: absolute;
  top: 4px;
  width: 4px;
}
#wistia_a0au10u6rs .wistia_scrub_bar_bottom {
  background: rgba(255, 255, 255, .33);
  height: 4px;
  left: 0;
  position: absolute;
  top: 28px;
  width: 4px;
}
#wistia_a0au10u6rs .wistia_menu_item {
  background: transparent;
  color: #555;
  font-family: Arial, Sans-Serif;
  font-size: 14px;
  font-weight: normal;
  padding: 6px 16px;
  transition: none;
  -webkit-font-smoothing: antialiased;
}
#wistia_a0au10u6rs .wistia_menu_item .wistia_bullet {
  display: inline-block;
  margin: -1px 7px 0 0;
  vertical-align: top;
}
#wistia_a0au10u6rs .wistia_menu_item.wistia_visible {
  display: block;
}
#wistia_a0au10u6rs .wistia_menu_item.wistia_hidden {
  display: none;
}
#wistia_a0au10u6rs .wistia_menu_item:hover {
  background: #54bbff;
  color: #fff;
}
#wistia_a0au10u6rs .wistia_menu_item.wistia_disabled {
  background: transparent;
  color: #bbb;
}
#wistia_a0au10u6rs .wistia_menu_item.wistia_title {
  background: transparent;
  color: #bbb;
  font-size: 11px;
  line-height: 1em;
  padding-bottom: 3px;
}
#wistia_a0au10u6rs .wistia_dont_animate {
  -webkit-transition: none;
  -moz-transition: none;
  -o-transition: none;
  -ms-transition: none;
  transition: none;
}
#wistia_14 {
  -ms-object-fit: contain;
  -o-object-fit: contain;
  -moz-object-fit: contain;
  -webkit-object-fit: contain;
  object-fit: contain;
}</style><div id="wistia_still_19" class="wistia_romulus_control wistia_romulus_hidden" style="cursor: pointer;"></div><div id="wistia_25.thumbnail" tabindex="-1" style="cursor: default; display: block; height: 186px; overflow: hidden; outline: none; position: absolute; width: 298px; left: 0px; top: 0px;"><img id="wistia_25.thumbnail_img" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/1c355c2f6e328849ab19effd46090cb17b8c159f.jpg" style="border: 0px solid rgb(0, 0, 0); display: block; float: none; height: 186px; margin: 0px; max-height: none; max-width: none; padding: 0px; position: absolute; width: 298px; left: 0px; top: 0px;"></div><div id="wistia_smallPlayButton_44" class="wistia_romulus_control wistia_romulus_hidden" alt="Click to play" style="cursor: pointer; position: absolute; bottom: 0px; width: 0px; height: 0px; left: 0px; background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABMCAYAAACmj3NpAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAARtJREFUeNrs2kFRAzEYgNEuCioBCeAACZWABCQsCpCABCRUAjioBHCwbA65MFx7+freTK4c/g8yG5LDAQAAAAAAAAAAAP7Ytm01hXbg4byve9PoBh6+93UykW7g6X1fR5PpBh4+9/VgOt3A04sJtQMPH7bsduD5AfZkWt3A05uJtQPPDzBn5nDguWU/m143sDPzjQQeLs7M7cDOzDcSeF5aJLbsO78a/xpn5YtLi+5fcObMvJQCX/HHfy3L8miLbvrZ16sxNLdoL0TCgVdTbQb2D49wYHfG0cAuHcKBvdsKB3bxHw3s6U448NmHVDewq8BoYGfbcGDPcaKBnW3DgT2JDQdeTaMZ2Nk2HtiHFAAAAAAAAAAAAFf1K8AAF3b4jLx17LUAAAAASUVORK5CYII=&quot;) 0px 0px / 50px 32px no-repeat rgba(123, 121, 106, 0.8);"></div><div id="wistia_playbarControl_49" class="wistia_romulus_control wistia_romulus_hidden wistia_playbar" alt="Playbar - click to seek" style="cursor: pointer; position: absolute; bottom: 0px; height: 0px; overflow: hidden; width: 133px; -webkit-user-select: none; left: 55px;"><div id="wistia_playbar_background_54" style="position: absolute; left: 4px; top: 4px; height: 24px; pointer-events: none; width: 125px; background: rgba(123, 121, 106, 0.498039);"></div><div id="buffered_55" class="wistia_buffered" style="position: absolute; left: 4px; top: 4px; width: 0px; height: 24px; background: rgba(223, 221, 206, 0.8);"></div><div style="position: absolute; left: 0px; top: 0px; border: 4px solid rgba(123, 121, 106, 0.8); pointer-events: none; width: 125px; height: 24px;"></div><div id="watched_56" class="wistia_played" style="position: absolute; left: 0px; top: 0px; width: 0px; height: 32px; background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQFJREFUeNrsl6EOwkAQRC+T1CBAYDAIEFRgiiiW/6cCDAJTBKYGQQWmouyGbbLZD5gzNBnxcmbSd+3dpnEcC8lJUkoSm5FS2ksGyT39HiprgZWkscU1m2GgjebWjspa4CUpJAfJg82wV7ELnmg87QF1c7VFKmuByuAjmbFZCzwlnbWr2awFbu77TGxG8NKwGTm8e0YO754RvJRs1gIXg6Vkw2Yt0NuvsbZmVIbz0pkbKsO8FMETjeG8DMEThZHDu2c4L5Wd1VSeNuFWsnBHJo3hrkrncHWisBY4Bi9U1gJvSeu8UBk5vHtGDu+e4a7I3hON/WjWhtGJwv/RLPto9hVgAAkkA1W/Un5YAAAAAElFTkSuQmCC&quot;);"><div id="time_57" class="wistia_time" style="bottom: 7px; color: rgba(255, 255, 255, 0.701961); cursor: pointer; display: inline-block; font-family: Arial, sans-serif; font-weight: bold; font-size: 15px; line-height: 1.1em; position: absolute; text-shadow: rgb(123, 121, 106) 0px 0px 9px; white-space: nowrap; width: 0px; left: auto; right: -8px;">0:40</div></div><div id="scrub_bar_60" class="wistia_scrub_bar" style="position: absolute; left: 0px; top: 0px; width: 4px; height: 32px;"><div class="wistia_scrub_bar_top">&nbsp;</div>
<div class="wistia_scrub_bar_middle">&nbsp;</div>
<div class="wistia_scrub_bar_bottom">&nbsp;</div></div></div><div id="wistia_volumeControl_61" class="wistia_romulus_control wistia_romulus_hidden" alt="Volume (100%) - click and drag horizontally to change" style="cursor: pointer; position: absolute; bottom: 0px; height: 0px; overflow: hidden; width: 0px; right: 55px;">&nbsp;<div style="position: absolute; left: 0px; top: 0px; height: 32px; width: 50px; background-color: rgba(123, 121, 106, 0.8);"></div><div style="position: absolute; left: 50px; top: 0px; height: 32px; width: 0px; background-color: rgba(123, 121, 106, 0.498039);"></div><div style="position: absolute; left: 15px; top: 7px; height: 18px; width: 21px; background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAkCAYAAAD/yagrAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAfZJREFUeNrsWO1thDAMhVMHYIOyQRmBbsAIbHCMcJ0AdQLUCU6dADpBrhNwN8HdBmkiBdVyHYePAPlRSwiEA3l5tmM7h2hHkVLW6mqikEUBLOWvOMEedsR6UdfDPGvQZcisZuq6A2azUEzdEO8LAFSsNXlhAkKMGGf1R/OPQSqfAFMNDvxcOsYnaPyJ0A8uoO+JLxahXzmBgsXB73Kkr7yxqpmQFiHGNnpR6F3O+SNYSD8XoDZNKxlB4wUwY8r4Y8kQkc/ZQnrpEMaMLeOPPeEeg9Rzs8dooObblvHH2rZ3Amv0Y03dyAliCR5yS+KYQ+ZPocKLWBZ8ZhYiqKBCAVdsles/IQCk68w9I2qACOvWBtqBZwz0m1pEHMcPUKw8bwJUTXqlJjVydVRWWtIty7w/k86RPevRf6BzJSeiebIrrAoUZZ0bUr+AoOuQLtma0cKyVXFMw/3za3jxpFYTW9iQC9nUrByHrUhNc4EpFIDpGCs8xjD6tpDNCpjwHemO4PnDwjRlBbbEE1NzPaq6ethacGUeqg/uXit7C9B6ZIlXElXbIOclPbiYUOYJAoirFTlRlZPXvslDc5eATqL3tj/6bJcJAk6hHkBktuAL6UgHs11EoQkBsgkRJD4WEpzJ9yzzMpBGdXp9NW1IkOejtclEzuD5EWAA23jc4a3H7VsAAAAASUVORK5CYII=&quot;); background-size: 21px 18px;"></div></div><div id="wistia_fullscreenButton_67" class="wistia_romulus_control wistia_romulus_hidden" alt="Fullscreen - click to toggle" style="cursor: pointer; position: absolute; bottom: 0px; width: 0px; height: 0px; -webkit-user-select: none; right: 0px; background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAkCAYAAADLsGk3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAK9JREFUeNrsmW0KgCAMhjW6l96supmdzCYkjDBRCqbjfUHwh+Ae9oGbJrZpN0JKd7cYuBglWtk+0DpfzgVBG2t3O1o+u048fP4IOzWhpTJHnm6LIxpsSao9oiq0jgFK7OfSbJEjyBGAAAQgAAEIQAACEIAARKqxYmOgQE/9qZorst2be66VOsSt1HFNIp/tR44MlyO9vTE8ApD+0HKVibxYaeYltiDHD+LHaiRdAgwAGD3VmeLXH3kAAAAASUVORK5CYII=&quot;) 12px 7px / 25px 18px no-repeat rgba(123, 121, 106, 0.8);">&nbsp;</div><div id="wistia_branding_72" class="wistia_romulus_control wistia_romulus_hidden" style="cursor: pointer; overflow: hidden; position: absolute; left: 0px; top: 0px; height: 0px; width: 0px; background-color: rgba(123, 121, 106, 0.8);"><a href="http://wistia.com/about-wistia?player=108233" tabindex="-1" style="display: block; font-size: 12px; font-family: &#39;Gill Sans&#39;, sans-serif; height: 14px; letter-spacing: 1px; line-height: 14px; padding-left: 5px; padding-top: 2px; padding-bottom: 2px; text-decoration: none; width: 293px;"><span style="color: rgba(255, 255, 255, 0.65098);">POWERED BY</span> <span style="color: rgb(255, 255, 255);">WISTIA</span></a></div><div id="wistia_14.big_play_button_background" style="height: 38px; position: absolute; width: 60px; z-index: 1; left: 119px; top: 74px; display: block; background-color: rgba(123, 121, 106, 0.8);"></div><div id="wistia_14.big_play_button_graphic" tabindex="0" aria-role="Button" aria-label="Play" style="cursor: pointer; display: block; height: 38px; outline: none; position: absolute; width: 60px; z-index: 1; left: 119px; top: 74px; background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAmCAYAAACYsfiPAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJNJREFUeNrs1ksNhEAURNGWgAQkjAQkIAUJ7QApIwEJSEACEh6PBatJhmZJ1T1JCahU+lMKAACAioj4Zjqnwqc9MzoVvszya8evLTM4FdZeO/7TWzva6Kwd7dbMx6nwpboV3l99rh+WXV5/lh+sOrlcWueqvcOzpLNqQ2GtVW8KT0WZ3MeisXAtLixWBQAAQDoEGACTzSwy3SX7YgAAAABJRU5ErkJggg==&quot;) 0px 0px / 60px 38px no-repeat transparent;"></div><div id="wistia_loading_91" class="wistia_romulus_control" style="cursor: pointer; position: absolute; display: none; left: 0px; top: 0px; color: rgba(255, 255, 255, 0.8); font-family: Arial, sans-serif; font-style: italic; line-height: 1.1em; padding: 2px 5px; background-color: rgb(123, 121, 106);">Loading...</div><div id="wistia_context_menu_95" class="wistia_romulus_control wistia_context_menu" style="cursor: pointer; box-shadow: rgba(0, 0, 0, 0.2) 0px 3px 10px; left: 0px; line-height: 1.5em; position: absolute; text-shadow: none; top: 0px; width: 200px; z-index: 100000; display: none; background-color: rgb(255, 255, 255);"><div class="wistia_disabled wistia_menu_item wistia_menu_item_playingIn" id="playingIn">Playing in <span id="playingInName">600p</span></div><div style="font-size: 0px; height: 0px; line-height: 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(232, 232, 232); margin: 1px 0px;"></div><div id="auto" class="wistia_menu_item wistia_menu_item_auto"><span id="autoBullet" class="wistia_bullet">●</span> Auto</div><div id="mp4_h264_331k" class="wistia_menu_item wistia_menu_item_mp4_h264_331k"><span id="mp4_h264_331kBullet" class="wistia_bullet">○</span> 250p</div><div id="mp4_h264_829k" class="wistia_menu_item wistia_menu_item_mp4_h264_829k"><span id="mp4_h264_829kBullet" class="wistia_bullet">○</span> 400p</div><div id="mp4_h264_1375k" class="wistia_menu_item wistia_menu_item_mp4_h264_1375k"><span id="mp4_h264_1375kBullet" class="wistia_bullet">○</span> 600p</div><div id="mp4_h264_2701k" class="wistia_menu_item wistia_menu_item_mp4_h264_2701k"><span id="mp4_h264_2701kBullet" class="wistia_bullet">○</span> 800p</div><div style="font-size: 0px; height: 0px; line-height: 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(232, 232, 232); margin: 1px 0px;"></div><div id="switchToFlash" class="wistia_menu_item wistia_menu_item_switchToFlash">Switch to Flash</div><div style="font-size: 0px; height: 0px; line-height: 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(232, 232, 232); margin: 1px 0px;"></div><a href="http://wistia.com/about-wistia?about=108233" target="_blank" id="aboutWistia" class="wistia_menu_item wistia_menu_item_aboutWistia" style="display: block; text-decoration: none;">About Wistia</a></div></div></div></div><div id="wistia_grid_15_front"></div><div id="wistia_grid_15_top_inside"><div id="wistia_grid_15_top" style="height: 0px; font-size: 0px; line-height: 0px;"> </div></div><div id="wistia_grid_15_bottom_inside"><div id="wistia_grid_15_bottom" style="height: 0px; font-size: 0px; line-height: 0px;"> </div></div><div id="wistia_grid_15_left_inside"><div id="wistia_grid_15_left" style="height: 0px; font-size: 0px; line-height: 0px;"> </div></div><div id="wistia_grid_15_right_inside"><div id="wistia_grid_15_right" style="height: 0px; font-size: 0px; line-height: 0px;"> </div></div></div><div id="wistia_grid_15_below" style="height: 0px; font-size: 0px; line-height: 0px;"> </div><style id="wistia_16_style" type="text/css" class="wistia_injected_style">#wistia_grid_15_wrapper{-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box;font-family:Arial,sans-serif;font-size:14px;height:100%;position:relative;text-align:left;width:100%;}
#wistia_grid_15_wrapper *{-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box;}
#wistia_grid_15_above{position:relative;}
#wistia_grid_15_main{display:block;height:100%;position:relative;}
#wistia_grid_15_behind{height:100%;left:0;position:absolute;top:0;width:100%;}
#wistia_grid_15_center{height:100%;overflow:hidden;position:relative;width:100%;}
#wistia_grid_15_front{display:none;height:100%;left:0;position:absolute;top:0;width:100%;}
#wistia_grid_15_top_inside{position:absolute;left:0;top:0;width:100%;}
#wistia_grid_15_top{width:100%;position:absolute;bottom:0;left:0;}
#wistia_grid_15_bottom_inside{position:absolute;left:0;bottom:0;width:100%;}
#wistia_grid_15_bottom{width:100%;position:absolute;top:0;left:0;}
#wistia_grid_15_left_inside{height:100%;position:absolute;left:0;top:0;}
#wistia_grid_15_left{height:100%;position:absolute;right:0;top:0;}
#wistia_grid_15_right_inside{height:100%;right:0;position:absolute;top:0;}
#wistia_grid_15_right{height:100%;left:0;position:absolute;top:0;}
#wistia_grid_15_below{position:relative;}</style></div></div></div><div class="video-settings-menu video-settings-menu__hidden"><div class="video-settings-menu__captions video-settings-menu__disabled"><a class="video-settings-menu__captions-toggle" href="javascript:"><i class="fa fa-fw fa-cc"></i> <span>Turn Captions</span> <span class="video-settings-menu__captions-state">On</span></a></div><div class="video-settings-menu__autoplay"><a class="video-settings-menu__autoplay-toggle" href="javascript:"><i class="fa fa-fw fa-play-circle"></i> <span>Turn Autoplay</span> <span class="video-settings-menu__autoplay-state">Off</span></a></div><div class="video-settings-menu__playback-rate video-settings-menu__disabled"><a class="video-settings-menu__playback-rate-decrease" href="javascript:"><i class="fa fa-minus"></i></a><span class="video-settings-menu__playback-rate-description"><span class="video-settings-menu__playback-rate-value">1</span>× <span>speed</span></span><a class="video-settings-menu__playback-rate-increase" href="javascript:"><i class="fa fa-plus"></i></a></div></div><div class="lesson-video__countdown-overlay topic-code"><h2 class="lesson-video__countdown-message nolinks"><span>Next lesson playing in</span> <span class="lesson-video__countdown-seconds-remaining"><span class="lesson-video__countdown-seconds">5</span> <span>seconds</span></span></h2><a class="lesson-video__countdown-cancel" href="javascript:"><i class="fa fa-times"></i><span class="lesson-video__countdown-button">Cancel</span></a></div></div></div></div><a class="suggested-course__link" href="http://code.tutsplus.com/courses/php-owasp-security?utm_source=Tuts+&amp;utm_medium=website&amp;utm_campaign=suggestedcoursevideo&amp;utm_content=sidebar&amp;WT.mc_id=Tuts+_website_suggestedcoursevideo_sidebar">PHP OWASP Security<span class="suggested-course__price">$9</span></a></div></div><div class="post__recommended-content"><div class="recommended-items"><div class="recommended-items__header">Related Tutorials</div><a href="http://code.tutsplus.com/tutorials/how-to-develop-a-membership-site-with-wordpress-part-3--cms-23391?utm_source=Tuts+&amp;utm_medium=website&amp;utm_campaign=relatedtutorials&amp;utm_content=sidebar&amp;WT.mc_id=Tuts+_website_relatedtutorials_sidebar"><div class="recommended-items__item"><div class="recommended-items__preview-image-container"><img class="recommended-items__preview-image " src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/thumbnail.jpg" alt="Thumbnail"></div><div class="recommended-items__title">How to Develop a Membership Site With WordPress: Part 3</div><div class="recommended-items__topic topic-code">Code</div></div></a><a href="http://code.tutsplus.com/tutorials/how-to-develop-a-membership-site-with-wordpress-part-2--cms-23389?utm_source=Tuts+&amp;utm_medium=website&amp;utm_campaign=relatedtutorials&amp;utm_content=sidebar&amp;WT.mc_id=Tuts+_website_relatedtutorials_sidebar"><div class="recommended-items__item"><div class="recommended-items__preview-image-container"><img class="recommended-items__preview-image " src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/thumbnail(1).jpg" alt="Thumbnail"></div><div class="recommended-items__title">How to Develop a Membership Site With WordPress: Part 2</div><div class="recommended-items__topic topic-code">Code</div></div></a><a href="http://code.tutsplus.com/tutorials/building-a-note-taking-software-as-a-service-using-aspnet-mvc-5-stripe-and-azure--cms-22922?utm_source=Tuts+&amp;utm_medium=website&amp;utm_campaign=relatedtutorials&amp;utm_content=sidebar&amp;WT.mc_id=Tuts+_website_relatedtutorials_sidebar"><div class="recommended-items__item"><div class="recommended-items__preview-image-container"><img class="recommended-items__preview-image " src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/Cover.jpg" alt="Cover"></div><div class="recommended-items__title">Building a Note-Taking Software-as-a-Service Using ASP.NET MVC 5, Stripe, and Azure</div><div class="recommended-items__topic topic-code">Code</div></div></a></div></div><div class="marketplace-items view view--loaded"><div class="marketplace-items__container">
  <div class="marketplace-items__header">Envato Market Item</div>
  <div class="marketplace-items__item">
  <a class="marketplace-items__item-link" href="http://codecanyon.net/item/famax-facebook-fan-page-on-your-website/10287995?ref=tutshub">
    <img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/preview_fifa.jpg" alt="" class="marketplace-items__item-preview-image">
  </a>
</div>
</div></div><div class="post__call-for-subject"><div class="post__call-for-subject-title">What Would You Like to Learn?</div><div class="post__call-for-subject-body"><a href="https://tutsplus.uservoice.com/forums/248750-what-would-you-like-to-learn">Suggest an idea</a> to the content editorial team at Envato Tuts+.</div></div></div></div></div><footer class="post__footer"><div class="layout__content-with-sidebar"><div class="post__comments" id="comments"><div id="disqus_thread" name="disqus_thread"><iframe id="dsq-app1" name="dsq-app1" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/saved_resource(2).html" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 6816px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div><script>var disqus_shortname  = "nettuts";
var disqus_identifier = "4741 http://net.tutsplus.com/?p=4741";
var disqus_title      = "Creating an Advanced Password Recovery Utility";
var disqus_url        = "http://code.tutsplus.com/tutorials/creating-an-advanced-password-recovery-utility--net-4741";
var disqus_config     = function() {
    this.language = "en";
};

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();

(function () {
  var s = document.createElement('script'); s.async = true;
  s.type = 'text/javascript';
  s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());</script></div></div><div class="layout__sidebar"><div class="ad view"><div class="ad__wrapper"><div class="ad__content" id="div-gpt-1379650407131-0"><div id="google_ads_iframe_/11757429/hub_development_post_comments_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/11757429/hub_development_post_comments_0" name="google_ads_iframe_/11757429/hub_development_post_comments_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:&quot;&lt;html&gt;&lt;body style=&#39;background:transparent&#39;&gt;&lt;/body&gt;&lt;/html&gt;&quot;" style="border: 0px; vertical-align: bottom;"></iframe></div></div><div class="ad__label">Advertisement</div></div></div></div></footer></article></main></div><footer class="page-footer view view--loaded"><div class="page-footer__content"><div class="page-footer__header"><div class="page-footer__tuts-brand"><img alt="envato-tuts+" class="page-footer__tuts-logo-image tuts-logo" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/tuts_logo-b4f5f5fad9a5f4b3f91e3b770689a808.svg"><span class="page-footer__tuts-brand-text">Teaching skills to millions worldwide.</span></div><div class="page-footer__counts"><div class="page-footer__count-item"><div class="page-footer__count-value">21,010</div><div class="page-footer__count-label">Tutorials</div><div class="page-footer__count-value">685</div><div class="page-footer__count-label">Video Courses</div></div></div></div><div class="page-footer__links"><div class="page-footer__links-column"><div class="page-footer__section page-footer__section--first"><div class="page-footer__heading">Meet Envato</div><a class="page-footer__links-column-expansion-link" href="javascript:void(0);"><span class="page-footer__links-column-expansion-link-expand-text"><i class="fa fa-plus page-footer__links-column-link-icon"></i></span><span class="page-footer__links-column-expansion-link-collapse-text"><i class="fa fa-minus page-footer__links-column-link-icon"></i></span></a><div class="page-footer__item"><a class="page-footer__link" href="http://envato.com/">About Envato</a></div><div class="page-footer__item"><a class="page-footer__link" href="http://envato.com/sites">Explore our Ecosystem</a></div><div class="page-footer__item"><a class="page-footer__link" href="http://envato.com/careers">Careers</a></div></div></div><div class="page-footer__links-column"><div class="page-footer__section page-footer__section--first"><div class="page-footer__heading">Join our Community</div><a class="page-footer__links-column-expansion-link" href="javascript:void(0);"><span class="page-footer__links-column-expansion-link-expand-text"><i class="fa fa-plus page-footer__links-column-link-icon"></i></span><span class="page-footer__links-column-expansion-link-collapse-text"><i class="fa fa-minus page-footer__links-column-link-icon"></i></span></a><div class="page-footer__item"><a class="page-footer__link" href="http://tutsplus.com/teach">Teach at Envato Tuts+</a></div><div class="page-footer__item"><a class="page-footer__link" href="http://tutsplus.com/translate-for-us">Translate for Envato Tuts+</a></div><div class="page-footer__item"><a class="page-footer__link" href="https://community.tutsplus.com/">Forums</a></div><div class="page-footer__item"><a class="page-footer__link" href="http://tutsplus.com/blog">Blog</a></div><div class="page-footer__item"><a class="page-footer__link" href="http://community.envato.com/#/events/">Community meetups</a></div></div></div><div class="page-footer__links-column"><div class="page-footer__section page-footer__section--first"><div class="page-footer__heading">Help and Support</div><a class="page-footer__links-column-expansion-link" href="javascript:void(0);"><span class="page-footer__links-column-expansion-link-expand-text"><i class="fa fa-plus page-footer__links-column-link-icon"></i></span><span class="page-footer__links-column-expansion-link-collapse-text"><i class="fa fa-minus page-footer__links-column-link-icon"></i></span></a><div class="page-footer__item"><a class="page-footer__link" href="http://tutsplus.com/faq">FAQ</a></div><div class="page-footer__item"><a class="page-footer__link" href="http://tutsplus.com/support">Help Center</a></div><div class="page-footer__item"><a class="page-footer__link" href="http://tutsplus.com/terms-of-use">Terms of Use</a></div><div class="page-footer__item"><a class="page-footer__link" href="http://tutsplus.com/about">About Envato Tuts+</a></div><div class="page-footer__item"><a class="page-footer__link" href="http://tutsplus.com/advertise">Advertise</a></div></div></div><div class="page-footer__links-column page-footer__links-last-column"><div class="page-footer__section page-footer__section-subscribe page-footer__section--first"><div class="page-footer__newsletter-section"><div class="page-footer__heading">Email Newsletters</div><div class="page-footer__newsletter-description">Get Envato Tuts+ updates, news, surveys &amp; offers.</div><form class="page-footer__newsletter-form" action="http://code.tutsplus.com/weekly_digest_subscription_requests" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="✓"><input type="hidden" name="authenticity_token" value="PqEktD5tCMIftEzKzeaSnBSjpXBrPhzmNbvVCjsOuvxSeswpoy7G8WwMP9alZpsylxu4lh6RukDqqP+vKRoU/A=="><input placeholder="Email Address" class="page-footer__newsletter-email-field" type="email" name="weekly_digest_subscription_request[email]" id="weekly_digest_subscription_request_email"><button name="button" type="submit" class="page-footer__newsletter-submit">Subscribe</button></form><a class="page-footer__newsletter-privacy-policy-link page-footer__link" href="http://tutsplus.com/privacy-policy">Privacy Policy</a></div></div></div></div><div class="page-footer__envato_links"><div class="page-footer__envato-product"><a href="http://studio.envato.com/?utm_source=tutsfooter&amp;utm_medium=banner&amp;utm_campaign=tutsfooter"><img alt="OPEN. New Services!" class="page-footer__envato-product-image page-footer__envato-product-image--studio" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/open-new-services-140x112-b60f3facb36aec4dd68b55e4df3e4237.png"></a><div class="page-footer__envato-product-description"><div class="page-footer__envato-product-description-text">Custom digital services like logo design, WordPress installation, video production and more. </div><a class="page-footer__link page-footer__envato-product-link" href="http://studio.envato.com/?utm_source=tutsfooter&amp;utm_medium=banner&amp;utm_campaign=tutsfooter">Check out Envato Studio</a></div></div><div class="page-footer__envato-product"><a href="http://codecanyon.net/popular_item/by_category?category=php-scripts&amp;ref=tutshub&amp;utm_source=tutsplus&amp;utm_medium=footer&amp;utm_campaign=tutscode"><img alt="Buy photos as you need them" class="page-footer__envato-product-image page-footer__envato-product-image--marketplaces" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/codecanyon--pre-coded-php-7285f878a39908939818664926bf47f2.jpg"></a><div class="page-footer__envato-product-description"><div class="page-footer__envato-product-description-text">Build anything from social networks to file upload systems.  Build faster with pre-coded PHP scripts. </div><a class="page-footer__link page-footer__envato-product-link" href="http://codecanyon.net/popular_item/by_category?category=php-scripts&amp;ref=tutshub&amp;utm_source=tutsplus&amp;utm_medium=footer&amp;utm_campaign=tutscode">Browse PHP on CodeCanyon</a></div></div></div></div><div class="page-footer__envato-bar"><div class="page-footer__envato-bar-content"><ul class="page-footer__follow-us"><li class="page-footer__follow-us-element">Follow Envato Tuts+</li><li class="page-footer__follow-us-element"><a class="page-footer__social-link page-footer__facebook-link" href="https://www.facebook.com/tutsplus"></a></li><li class="page-footer__follow-us-element"><a class="page-footer__social-link page-footer__twitter-link" href="https://twitter.com/tutsplus"></a></li><li class="page-footer__follow-us-element"><a class="page-footer__social-link page-footer__googleplus-link" href="https://plus.google.com/108971748263060947124/posts"></a></li><li class="page-footer__follow-us-element"><a class="page-footer__social-link page-footer__pinterest-link" href="http://www.pinterest.com/tutsplus/"></a></li></ul><div class="page-footer__copyright">© 2015 Envato Pty Ltd. Trademarks and brands are the property of their respective owners.</div></div></div></footer><script type="text/javascript">
/* <![CDATA[ */
  var google_conversion_id = 943617023;
  var google_custom_params = window.google_tag_params;
  var google_remarketing_only = true;
/* ]]> */
</script>
<script type="text/javascript" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/conversion.js">
</script><iframe name="google_conversion_frame" title="Google conversion frame" width="300" height="13" src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/saved_resource.html" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no">&lt;img height="1" width="1" border="0" alt="" src="https://googleads.g.doubleclick.net/pagead/viewthroughconversion/943617023/?frame=0&amp;random=1450752621157&amp;cv=8&amp;fst=1450752621157&amp;num=1&amp;fmt=1&amp;guid=ON&amp;u_h=1024&amp;u_w=1280&amp;u_ah=994&amp;u_aw=1280&amp;u_cd=24&amp;u_his=4&amp;u_tz=-240&amp;u_java=false&amp;u_nplug=5&amp;u_nmime=7&amp;frm=0&amp;url=http%3A//code.tutsplus.com/tutorials/creating-an-advanced-password-recovery-utility--net-4741&amp;ref=https%3A//www.google.com/" /&gt;</iframe>
<noscript>
  &lt;div style="display:inline;"&gt;
    &lt;img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/943617023/?value=0&amp;amp;guid=ON&amp;amp;script=0"/&gt;
  &lt;/div&gt;
</noscript>
<script src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/body-f91379531c05845f81938a530e369704.js" async="async"></script><script src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/1342X589339.skimlinks.js" type="text/javascript"></script><div style="display: none;"><img src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/track_page_view" style="display:none" width="0" height="0"></div><script src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/E-v1.js"></script><iframe src="./Creating an Advanced Password Recovery Utility - Envato Tuts+ Code Tutorial_files/container.html" style="visibility: hidden; display: none;"></iframe><iframe width="0" height="0" style="display: none;"></iframe><iframe width="0" height="0" style="display: none;"></iframe><iframe id="google_osd_static_frame_412947554141" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;"></iframe></body></html>